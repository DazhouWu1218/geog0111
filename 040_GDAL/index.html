<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Prof P. Lewis">
        <link rel="canonical" href="https://ucl-eo.github.io/geog0111/040_GDAL/">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>GDAL - GEOG0111</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">GEOG0111</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Introduction</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Course Basics <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../001_Notebook_use/" class="dropdown-item">Notebook Use</a>
</li>
                                    
<li>
    <a href="../002_Unix/" class="dropdown-item">Unix</a>
</li>
                                    
<li>
    <a href="../003_Help/" class="dropdown-item">Help</a>
</li>
                                    
<li>
    <a href="../004_Accounts/" class="dropdown-item">Accounts</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Answers</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../001_Notebook_use_answers/" class="dropdown-item">Notebook Use</a>
</li>
            
<li>
    <a href="../002_Unix_answers/" class="dropdown-item">Unix</a>
</li>
            
<li>
    <a href="../003_Help_answers/" class="dropdown-item">Help</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Core Concepts <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../010_Python_Introduction/" class="dropdown-item">Python Introduction</a>
</li>
                                    
<li>
    <a href="../011_Python_data_types/" class="dropdown-item">Python Data Types</a>
</li>
                                    
<li>
    <a href="../012_Python_strings/" class="dropdown-item">Python Strings</a>
</li>
                                    
<li>
    <a href="../013_Python_string_methods/" class="dropdown-item">Python String Methods</a>
</li>
                                    
<li>
    <a href="../014_Python_groups/" class="dropdown-item">Python Groups</a>
</li>
                                    
<li>
    <a href="../015_Python_control/" class="dropdown-item">Python Control</a>
</li>
                                    
<li>
    <a href="../016_Python_for/" class="dropdown-item">Python For</a>
</li>
                                    
<li>
    <a href="../017_Functions/" class="dropdown-item">Functions</a>
</li>
                                    
<li>
    <a href="../018_Packages/" class="dropdown-item">Packages</a>
</li>
                                    
<li>
    <a href="../019_Running_Python/" class="dropdown-item">Running Python</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Answers</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../010_Python_Introduction_answers/" class="dropdown-item">Python Introduction</a>
</li>
            
<li>
    <a href="../011_Python_data_types_answers/" class="dropdown-item">Python Data Types</a>
</li>
            
<li>
    <a href="../012_Python_strings_answers/" class="dropdown-item">Python Strings</a>
</li>
            
<li>
    <a href="../013_Python_string_methods_answers/" class="dropdown-item">Python String Methods</a>
</li>
            
<li>
    <a href="../014_Python_groups_answers/" class="dropdown-item">Python Groups</a>
</li>
            
<li>
    <a href="../015_Python_control_answers/" class="dropdown-item">Python Control</a>
</li>
            
<li>
    <a href="../016_Python_for_answers/" class="dropdown-item">Python For</a>
</li>
            
<li>
    <a href="../017_Functions_answers/" class="dropdown-item">Functions</a>
</li>
            
<li>
    <a href="../019_Running_Python_answers/" class="dropdown-item">Running Python</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Datasets <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../020_NASA_MODIS_Earthdata/" class="dropdown-item">NASA MODIS Earthdata</a>
</li>
                                    
<li>
    <a href="../020_Python_files/" class="dropdown-item">Python Files</a>
</li>
                                    
<li>
    <a href="../021_Read_files/" class="dropdown-item">Read Files</a>
</li>
                                    
<li>
    <a href="../022_NASA_MODIS_Earthdata/" class="dropdown-item">NASA MODIS Earthdata</a>
</li>
                                    
<li>
    <a href="../022_Pandas_and_plotting/" class="dropdown-item">Pandas And Plotting</a>
</li>
                                    
<li>
    <a href="../024_GoogleEarthEngine/" class="dropdown-item">Google Earth Engine</a>
</li>
                                    
  <li class="dropdown-submenu">
    <a href="#" class="dropdown-item">Answers</a>
    <ul class="dropdown-menu">
            
<li>
    <a href="../020_NASA_MODIS_Earthdata_answers/" class="dropdown-item">NASA MODIS Earthdata</a>
</li>
            
<li>
    <a href="../020_Python_files_answers/" class="dropdown-item">Python Files</a>
</li>
            
<li>
    <a href="../021_Read_files_answers/" class="dropdown-item">Read Files</a>
</li>
            
<li>
    <a href="../022_NASA_MODIS_Earthdata_answers/" class="dropdown-item">NASA MODIS Earthdata</a>
</li>
    </ul>
  </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Image Processing <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../031_Numpy_matplotlib/" class="dropdown-item">Numpy Matplotlib</a>
</li>
                                    
<li>
    <a href="../031_Plotting/" class="dropdown-item">Plotting</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Geospatial Data <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="./" class="dropdown-item active">GDAL</a>
</li>
                                    
<li>
    <a href="../041_MODIS_download/" class="dropdown-item">MODIS Download</a>
</li>
                                    
<li>
    <a href="../042_GDAL_masking/" class="dropdown-item">GDAL Masking</a>
</li>
                                    
<li>
    <a href="../043_GDAL_stacking_and_interpolating/" class="dropdown-item">GDAL Stacking And Interpolating</a>
</li>
                                    
<li>
    <a href="../044_GDAL_Reconciling_projections/" class="dropdown-item">GDAL Reconciling Projections</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Modelling <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../050_Linear_models/" class="dropdown-item">Linear Models</a>
</li>
                                    
<li>
    <a href="../051_Modelling_and_optimisation/" class="dropdown-item">Modelling And Optimisation</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Developers <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../DEV_Local_Install/" class="dropdown-item">Local Install</a>
</li>
                                    
<li>
    <a href="../DEV_scripts/" class="dropdown-item">Scripts</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../031_Plotting/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../041_MODIS_download/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/UCL-EO/geog0111/edit/master/docs/040_GDAL.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#3-geospatial-processing-with-gdal" class="nav-link">3 Geospatial processing with gdal</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#31-modis-lai-product" class="nav-link">3.1 MODIS LAI product</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#312-gdal" class="nav-link">3.1.2 gdal</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#32-automatic-downloading-of-nasa-modis-products" class="nav-link">3.2 Automatic downloading of NASA MODIS products</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#33-gdal-masking" class="nav-link">3.3 GDAL masking</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#34-gdal-stacking-and-interpolating" class="nav-link">3.4 GDAL stacking and interpolating</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#3x-summary" class="nav-link">3.X Summary</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="3-geospatial-processing-with-gdal">3 Geospatial processing with <code>gdal</code></h1>
<h1>Table of Contents<span class="tocSkip"></span></h1>

<div class="toc"><ul class="toc-item"></ul></div>

<p><a href="https://gdal.org">GDAL</a> is the workhorse of geospatial processing. Basically, GDAL offers a common library to access a vast number of formats (if you want to see how vast, <a href="https://gdal.org/formats_list.html">check this</a>). In addition to letting you open and convert obscure formats to something more useful, a lot of functionality in terms of processing raster data is available (for example, working with projections, combining datasets, accessing remote datasets, etc).</p>
<p>For vector data, the counterpart to GDAL is OGR (which is now a part of the GDAL library anyway), which also supports <a href="https://gdal.org/ogr_formats.html">many vector formats</a>. The combination of both libraries is a very powerful tool to work with geospatial data, not only from Python, but from <a href="https://trac.osgeo.org/gdal/#GDALOGRInOtherLanguages">many other popular computer languages</a>.</p>
<p>In this session, we will introduce the <code>gdal</code> geospatial module which can read a wide range of raster scientific data formats. We will also introduce the related <code>ogr</code> vector package.</p>
<p>In pacticular, we will learn how to:</p>
<ul>
<li>access and download NASA geophysical datasets (specifically, the MODIS LAI/FPAR product)</li>
<li>apply a vector mask to the dataset</li>
<li>apply quality control flags to the data</li>
<li>stack datasets into a 3D numpy dataset for further analysis, including interpolation of missing values</li>
<li>visualise the data</li>
<li>store the stacked dataset</li>
</ul>
<p><strong>These are all tasks that you will be required to do for the formal assessment of this course. You will however be using a different NASA dataset.</strong></p>
<h2 id="31-modis-lai-product">3.1 MODIS LAI product</h2>
<p>To introduce geospatial processing, we will use a dataset from the MODIS LAI product over the UK. </p>
<p>You should note that the dataset you need to use for your assessed practical is a MODIS dataset with similar characteristics to the one in this example.</p>
<p>The data product <a href="https://modis.gsfc.nasa.gov/data/dataprod/mod15.php">MOD15</a> LAI/FPAR has been generated from NASA MODIS sensors Terra and Aqua data since 2002. We are now in dataset collection 6 (the data version to use).</p>
<pre><code>LAI is defined as the one-sided green leaf area per unit ground area in broadleaf canopies and as half the total needle surface area per unit ground area in coniferous canopies. FPAR is the fraction of photosynthetically active radiation (400-700 nm) absorbed by green vegetation. Both variables are used for calculating surface photosynthesis, evapotranspiration, and net primary production, which in turn are used to calculate terrestrial energy, carbon, water cycle processes, and biogeochemistry of vegetation. Algorithm refinements have improved quality of retrievals and consistency with field measurements over all biomes, with a focus on woody vegetation.
</code></pre>
<p>We use such data to map and understand about the dynamics of terrestrial vegetation / carbon, for example, for climate studies.</p>
<p>The raster data are arranged in tiles, indexed by row and column, to cover the globe:</p>
<p><img alt="MODIS tiles" src="https://www.researchgate.net/profile/J_Townshend/publication/220473201/figure/fig5/AS:277546596880390@1443183673583/The-global-MODIS-Sinusoidal-tile-grid.png" /></p>
<p><strong>Exercise 3.1.1</strong></p>
<p>The pattern on the tile names is <code>hXXvYY</code> where <code>XX</code> is the horizontal coordinate and <code>YY</code> the vertical.</p>
<ul>
<li>use the map above to work out the names of the two tiles that we will need to access data over the UK</li>
<li>set the variable <code>tiles</code> to contain these two names in a list</li>
</ul>
<p>For example, for the two tiles covering Madegascar, we would set:</p>
<pre><code>tiles = ['h22v10','h22v11']
</code></pre>
<pre><code class="python"># do exercise here
</code></pre>

<h3 id="311-nasa-earthdata-access">3.1.1 NASA Earthdata access</h3>
<h4 id="3111-register-at-nasa-earthdata">3.1.1.1 Register at NASA Earthdata</h4>
<p>Before you attempt to do this section, you will need to register at <a href="https://urs.earthdata.nasa.gov/home">NASA Earthdata</a>.</p>
<p>We have set up these notes so that you don't have to put your username and password in plain text. Instead, you need to enter your username and password when prompted by <code>cylog</code>. The password is stored in an encrypted file, although it can be accessed as plain text within your Python session.</p>
<p><strong>N.B. using <code>cylog().login()</code> is only intended to work with access to NASA Earthdata and to prevent you having to expose your username and password in these notes</strong>.</p>
<p><code>cylog().login()</code> returns the tuple <code>(username,password)</code> in plain text.</p>
<pre><code class="python">import geog0111.nasa_requests as nasa_requests
from geog0111.cylog import cylog
%matplotlib inline

url = 'https://e4ftl01.cr.usgs.gov/MOTA/MCD15A3H.006/2018.09.30/' 

# grab the HTML information
try:
    html = nasa_requests.get(url).text
    # test a few lines of the html
    if html[:20] == '&lt;!DOCTYPE HTML PUBLI':
        print('this seems to be ok ... ')
        print('use cylog().login() anywhere you need to specify the tuple (username,password)')
except:
    print('login error ... try entering your username password again')
    print('then re-run this cell until it works')
    cylog(init=True)
</code></pre>

<pre><code>this seems to be ok ... 
use cylog().login() anywhere you need to specify the tuple (username,password)
</code></pre>
<p>The NASA servers go down for weekly maintenance, usually on Wednesday afternoon (UK time), so you might not want to attempt this exercise then. </p>
<h2 id="312-gdal">3.1.2 <code>gdal</code></h2>
<p>We should now check to see if you have <code>gdal</code> properly installed.</p>
<pre><code class="python">import gdal
version = gdal.VersionInfo()  

if int(version) &gt;= 2020400:
    print('gdal ok',version)
else:
    print('gdal problem',version,'2.2.4+ expected')
</code></pre>

<pre><code>gdal ok 3000400
</code></pre>
<p>If there is a problem and you are on the geography system, we should be able to fix it for you. </p>
<p>If you are not on the geography system, try running:</p>
<pre><code>conda env update -f environment.yml
</code></pre>
<p>before going any further. If an update occurs, shutdown and restart your notebooks.</p>
<h2 id="32-automatic-downloading-of-nasa-modis-products">3.2 Automatic downloading of NASA MODIS products</h2>
<p>In <a href="../041_MODIS_download/">this section</a>, you will learn how to:</p>
<ul>
<li>scan the directories (on the Earthdata server) where the MODIS data are stored</li>
<li>get the dataset filename for a given tile, date and product</li>
<li>get to URL associated with the dataset</li>
<li>use the URL to pull the dataset over to store in the local file system</li>
</ul>
<h2 id="33-gdal-masking">3.3 GDAL masking</h2>
<p>In <a href="../042_GDAL_masking/">this section</a> you will learn how to:</p>
<ul>
<li>load locally stored files into gdal</li>
<li>select a particular dataset</li>
<li>form a virtual 'stitched' dataset from multiple files</li>
<li>apply a mask to the data from a vector boundary</li>
<li>crop the dataset </li>
</ul>
<h2 id="34-gdal-stacking-and-interpolating">3.4 GDAL stacking and interpolating</h2>
<p>In <a href="../043_GDAL_stacking_and_interpolating/">this section</a> you will learn how to:</p>
<ul>
<li>generate a numpy time series of spatial data</li>
<li>interpolate/smooth the dataset</li>
</ul>
<h2 id="3x-summary">3.X Summary</h2>
<p>In this session, we have learned to use some geospatial tools using GDAL in Python. A good set of <a href="http://jgomezdans.github.io/gdal_notes/">working notes on how to use GDAL</a> has been developed that you will find useful for further reading.</p>
<p>We have also very briefly introduced dealing with vector datasets in <code>ogr</code>, but this was mainly through the use of a pre-defined function that will take an ESRI shapefile (vector dataset), warp this to the projection of a raster dataset, and produce a mask for a given layer in the vector file.</p>
<p>If there is time in the class, we will develop some exercises to examine the datasets we have generated and/or to explore some different datasets or different locations.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
