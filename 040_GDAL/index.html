<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Prof P. Lewis">
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>GDAL - GEOG0111</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>
  <link href='https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "GDAL";
    var mkdocs_page_input_path = "040_GDAL.md";
    var mkdocs_page_url = "/geog0111/040_GDAL/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js" defer></script>
  <script src="../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-1347772-1', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> GEOG0111</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="tocbase current">
    
    
      


  <li class="navtree toctree-l1 inactive">
    <a class="" href="..">Introduction</a>
  </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">Course Basics</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../001_Notebook_use/">Notebook Use</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../002_Unix/">Unix</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../003_Help/">Help</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../004_Accounts/">Accounts</a>
  </li>
        
          
  <li class="navtree toctree-l2 label">
    <p class="caption">Answers</p>
  </li>


  

  
    <li class="navtree toctree-l2 group">
      <ul class="navtree subnav-l2 current">
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../001_Notebook_use_answers/">Notebook Use</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../002_Unix_answers/">Unix</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../003_Help_answers/">Help</a>
  </li>
        
      </ul>
    </li>
        
      </ul>
    </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">Core Concepts</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../010_Python_Introduction/">Python Introduction</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../011_Python_data_types/">Python Data Types</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../012_Python_strings/">Python Strings</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../013_Python_string_methods/">Python String Methods</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../014_Python_groups/">Python Groups</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../015_Python_control/">Python Control</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../016_Python_for/">Python For</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../017_Functions/">Functions</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../018_Packages/">Packages</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../019_Running_Python/">Running Python</a>
  </li>
        
          
  <li class="navtree toctree-l2 label">
    <p class="caption">Answers</p>
  </li>


  

  
    <li class="navtree toctree-l2 group">
      <ul class="navtree subnav-l2 current">
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../010_Python_Introduction_answers/">Python Introduction</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../011_Python_data_types_answers/">Python Data Types</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../012_Python_strings_answers/">Python Strings</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../013_Python_string_methods_answers/">Python String Methods</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../014_Python_groups_answers/">Python Groups</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../015_Python_control_answers/">Python Control</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../016_Python_for_answers/">Python For</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../017_Functions_answers/">Functions</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../019_Running_Python_answers/">Running Python</a>
  </li>
        
      </ul>
    </li>
        
      </ul>
    </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">Datasets</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../020_NASA_MODIS_Earthdata/">NASA MODIS Earthdata</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../020_Python_files/">Python Files</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../021_Read_files/">Read Files</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../022_NASA_MODIS_Earthdata/">NASA MODIS Earthdata</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../022_Pandas_and_plotting/">Pandas And Plotting</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../024_GoogleEarthEngine/">Google Earth Engine</a>
  </li>
        
          
  <li class="navtree toctree-l2 label">
    <p class="caption">Answers</p>
  </li>


  

  
    <li class="navtree toctree-l2 group">
      <ul class="navtree subnav-l2 current">
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../020_NASA_MODIS_Earthdata_answers/">NASA MODIS Earthdata</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../020_Python_files_answers/">Python Files</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../021_Read_files_answers/">Read Files</a>
  </li>
        
          


  <li class="navtree toctree-l3 inactive">
    <a class="" href="../022_NASA_MODIS_Earthdata_answers/">NASA MODIS Earthdata</a>
  </li>
        
      </ul>
    </li>
        
      </ul>
    </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">Image Processing</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../031_Numpy_matplotlib/">Numpy Matplotlib</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../031_Plotting/">Plotting</a>
  </li>
        
      </ul>
    </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">Geospatial Data</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  
    
    <li class="navtree toctree-l2 page current">
      <a class="current" href="./">
        GDAL
          <span class="toctree-expand"></span>
      </a>
    </li>
    
      

  <li class="toctree-l2 current with-children">
    <a href="#3-geospatial-processing-with-gdal">
      3 Geospatial processing with gdal
      <span class="toctree-expand"></span>
    </a>
  </li>



  <li class="toctree-l2 current">
    <ul class="subnav-l2 current">
    
      
          

  <li class="toctree-l3 current with-children">
    <a href="#31-modis-lai-product">
      3.1 MODIS LAI product
      <span class="toctree-expand"></span>
    </a>
  </li>



  <li class="toctree-l3 current">
    <ul class="subnav-l3 current">
    
      
          

  <li class="toctree-l4 current with-children">
    <a href="#311-nasa-earthdata-access">
      3.1.1 NASA Earthdata access
      <span class="toctree-expand"></span>
    </a>
  </li>



  <li class="toctree-l4 current">
    <ul class="subnav-l4 current">
    
      
        <li class="toctree-l5">
          <a class="toctree-l6" href="#3111-register-at-nasa-earthdata">3.1.1.1 Register at NASA Earthdata</a>
        </li>
    
    </ul>
  </li>

      
    
    </ul>
  </li>

      
    
      
        <li class="toctree-l3">
          <a class="toctree-l4" href="#312-gdal">3.1.2 gdal</a>
        </li>
    
      
        <li class="toctree-l3">
          <a class="toctree-l4" href="#32-automatic-downloading-of-nasa-modis-products">3.2 Automatic downloading of NASA MODIS products</a>
        </li>
    
      
        <li class="toctree-l3">
          <a class="toctree-l4" href="#33-gdal-masking">3.3 GDAL masking</a>
        </li>
    
      
        <li class="toctree-l3">
          <a class="toctree-l4" href="#34-gdal-stacking-and-interpolating">3.4 GDAL stacking and interpolating</a>
        </li>
    
      
        <li class="toctree-l3">
          <a class="toctree-l4" href="#3x-summary">3.X Summary</a>
        </li>
    
    </ul>
  </li>


  
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../041_MODIS_download/">MODIS Download</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../042_GDAL_masking/">GDAL Masking</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../043_GDAL_stacking_and_interpolating/">GDAL Stacking And Interpolating</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../044_GDAL_Reconciling_projections/">GDAL Reconciling Projections</a>
  </li>
        
      </ul>
    </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">Modelling</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../050_Linear_models/">Linear Models</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../051_Modelling_and_optimisation/">Modelling And Optimisation</a>
  </li>
        
      </ul>
    </li>
    
      
  <li class="navtree toctree-l1 label">
    <p class="caption">Developers</p>
  </li>


  

  
    <li class="navtree toctree-l1 group">
      <ul class="navtree subnav-l1 current">
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../DEV_Local_Install/">Local Install</a>
  </li>
        
          


  <li class="navtree toctree-l2 inactive">
    <a class="" href="../DEV_scripts/">Scripts</a>
  </li>
        
      </ul>
    </li>
    
  </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">GEOG0111</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Geospatial Data &raquo;</li>
        
      
    
    <li>GDAL</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/UCL-EO/geog0111/edit/master/docs/040_GDAL.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="3-geospatial-processing-with-gdal">3 Geospatial processing with <code>gdal</code></h1>
<h1>Table of Contents<span class="tocSkip"></span></h1>

<div class="toc"><ul class="toc-item"></ul></div>

<p><a href="https://gdal.org">GDAL</a> is the workhorse of geospatial processing. Basically, GDAL offers a common library to access a vast number of formats (if you want to see how vast, <a href="https://gdal.org/formats_list.html">check this</a>). In addition to letting you open and convert obscure formats to something more useful, a lot of functionality in terms of processing raster data is available (for example, working with projections, combining datasets, accessing remote datasets, etc).</p>
<p>For vector data, the counterpart to GDAL is OGR (which is now a part of the GDAL library anyway), which also supports <a href="https://gdal.org/ogr_formats.html">many vector formats</a>. The combination of both libraries is a very powerful tool to work with geospatial data, not only from Python, but from <a href="https://trac.osgeo.org/gdal/#GDALOGRInOtherLanguages">many other popular computer languages</a>.</p>
<p>In this session, we will introduce the <code>gdal</code> geospatial module which can read a wide range of raster scientific data formats. We will also introduce the related <code>ogr</code> vector package.</p>
<p>In pacticular, we will learn how to:</p>
<ul>
<li>access and download NASA geophysical datasets (specifically, the MODIS LAI/FPAR product)</li>
<li>apply a vector mask to the dataset</li>
<li>apply quality control flags to the data</li>
<li>stack datasets into a 3D numpy dataset for further analysis, including interpolation of missing values</li>
<li>visualise the data</li>
<li>store the stacked dataset</li>
</ul>
<p><strong>These are all tasks that you will be required to do for the formal assessment of this course. You will however be using a different NASA dataset.</strong></p>
<h2 id="31-modis-lai-product">3.1 MODIS LAI product</h2>
<p>To introduce geospatial processing, we will use a dataset from the MODIS LAI product over the UK. </p>
<p>You should note that the dataset you need to use for your assessed practical is a MODIS dataset with similar characteristics to the one in this example.</p>
<p>The data product <a href="https://modis.gsfc.nasa.gov/data/dataprod/mod15.php">MOD15</a> LAI/FPAR has been generated from NASA MODIS sensors Terra and Aqua data since 2002. We are now in dataset collection 6 (the data version to use).</p>
<pre><code>LAI is defined as the one-sided green leaf area per unit ground area in broadleaf canopies and as half the total needle surface area per unit ground area in coniferous canopies. FPAR is the fraction of photosynthetically active radiation (400-700 nm) absorbed by green vegetation. Both variables are used for calculating surface photosynthesis, evapotranspiration, and net primary production, which in turn are used to calculate terrestrial energy, carbon, water cycle processes, and biogeochemistry of vegetation. Algorithm refinements have improved quality of retrievals and consistency with field measurements over all biomes, with a focus on woody vegetation.
</code></pre>
<p>We use such data to map and understand about the dynamics of terrestrial vegetation / carbon, for example, for climate studies.</p>
<p>The raster data are arranged in tiles, indexed by row and column, to cover the globe:</p>
<p><img alt="MODIS tiles" src="https://www.researchgate.net/profile/J_Townshend/publication/220473201/figure/fig5/AS:277546596880390@1443183673583/The-global-MODIS-Sinusoidal-tile-grid.png" /></p>
<p><strong>Exercise 3.1.1</strong></p>
<p>The pattern on the tile names is <code>hXXvYY</code> where <code>XX</code> is the horizontal coordinate and <code>YY</code> the vertical.</p>
<ul>
<li>use the map above to work out the names of the two tiles that we will need to access data over the UK</li>
<li>set the variable <code>tiles</code> to contain these two names in a list</li>
</ul>
<p>For example, for the two tiles covering Madegascar, we would set:</p>
<pre><code>tiles = ['h22v10','h22v11']
</code></pre>
<pre><code class="python"># do exercise here
</code></pre>

<h3 id="311-nasa-earthdata-access">3.1.1 NASA Earthdata access</h3>
<h4 id="3111-register-at-nasa-earthdata">3.1.1.1 Register at NASA Earthdata</h4>
<p>Before you attempt to do this section, you will need to register at <a href="https://urs.earthdata.nasa.gov/home">NASA Earthdata</a>.</p>
<p>We have set up these notes so that you don't have to put your username and password in plain text. Instead, you need to enter your username and password when prompted by <code>cylog</code>. The password is stored in an encrypted file, although it can be accessed as plain text within your Python session.</p>
<p><strong>N.B. using <code>cylog().login()</code> is only intended to work with access to NASA Earthdata and to prevent you having to expose your username and password in these notes</strong>.</p>
<p><code>cylog().login()</code> returns the tuple <code>(username,password)</code> in plain text.</p>
<pre><code class="python">import geog0111.nasa_requests as nasa_requests
from geog0111.cylog import cylog
%matplotlib inline

url = 'https://e4ftl01.cr.usgs.gov/MOTA/MCD15A3H.006/2018.09.30/' 

# grab the HTML information
try:
    html = nasa_requests.get(url).text
    # test a few lines of the html
    if html[:20] == '&lt;!DOCTYPE HTML PUBLI':
        print('this seems to be ok ... ')
        print('use cylog().login() anywhere you need to specify the tuple (username,password)')
except:
    print('login error ... try entering your username password again')
    print('then re-run this cell until it works')
    cylog(init=True)
</code></pre>

<pre><code>this seems to be ok ... 
use cylog().login() anywhere you need to specify the tuple (username,password)
</code></pre>
<p>The NASA servers go down for weekly maintenance, usually on Wednesday afternoon (UK time), so you might not want to attempt this exercise then. </p>
<h2 id="312-gdal">3.1.2 <code>gdal</code></h2>
<p>We should now check to see if you have <code>gdal</code> properly installed.</p>
<pre><code class="python">import gdal
version = gdal.VersionInfo()  

if int(version) &gt;= 2020400:
    print('gdal ok',version)
else:
    print('gdal problem',version,'2.2.4+ expected')
</code></pre>

<pre><code>gdal ok 3000400
</code></pre>
<p>If there is a problem and you are on the geography system, we should be able to fix it for you. </p>
<p>If you are not on the geography system, try running:</p>
<pre><code>conda env update -f environment.yml
</code></pre>
<p>before going any further. If an update occurs, shutdown and restart your notebooks.</p>
<h2 id="32-automatic-downloading-of-nasa-modis-products">3.2 Automatic downloading of NASA MODIS products</h2>
<p>In <a href="../041_MODIS_download/">this section</a>, you will learn how to:</p>
<ul>
<li>scan the directories (on the Earthdata server) where the MODIS data are stored</li>
<li>get the dataset filename for a given tile, date and product</li>
<li>get to URL associated with the dataset</li>
<li>use the URL to pull the dataset over to store in the local file system</li>
</ul>
<h2 id="33-gdal-masking">3.3 GDAL masking</h2>
<p>In <a href="../042_GDAL_masking/">this section</a> you will learn how to:</p>
<ul>
<li>load locally stored files into gdal</li>
<li>select a particular dataset</li>
<li>form a virtual 'stitched' dataset from multiple files</li>
<li>apply a mask to the data from a vector boundary</li>
<li>crop the dataset </li>
</ul>
<h2 id="34-gdal-stacking-and-interpolating">3.4 GDAL stacking and interpolating</h2>
<p>In <a href="../043_GDAL_stacking_and_interpolating/">this section</a> you will learn how to:</p>
<ul>
<li>generate a numpy time series of spatial data</li>
<li>interpolate/smooth the dataset</li>
</ul>
<h2 id="3x-summary">3.X Summary</h2>
<p>In this session, we have learned to use some geospatial tools using GDAL in Python. A good set of <a href="http://jgomezdans.github.io/gdal_notes/">working notes on how to use GDAL</a> has been developed that you will find useful for further reading.</p>
<p>We have also very briefly introduced dealing with vector datasets in <code>ogr</code>, but this was mainly through the use of a pre-defined function that will take an ESRI shapefile (vector dataset), warp this to the projection of a raster dataset, and produce a mask for a given layer in the vector file.</p>
<p>If there is time in the class, we will develop some exercises to examine the datasets we have generated and/or to explore some different datasets or different locations.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../041_MODIS_download/" class="btn btn-neutral float-right" title="MODIS Download">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../031_Plotting/" class="btn btn-neutral" title="Plotting"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/UCL-EO/geog0111/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../031_Plotting/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../041_MODIS_download/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>

</body>
</html>
