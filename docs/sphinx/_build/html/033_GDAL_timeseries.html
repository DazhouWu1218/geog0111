
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>033 GDAL: time series &#8212; GEOG0111 Scientific Computing 1.0.1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="034 Weighted interpolation" href="034_Weigthed_smoothing_and_interpolation.html" />
    <link rel="prev" title="032 GDAL: mosaicing and masking" href="032_GDAL_mosaicing_and_masking.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="gdal-time-series">
<h1>033 GDAL: time series<a class="headerlink" href="#gdal-time-series" title="Permalink to this headline">¶</a></h1>
<div class="section" id="purpose">
<h2>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h2>
<p>In this section, we’ll continue to look at the MODIS LAI, with a view to forming a time series dataset. AT the end of this session, you will be able to generate a 3D numpy array of some MODIS geophysical variable for a selcted area and time.</p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="030_NASA_MODIS_Earthdata.html"><span class="doc">030_NASA_MODIS_Earthdata</span></a></p></li>
<li><p><a class="reference external" href="032_Numpy">031_Numpy</a></p></li>
<li><p><a class="reference internal" href="032_GDAL_mosaicing_and_masking.html"><span class="doc">032_GDAL_mosaicing_and_masking</span></a></p></li>
</ul>
<p>You must make sure you can recall the details of the work covered in <a class="reference external" href="030_GDAL_mosaicing_and_masking">030_GDAL_mosaicing_and_masking</a>. You will also need to know how to do <a class="reference internal" href="023_Plotting.html"><span class="doc">graph plotting</span></a>, including sub-figures and errorbars, and <a class="reference internal" href="024_Image_display.html"><span class="doc">image display</span></a>.</p>
</div>
<div class="section" id="test">
<h2>Test<a class="headerlink" href="#test" title="Permalink to this headline">¶</a></h2>
<p>You should run a <a class="reference internal" href="004_Accounts.html"><span class="doc">NASA account test</span></a> if you have not already done so.</p>
</div>
<div class="section" id="timeseries">
<h2>Timeseries<a class="headerlink" href="#timeseries" title="Permalink to this headline">¶</a></h2>
<p>We can conveniently generate a timeseries dataset using the <code class="docutils literal notranslate"><span class="pre">gdal</span></code> VRT file approach we used in <a class="reference external" href="027_GDAL_mosaicing_and_masking">027_GDAL_mosaicing_and_masking</a>.</p>
<p>In this case, the main process would be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">initialise</span> <span class="n">band</span> <span class="n">name</span> <span class="nb">list</span> <span class="n">bnames</span>
<span class="o">-</span> <span class="n">initialise</span> <span class="nb">list</span> <span class="n">sds_set</span>
<span class="o">-</span> <span class="n">loop</span> <span class="n">over</span> <span class="n">some</span> <span class="nb">set</span> <span class="n">of</span> <span class="n">doy</span> <span class="n">values</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">retrieve</span> <span class="n">an</span> <span class="n">SDS</span> <span class="k">for</span> <span class="n">each</span> <span class="n">doy</span>
    <span class="o">-</span> <span class="n">make</span> <span class="n">a</span> <span class="n">band</span> <span class="n">name</span> <span class="k">for</span> <span class="n">the</span> <span class="n">doy</span><span class="o">/</span><span class="n">year</span>
    <span class="o">-</span> <span class="n">stitch</span> <span class="n">tiles</span> <span class="n">together</span> <span class="n">into</span> <span class="n">one</span> <span class="n">VRT</span>
    <span class="o">-</span> <span class="n">append</span> <span class="n">the</span> <span class="n">new</span> <span class="n">SDS</span> <span class="n">to</span> <span class="n">the</span> <span class="nb">list</span> <span class="n">sds_set</span>
    <span class="o">-</span> <span class="n">append</span> <span class="n">the</span> <span class="n">band</span> <span class="n">name</span> <span class="n">to</span> <span class="n">the</span> <span class="nb">list</span> <span class="n">bnames</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdal</span>
<span class="kn">from</span> <span class="nn">geog0111.modis</span> <span class="kn">import</span> <span class="n">Modis</span>

<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;tile&#39;</span>      <span class="p">:</span>    <span class="p">[</span><span class="s1">&#39;h17v03&#39;</span><span class="p">,</span><span class="s1">&#39;h18v03&#39;</span><span class="p">],</span>
    <span class="s1">&#39;product&#39;</span>   <span class="p">:</span>    <span class="s1">&#39;MCD15A3H&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sds&#39;</span>       <span class="p">:</span>    <span class="s1">&#39;Lai_500m&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2019</span>
<span class="c1"># list of doys we want</span>
<span class="c1"># - every 4 days for MCD15A3H</span>
<span class="n">doys</span> <span class="o">=</span> <span class="p">[</span><span class="mi">41</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">49</span><span class="p">]</span>

<span class="n">modis</span> <span class="o">=</span> <span class="n">Modis</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="c1"># initialise list sds_set</span>
<span class="n">sds_set</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">bnames</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># loop over some set of doy values:</span>
<span class="k">for</span> <span class="n">doy</span> <span class="ow">in</span> <span class="n">doys</span><span class="p">:</span>
    <span class="c1"># retrieve an SDS for each doy</span>
    <span class="n">files</span><span class="p">,</span><span class="n">sds</span> <span class="o">=</span> <span class="n">modis</span><span class="o">.</span><span class="n">get_files</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">doy</span><span class="p">)</span>
    <span class="c1"># choose only the first SDS for now</span>
    <span class="n">this_sds</span> <span class="o">=</span> <span class="n">sds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="c1"># make a band name for the doy/year</span>
    <span class="n">bandname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">doy</span><span class="si">:</span><span class="s1">0&gt;3d</span><span class="si">}</span><span class="s1">&#39;</span>
    
    <span class="c1"># stitch tiles together into one VRT</span>
    <span class="c1"># called ofile</span>
    <span class="n">ofile</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;work/stitch_</span><span class="si">{</span><span class="n">modis</span><span class="o">.</span><span class="n">product</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">doy</span><span class="si">}</span><span class="s2">.vrt&quot;</span>
    <span class="n">stitch_vrt</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">BuildVRT</span><span class="p">(</span><span class="n">ofile</span><span class="p">,</span><span class="n">this_sds</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">stitch_vrt</span>
    <span class="c1"># append the new SDS to the list sds_set</span>
    <span class="n">sds_set</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ofile</span><span class="p">)</span>
    <span class="c1"># append the band name to the list bnames</span>
    <span class="n">bnames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bandname</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">sds_set</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">bnames</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;work/stitch_MCD15A3H.41.vrt&#39;</span><span class="p">,</span> <span class="s1">&#39;work/stitch_MCD15A3H.45.vrt&#39;</span><span class="p">,</span> <span class="s1">&#39;work/stitch_MCD15A3H.49.vrt&#39;</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;2019-041&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-045&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-049&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Now we have a set of SDS we want to put them into a VRT file to represent the time series. We do this as we have previously, specifying the outoput name <code class="docutils literal notranslate"><span class="pre">work/stitch_set.vrt</span></code> here, and ythe listr of SDS that goes in to the time series,<code class="docutils literal notranslate"><span class="pre">sds_set</span></code> here:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># build a VRT &quot;work/stitch_set.vrt&quot;</span>
<span class="n">stitch_vrt</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">BuildVRT</span><span class="p">(</span><span class="s2">&quot;work/stitch_set.vrt&quot;</span><span class="p">,</span> <span class="n">sds_set</span><span class="p">,</span><span class="n">separate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">del</span> <span class="n">stitch_vrt</span>
<span class="c1"># test it by reading and plotting</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;work/stitch_set.vrt&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2400</span><span class="p">,</span> <span class="mi">4800</span><span class="p">)</span>
</pre></div>
</div>
<p>The dataset is now 3D. The first dimensions represent the time samples, so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="n">bnames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>etc.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;band </span><span class="si">{</span><span class="n">bnames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1"> -&gt; mean </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">band</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">041</span> <span class="o">-&gt;</span> <span class="n">mean</span> <span class="mf">166.24298064236112</span>
<span class="n">band</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">045</span> <span class="o">-&gt;</span> <span class="n">mean</span> <span class="mf">166.25176796875</span>
<span class="n">band</span> <span class="mi">2019</span><span class="o">-</span><span class="mi">049</span> <span class="o">-&gt;</span> <span class="n">mean</span> <span class="mf">165.74304947916667</span>
</pre></div>
</div>
<div class="section" id="exercise-1">
<h3>Exercise 1<a class="headerlink" href="#exercise-1" title="Permalink to this headline">¶</a></h3>
<p>We have seen in <a class="reference external" href="027_GDAL_mosaicing_and_masking">027_GDAL_mosaicing_and_masking</a> that you can use <code class="docutils literal notranslate"><span class="pre">gdal</span></code> to creat a GeoTiff format image, for example with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Warp</span><span class="p">(</span><span class="n">output_name</span><span class="p">,</span> <span class="n">input_name</span> <span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;COMPRESS=LZW&#39;</span><span class="p">])</span>
<span class="n">g</span><span class="o">.</span><span class="n">FlushCache</span><span class="p">()</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Convert the <code class="docutils literal notranslate"><span class="pre">gdal</span></code> file <code class="docutils literal notranslate"><span class="pre">work/stitch_set.vrt</span></code> to a more portable GeoTiff file called <code class="docutils literal notranslate"><span class="pre">work/stitch_set.tif</span></code></p></li>
<li><p>Confirm that this has worked by reading and displaying data from the file</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ANSWER</span>
<span class="kn">import</span> <span class="nn">gdal</span>

<span class="c1"># Convert the `gdal` file `work/stitch_set.vrt` to a </span>
<span class="c1"># more portable GeoTiff file called `work/stitch_set.tif`</span>

<span class="c1"># set up the filenames</span>
<span class="n">infile</span> <span class="o">=</span> <span class="s1">&#39;work/stitch_set.vrt&#39;</span>
<span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;work/stitch_set.tif&#39;</span>

<span class="c1"># convert using gdal.Warp or similar</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Warp</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">infile</span> <span class="p">,</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;COMPRESS=LZW&#39;</span><span class="p">])</span>
<span class="c1"># force write to disk</span>
<span class="n">g</span><span class="o">.</span><span class="n">FlushCache</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1"># Confirm that this has worked by reading and </span>
<span class="c1"># displaying data from the file</span>

<span class="c1"># test it by reading and plotting</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="s2">&quot;work/stitch_set.tif&quot;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>\
                <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno_r</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">bnames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
<p><img alt="png" src="_images/033_GDAL_timeseries_11_0.png" /></p>
<p>Cut out the UK and visualise as before:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># subset and display</span>

<span class="n">warp_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;dstNodata&#39;</span>     <span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
    <span class="s1">&#39;format&#39;</span>        <span class="p">:</span> <span class="s1">&#39;MEM&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cropToCutline&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;cutlineWhere&#39;</span>  <span class="p">:</span> <span class="s2">&quot;FIPS=&#39;UK&#39;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;cutlineDSName&#39;</span> <span class="p">:</span> <span class="s1">&#39;data/TM_WORLD_BORDERS-0.3.shp&#39;</span>
<span class="p">}</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Warp</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;work/stitch_set.vrt&quot;</span><span class="p">,</span><span class="o">**</span><span class="n">warp_args</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span><span class="o">*</span><span class="mf">0.1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2623</span><span class="p">,</span> <span class="mi">1394</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>\
                <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno_r</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">bnames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
<p><img alt="png" src="_images/033_GDAL_timeseries_14_0.png" /></p>
</div>
<div class="section" id="modis-get-modis">
<h3><code class="docutils literal notranslate"><span class="pre">Modis.get_modis</span></code><a class="headerlink" href="#modis-get-modis" title="Permalink to this headline">¶</a></h3>
<p>For convenience, we can again use the function <code class="docutils literal notranslate"><span class="pre">Modis.get_modis</span></code> to combine these, simply by passing a list of <code class="docutils literal notranslate"><span class="pre">doy</span></code> values, rather than a single <code class="docutils literal notranslate"><span class="pre">doy</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdal</span>
<span class="kn">from</span> <span class="nn">geog0111.modis</span> <span class="kn">import</span> <span class="n">Modis</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;tile&#39;</span>      <span class="p">:</span>    <span class="p">[</span><span class="s1">&#39;h17v03&#39;</span><span class="p">,</span><span class="s1">&#39;h18v03&#39;</span><span class="p">],</span>
    <span class="s1">&#39;product&#39;</span>   <span class="p">:</span>    <span class="s1">&#39;MCD15A3H&#39;</span><span class="p">,</span>
    <span class="s1">&#39;sds&#39;</span>       <span class="p">:</span>    <span class="s1">&#39;Lai_500m&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2019</span>
<span class="c1"># list of doys we want</span>
<span class="n">doys</span> <span class="o">=</span> <span class="p">[</span><span class="mi">41</span><span class="p">,</span><span class="mi">45</span><span class="p">,</span><span class="mi">49</span><span class="p">]</span>

<span class="n">modis</span> <span class="o">=</span> <span class="n">Modis</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="n">warp_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;dstNodata&#39;</span>     <span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
    <span class="s1">&#39;format&#39;</span>        <span class="p">:</span> <span class="s1">&#39;MEM&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cropToCutline&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;cutlineWhere&#39;</span>  <span class="p">:</span> <span class="s2">&quot;FIPS=&#39;UK&#39;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;cutlineDSName&#39;</span> <span class="p">:</span> <span class="s1">&#39;data/TM_WORLD_BORDERS-0.3.shp&#39;</span>
<span class="p">}</span>

<span class="n">mfiles</span> <span class="o">=</span> <span class="n">modis</span><span class="o">.</span><span class="n">get_modis</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">doys</span><span class="p">,</span><span class="n">warp_args</span><span class="o">=</span><span class="n">warp_args</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mfiles</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dict_keys</span><span class="p">([</span><span class="s1">&#39;Fpar_500m&#39;</span><span class="p">,</span> <span class="s1">&#39;Lai_500m&#39;</span><span class="p">,</span> <span class="s1">&#39;FparLai_QC&#39;</span><span class="p">,</span> <span class="s1">&#39;FparExtra_QC&#39;</span><span class="p">,</span> <span class="s1">&#39;FparStdDev_500m&#39;</span><span class="p">,</span> <span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">,</span> <span class="s1">&#39;bandnames&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Now let’s mask out invalid data points (<code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">10.0</span></code> when scaled by 0.1), and display the results:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">])</span>

<span class="c1"># dataset and band nanes</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span><span class="o">*</span><span class="mf">0.1</span>

<span class="c1"># valid mask</span>
<span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">&gt;</span><span class="mf">10.0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">bnames</span> <span class="o">=</span> <span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;bandnames&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2623</span><span class="p">,</span> <span class="mi">1394</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>\
                <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno_r</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">bnames</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
<p><img alt="png" src="_images/033_GDAL_timeseries_19_0.png" /></p>
</div>
</div>
<div class="section" id="a-year-of-data">
<h2>A year of data<a class="headerlink" href="#a-year-of-data" title="Permalink to this headline">¶</a></h2>
<p>A convenient feature of <code class="docutils literal notranslate"><span class="pre">Modis.get_modis</span></code> is that we can use wildcards for specifying dates.</p>
<p>So, to get a year of LAI data for Luxembourg, we can specify <code class="docutils literal notranslate"><span class="pre">doys</span> <span class="pre">=</span> <span class="pre">&quot;*&quot;</span></code>. Note that we could have chosen any location, but we select a small country to make the running more feasible in a practical session.</p>
<p>If the data are already downloaded into the local cache, it should not take too long to form the time series. It will need to generate the VRT files for how every many files and tile you have requested, so that may take some tens of minutes, even if the HDF files are already generated.</p>
<p>If you are attempting to get data not already in the cache, it will take some considerable time to download these datasets for whole years, for multiple tiles.</p>
<p>If you want to download a dataset that is not covered in these notebooks, you are of course welcome to do so, but plan your work ahead of time, and try to pre-download the data before attempting any processing. In such a case, you should take some code such as that below and paste it into a Python file and run that as a Python scripy from a command line. You should make sure you set:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;verbose&#39;</span> <span class="p">:</span> <span class="kc">True</span>
</pre></div>
</div>
<p>in the <code class="docutils literal notranslate"><span class="pre">kwargs</span></code> dictionary. An example script you can modify is given in <a class="reference external" href="geog0111/get_lai.py">geog0111/get_lai.py</a>.</p>
<p>Since the dataset is quite large, we need to be efficient in our processing. We’ll create a small yaml database we will call <code class="docutils literal notranslate"><span class="pre">work/my_db.yml</span></code> to keep track of this.</p>
<p>So, before we try to generate the dataset, we check to see if it exists in the database.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># read the databse</span>
<span class="n">database</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data/my_db.yml&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">database</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">database</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
</pre></div>
</div>
<p>We need a key to store this configuratiuon under. Let’s choose:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># make a  key to describe this dataset</span>
<span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;MCD15A3H._h17v03_h18v03_h17v04_h18v04_.2019&quot;</span>

<span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;we dont need to process </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">we</span> <span class="n">dont</span> <span class="n">need</span> <span class="n">to</span> <span class="n">process</span> <span class="n">MCD15A3H</span><span class="o">.</span><span class="n">_h17v03_h18v03_h17v04_h18v04_</span><span class="o">.</span><span class="mi">2019</span>
</pre></div>
</div>
<p>We can now wrap this condition around our processing:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdal</span>
<span class="kn">from</span> <span class="nn">geog0111.modis</span> <span class="kn">import</span> <span class="n">Modis</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;tile&#39;</span>      <span class="p">:</span>    <span class="p">[</span><span class="s1">&#39;h17v03&#39;</span><span class="p">,</span><span class="s1">&#39;h18v03&#39;</span><span class="p">,</span><span class="s1">&#39;h17v04&#39;</span><span class="p">,</span><span class="s1">&#39;h18v04&#39;</span><span class="p">],</span>
    <span class="s1">&#39;product&#39;</span>   <span class="p">:</span>    <span class="s1">&#39;MCD15A3H&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2019</span>
<span class="c1"># list of doys we want</span>
<span class="n">doys</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>

<span class="c1"># we could generate this automatically from </span>
<span class="c1"># the information above ...</span>
<span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;MCD15A3H._h17v03_h18v03_h17v04_h18v04_.2019&quot;</span>

<span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;we dont need to process </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ifiles</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
<span class="k">else</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    We will gather the data for the year, </span>
<span class="sd">    tiles and product that we are interested in into a VRT file:</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">modis</span> <span class="o">=</span> <span class="n">Modis</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ifiles</span> <span class="o">=</span> <span class="n">modis</span><span class="o">.</span><span class="n">get_modis</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">doys</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    
    <span class="c1"># put in database</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="n">ifiles</span><span class="p">}</span>
    <span class="n">db</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
    <span class="c1"># write out</span>
    <span class="k">with</span> <span class="n">database</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">db</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>  
    
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">we</span> <span class="n">dont</span> <span class="n">need</span> <span class="n">to</span> <span class="n">process</span> <span class="n">MCD15A3H</span><span class="o">.</span><span class="n">_h17v03_h18v03_h17v04_h18v04_</span><span class="o">.</span><span class="mi">2019</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">ifiles</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dict_keys</span><span class="p">([</span><span class="s1">&#39;FparExtra_QC&#39;</span><span class="p">,</span> <span class="s1">&#39;FparLai_QC&#39;</span><span class="p">,</span> <span class="s1">&#39;FparStdDev_500m&#39;</span><span class="p">,</span> <span class="s1">&#39;Fpar_500m&#39;</span><span class="p">,</span> <span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">,</span> <span class="s1">&#39;Lai_500m&#39;</span><span class="p">,</span> <span class="s1">&#39;bandnames&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>We will then do all further processing using this file, rather than going through the <code class="docutils literal notranslate"><span class="pre">MODIS.get_modis</span></code> interface.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdal</span>

<span class="n">warp_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;dstNodata&#39;</span>     <span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
    <span class="s1">&#39;format&#39;</span>        <span class="p">:</span> <span class="s1">&#39;MEM&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cropToCutline&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;cutlineWhere&#39;</span>  <span class="p">:</span> <span class="s2">&quot;FIPS=&#39;LU&#39;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;cutlineDSName&#39;</span> <span class="p">:</span> <span class="s1">&#39;data/TM_WORLD_BORDERS-0.3.shp&#39;</span>
<span class="p">}</span>

<span class="n">sds</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">,</span><span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">,</span><span class="s1">&#39;FparLai_QC&#39;</span><span class="p">]</span>

<span class="c1"># loop over SDS sets and read into dictionary</span>
<span class="n">mfiles</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bandnames&#39;</span><span class="p">:</span><span class="n">ifiles</span><span class="p">[</span><span class="s1">&#39;bandnames&#39;</span><span class="p">]}</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sds</span><span class="p">:</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Warp</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">ifiles</span><span class="p">[</span><span class="n">s</span><span class="p">],</span><span class="o">**</span><span class="n">warp_args</span><span class="p">)</span>
    <span class="n">mfiles</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>
<span class="c1"># scale</span>
<span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.1</span>
<span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.1</span>
</pre></div>
</div>
<p>This is a little more long-winded than just using <code class="docutils literal notranslate"><span class="pre">modis.get_modis</span></code> each time, but it is a lot more efficient for such large datasets.</p>
<p>We can now plot the data on sub-plots:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno_r</span><span class="p">,</span>\
                       <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;bandnames&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
<p><img alt="png" src="_images/033_GDAL_timeseries_30_0.png" /></p>
<div class="section" id="plotting-time-series">
<h3>Plotting time series<a class="headerlink" href="#plotting-time-series" title="Permalink to this headline">¶</a></h3>
<p>We might now want to plot some time series.</p>
<p>First, extract the <code class="docutils literal notranslate"><span class="pre">doy</span></code> from <code class="docutils literal notranslate"><span class="pre">mfiles['bandnames']</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;bandnames&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;2019-001&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-005&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-009&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-013&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-017&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-021&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-025&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-029&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-033&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-037&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-041&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-045&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-049&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-053&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-057&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-061&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-065&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-069&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-073&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-077&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-081&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-085&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-089&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-093&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-097&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-101&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-105&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-109&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-113&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-117&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-121&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-125&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-129&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-133&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-137&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-141&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-145&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-149&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-153&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-157&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-161&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-165&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-169&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-173&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-177&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-181&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-185&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-189&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-193&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-197&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-201&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-205&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-209&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-213&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-217&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-221&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-225&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-229&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-233&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-237&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-241&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-245&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-249&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-253&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-257&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-261&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-265&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-269&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-273&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-277&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-281&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-285&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-289&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-293&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-297&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-301&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-305&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-309&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-313&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-317&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-321&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-325&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-329&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-333&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-337&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-341&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-345&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-349&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-353&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-357&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-361&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-365&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert to 1 by splitting the string</span>
<span class="n">test</span> <span class="o">=</span> <span class="s1">&#39;2019-001&#39;</span>
<span class="nb">int</span><span class="p">(</span><span class="n">test</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">doy</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;bandnames&#39;</span><span class="p">]]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">doy</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">137</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">173</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">193</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">205</span><span class="p">,</span> <span class="mi">209</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">217</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">225</span><span class="p">,</span> <span class="mi">229</span><span class="p">,</span> <span class="mi">233</span><span class="p">,</span> <span class="mi">237</span><span class="p">,</span> <span class="mi">241</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">249</span><span class="p">,</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">257</span><span class="p">,</span> <span class="mi">261</span><span class="p">,</span> <span class="mi">265</span><span class="p">,</span> <span class="mi">269</span><span class="p">,</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">277</span><span class="p">,</span> <span class="mi">281</span><span class="p">,</span> <span class="mi">285</span><span class="p">,</span> <span class="mi">289</span><span class="p">,</span> <span class="mi">293</span><span class="p">,</span> <span class="mi">297</span><span class="p">,</span> <span class="mi">301</span><span class="p">,</span> <span class="mi">305</span><span class="p">,</span> <span class="mi">309</span><span class="p">,</span> <span class="mi">313</span><span class="p">,</span> <span class="mi">317</span><span class="p">,</span> <span class="mi">321</span><span class="p">,</span> <span class="mi">325</span><span class="p">,</span> <span class="mi">329</span><span class="p">,</span> <span class="mi">333</span><span class="p">,</span> <span class="mi">337</span><span class="p">,</span> <span class="mi">341</span><span class="p">,</span> <span class="mi">345</span><span class="p">,</span> <span class="mi">349</span><span class="p">,</span> <span class="mi">353</span><span class="p">,</span> <span class="mi">357</span><span class="p">,</span> <span class="mi">361</span><span class="p">,</span> <span class="mi">365</span><span class="p">]</span>
</pre></div>
</div>
<p>It is interesting to see a set of sub-plots for a range of pixel locations. We can follow tghe approach we have taken to sub-plots previously, but now we want to make use of the 2D nature of the sub-plot <code class="docutils literal notranslate"><span class="pre">axs</span></code> variable (recall that previously we have flattened this to a 1D representation).</p>
<p>We will define a sub-plot shape: <code class="docutils literal notranslate"><span class="pre">shape=(10,10)</span></code> and a starting pixel <code class="docutils literal notranslate"><span class="pre">pixel</span> <span class="pre">=</span> <span class="pre">(100,70)</span></code>. We will then loop in row and column to produce the sub-plots:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>

<span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>

<span class="n">pixel</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">70</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">doy</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="n">pixel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">pixel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">j</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">][:,</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">])</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">p0</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">p1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># ensure the same scale for all</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="png" src="_images/033_GDAL_timeseries_36_0.png" /></p>
<div class="section" id="id1">
<h4>Exercise 1<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<ul>
<li><p>Write code that takes the information in:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;tile&#39;</span>      <span class="p">:</span>    <span class="p">[</span><span class="s1">&#39;h17v03&#39;</span><span class="p">,</span><span class="s1">&#39;h18v03&#39;</span><span class="p">,</span><span class="s1">&#39;h17v04&#39;</span><span class="p">,</span><span class="s1">&#39;h18v04&#39;</span><span class="p">],</span>
      <span class="s1">&#39;product&#39;</span>   <span class="p">:</span>    <span class="s1">&#39;MCD15A3H&#39;</span><span class="p">,</span>
  <span class="p">}</span>
  <span class="n">year</span> <span class="o">=</span> <span class="mi">2019</span>
  <span class="c1"># list of doys we want</span>
  <span class="n">doys</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
</pre></div>
</div>
</li>
</ul>
<p>and generates a key string of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;MCD15A3H._h17v03_h18v03_h17v04_h18v04_.2019&quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Write a function called <code class="docutils literal notranslate"><span class="pre">modis_annual_dataset</span></code>that takes <code class="docutils literal notranslate"><span class="pre">year</span></code>,<code class="docutils literal notranslate"><span class="pre">tile</span></code> and <code class="docutils literal notranslate"><span class="pre">product</span></code> and <code class="docutils literal notranslate"><span class="pre">step</span></code> and returns a dictionary of appropriate MODIS datasets.</p></li>
</ul>
<p>Your function should test to see if the dataset has already been stored in a database under a relevant key (such as that above).</p>
<ul>
<li><p>Write another function <code class="docutils literal notranslate"><span class="pre">get_modis_annual</span></code> that takes the dictionary of appropriate MODIS datasets. and generates a dictionary of MODIS data values, filtered according to information of the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">warp_args</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;dstNodata&#39;</span>     <span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
      <span class="s1">&#39;format&#39;</span>        <span class="p">:</span> <span class="s1">&#39;MEM&#39;</span><span class="p">,</span>
      <span class="s1">&#39;cropToCutline&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
      <span class="s1">&#39;cutlineWhere&#39;</span>  <span class="p">:</span> <span class="s2">&quot;FIPS=&#39;LU&#39;&quot;</span><span class="p">,</span>
      <span class="s1">&#39;cutlineDSName&#39;</span> <span class="p">:</span> <span class="s1">&#39;data/TM_WORLD_BORDERS-0.3.shp&#39;</span>
  <span class="p">}</span>

  <span class="n">sds</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">,</span><span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">,</span><span class="s1">&#39;FparLai_QC&#39;</span><span class="p">]</span>
</pre></div>
</div>
</li>
<li><p>Write a third function <code class="docutils literal notranslate"><span class="pre">modis_annual</span></code> that combines these two functions.</p></li>
<li><p>Test your code and ploit some results</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ANSWER</span>
<span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Write code that takes the information in:</span>

<span class="s1">  kwargs = {</span>
<span class="s1">      &#39;tile&#39;      :    [&#39;h17v03&#39;,&#39;h18v03&#39;,&#39;h17v04&#39;,&#39;h18v04&#39;],</span>
<span class="s1">      &#39;product&#39;   :    &#39;MCD15A3H&#39;,</span>
<span class="s1">  }</span>
<span class="s1">  year = 2019</span>
<span class="s1">  # list of doys we want</span>
<span class="s1">  doys = &quot;*&quot;</span>
<span class="s1">and generates a key string of the form:</span>

<span class="s1">    key = &quot;MCD15A3H._h17v03_h18v03_h17v04_h18v04_.2019&quot;</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;tile&#39;</span>      <span class="p">:</span>    <span class="p">[</span><span class="s1">&#39;h17v03&#39;</span><span class="p">,</span><span class="s1">&#39;h18v03&#39;</span><span class="p">,</span><span class="s1">&#39;h17v04&#39;</span><span class="p">,</span><span class="s1">&#39;h18v04&#39;</span><span class="p">],</span>
  <span class="s1">&#39;product&#39;</span>   <span class="p">:</span>    <span class="s1">&#39;MCD15A3H&#39;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2019</span>

<span class="c1"># first lets deal with the tile info</span>
<span class="n">t</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tile&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;test: </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">._</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;tile&quot;</span><span class="p">])</span><span class="si">}</span><span class="s1">_.</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;key: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">test</span><span class="p">:</span> <span class="n">h17v03_h18v03_h17v04_h18v04</span>

<span class="n">Write</span> <span class="n">code</span> <span class="n">that</span> <span class="n">takes</span> <span class="n">the</span> <span class="n">information</span> <span class="ow">in</span><span class="p">:</span>

  <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;tile&#39;</span>      <span class="p">:</span>    <span class="p">[</span><span class="s1">&#39;h17v03&#39;</span><span class="p">,</span><span class="s1">&#39;h18v03&#39;</span><span class="p">,</span><span class="s1">&#39;h17v04&#39;</span><span class="p">,</span><span class="s1">&#39;h18v04&#39;</span><span class="p">],</span>
      <span class="s1">&#39;product&#39;</span>   <span class="p">:</span>    <span class="s1">&#39;MCD15A3H&#39;</span><span class="p">,</span>
  <span class="p">}</span>
  <span class="n">year</span> <span class="o">=</span> <span class="mi">2019</span>
  <span class="c1"># list of doys we want</span>
  <span class="n">doys</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
<span class="ow">and</span> <span class="n">generates</span> <span class="n">a</span> <span class="n">key</span> <span class="n">string</span> <span class="n">of</span> <span class="n">the</span> <span class="n">form</span><span class="p">:</span>

    <span class="n">key</span> <span class="o">=</span> <span class="s2">&quot;MCD15A3H._h17v03_h18v03_h17v04_h18v04_.2019&quot;</span>

<span class="n">key</span><span class="p">:</span> <span class="n">MCD15A3H</span><span class="o">.</span><span class="n">_h17v03_h18v03_h17v04_h18v04_</span><span class="o">.</span><span class="mi">2019</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ANSWER</span>
<span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Write a function called modis_annual_dataset that takes </span>
<span class="s1">year,tile and product and step and  returns a dictionary of appropriate </span>
<span class="s1">MODIS datasets.</span>

<span class="s1">Your function should test to see if the dataset has already </span>
<span class="s1">been stored in a database under a relevant key (such as that above).</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">gdal</span>
<span class="kn">from</span> <span class="nn">geog0111.modis</span> <span class="kn">import</span> <span class="n">Modis</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="k">def</span> <span class="nf">modis_annual_dataset</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">tile</span><span class="p">,</span><span class="n">product</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>\
                         <span class="n">dbfile</span><span class="o">=</span><span class="s1">&#39;data/my_db.yml&#39;</span><span class="p">):</span>
    <span class="c1"># load into kwargs</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;tile&#39;</span>      <span class="p">:</span>    <span class="nb">list</span><span class="p">(</span><span class="n">tile</span><span class="p">),</span>
    <span class="s1">&#39;product&#39;</span>   <span class="p">:</span>    <span class="n">product</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="c1"># list of doys we want</span>
    <span class="n">doys</span> <span class="o">=</span> <span class="s2">&quot;*&quot;</span>
    
    <span class="c1"># read the database</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dbfile</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">database</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">with</span> <span class="n">database</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">db</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
            
    <span class="c1"># from above    </span>
    <span class="n">key</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">._</span><span class="si">{</span><span class="s2">&quot;_&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;tile&quot;</span><span class="p">])</span><span class="si">}</span><span class="s1">_.</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">db</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;we dont need to process </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ifiles</span> <span class="o">=</span> <span class="n">db</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        We will gather the data for the year, </span>
<span class="sd">        tiles and product that we are interested in into a VRT file:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">modis</span> <span class="o">=</span> <span class="n">Modis</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ifiles</span> <span class="o">=</span> <span class="n">modis</span><span class="o">.</span><span class="n">get_modis</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">doys</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>

        <span class="c1"># put in database</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="p">:</span> <span class="n">ifiles</span><span class="p">}</span>
        <span class="n">db</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">cache</span><span class="p">)</span>
        <span class="c1"># write out</span>
        <span class="k">with</span> <span class="n">database</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">safe_dump</span><span class="p">(</span><span class="n">db</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>  
        
    <span class="k">return</span> <span class="n">ifiles</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ANSWER</span>

<span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">Write another function get_modis_annual that </span>
<span class="s1">takes the dictionary of appropriate MODIS datasets. </span>
<span class="s1">and generates a dictionary of MODIS data values, </span>
<span class="s1">filtered according to information of the form:</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="k">def</span> <span class="nf">get_modis_annual</span><span class="p">(</span><span class="n">ifiles</span><span class="p">,</span><span class="n">sds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">warp_args</span><span class="o">=</span><span class="p">{}):</span>
    <span class="c1"># loop over SDS sets and read into dictionary</span>
    <span class="n">mfiles</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bandnames&#39;</span><span class="p">:</span><span class="n">ifiles</span><span class="p">[</span><span class="s1">&#39;bandnames&#39;</span><span class="p">]}</span>
    <span class="k">del</span> <span class="n">ifiles</span><span class="p">[</span><span class="s1">&#39;bandnames&#39;</span><span class="p">]</span>
    
    <span class="c1"># useful sds default</span>
    <span class="k">if</span> <span class="n">sds</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">sds</span> <span class="o">=</span> <span class="n">ifiles</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sds</span><span class="p">:</span>
        <span class="c1"># do this in case we dont need to cut</span>
        <span class="k">if</span> <span class="n">warp_args</span> <span class="o">!=</span> <span class="p">{}:</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Warp</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">ifiles</span><span class="p">[</span><span class="n">s</span><span class="p">],</span><span class="o">**</span><span class="n">warp_args</span><span class="p">)</span>
            <span class="n">mfiles</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mfiles</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">ifiles</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">mfiles</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write a third function modis_annual </span>
<span class="c1"># that combines these two functions.</span>

<span class="k">def</span> <span class="nf">modis_annual</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">tile</span><span class="p">,</span><span class="n">product</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>\
                 <span class="n">sds</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">warp_args</span><span class="o">=</span><span class="p">{},</span>\
                 <span class="n">dbfile</span><span class="o">=</span><span class="s1">&#39;data/my_db.yml&#39;</span><span class="p">):</span>
    
    <span class="n">ifiles</span> <span class="o">=</span> <span class="n">modis_annual_dataset</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">tile</span><span class="p">,</span><span class="n">product</span><span class="p">,</span>\
                         <span class="n">dbfile</span><span class="o">=</span><span class="n">dbfile</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">)</span>
    <span class="n">mfiles</span> <span class="o">=</span> <span class="n">get_modis_annual</span><span class="p">(</span><span class="n">ifiles</span><span class="p">,</span><span class="n">sds</span><span class="o">=</span><span class="n">sds</span><span class="p">,</span><span class="n">warp_args</span><span class="o">=</span><span class="n">warp_args</span><span class="p">)</span>
    <span class="c1"># what to do is SDS is None?</span>
    <span class="k">return</span> <span class="n">mfiles</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ANSWER : Test</span>

<span class="n">warp_args</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;dstNodata&#39;</span>     <span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
  <span class="s1">&#39;format&#39;</span>        <span class="p">:</span> <span class="s1">&#39;MEM&#39;</span><span class="p">,</span>
  <span class="s1">&#39;cropToCutline&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
  <span class="s1">&#39;cutlineWhere&#39;</span>  <span class="p">:</span> <span class="s2">&quot;FIPS=&#39;LU&#39;&quot;</span><span class="p">,</span>
  <span class="s1">&#39;cutlineDSName&#39;</span> <span class="p">:</span> <span class="s1">&#39;data/TM_WORLD_BORDERS-0.3.shp&#39;</span>
<span class="p">}</span>
<span class="n">sds</span>     <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">,</span><span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">,</span><span class="s1">&#39;FparLai_QC&#39;</span><span class="p">]</span>
<span class="n">tile</span>    <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;h17v03&#39;</span><span class="p">,</span><span class="s1">&#39;h18v03&#39;</span><span class="p">,</span><span class="s1">&#39;h17v04&#39;</span><span class="p">,</span><span class="s1">&#39;h18v04&#39;</span><span class="p">]</span>
<span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;MCD15A3H&#39;</span>
<span class="n">year</span>    <span class="o">=</span> <span class="mi">2019</span>
<span class="n">step</span>    <span class="o">=</span> <span class="mi">4</span>

<span class="n">mfiles</span> <span class="o">=</span> <span class="n">modis_annual</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">tile</span><span class="p">,</span><span class="n">product</span><span class="p">,</span><span class="n">sds</span><span class="o">=</span><span class="n">sds</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span><span class="n">warp_args</span><span class="o">=</span><span class="n">warp_args</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mfiles</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">we</span> <span class="n">dont</span> <span class="n">need</span> <span class="n">to</span> <span class="n">process</span> <span class="n">MCD15A3H</span><span class="o">.</span><span class="n">_h17v03_h18v03_h17v04_h18v04_</span><span class="o">.</span><span class="mi">2019</span>
<span class="n">dict_keys</span><span class="p">([</span><span class="s1">&#39;bandnames&#39;</span><span class="p">,</span> <span class="s1">&#39;Lai_500m&#39;</span><span class="p">,</span> <span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">,</span> <span class="s1">&#39;FparLai_QC&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="uncertainty-and-weighting">
<h2>Uncertainty and weighting<a class="headerlink" href="#uncertainty-and-weighting" title="Permalink to this headline">¶</a></h2>
<p>The full set of SDS available is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;Fpar_500m&#39;</span><span class="p">,</span>
 <span class="s1">&#39;Lai_500m&#39;</span><span class="p">,</span>
 <span class="s1">&#39;FparLai_QC&#39;</span><span class="p">,</span>
 <span class="s1">&#39;FparExtra_QC&#39;</span><span class="p">,</span>
 <span class="s1">&#39;FparStdDev_500m&#39;</span><span class="p">,</span>
 <span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>We should always examine any uncertainty information available when trying to interpret a dataset. In this exercise, we will take the uncertainty, defined as a standard deviation, and generate a weight from this in the form:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">W</span>  <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">std</span> <span class="o">*</span> <span class="n">std</span><span class="p">)</span>
</pre></div>
</div>
<p>where std is the uncertainty. Where this weighting is high, we can put more emphasis on the reliability of the data than when it is low.</p>
<p>First then, read all SDS:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdal</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">geog0111.modis_annual</span> <span class="kn">import</span> <span class="n">modis_annual</span>

<span class="n">warp_args</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;dstNodata&#39;</span>     <span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
  <span class="s1">&#39;format&#39;</span>        <span class="p">:</span> <span class="s1">&#39;MEM&#39;</span><span class="p">,</span>
  <span class="s1">&#39;cropToCutline&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
  <span class="s1">&#39;cutlineWhere&#39;</span>  <span class="p">:</span> <span class="s2">&quot;FIPS=&#39;LU&#39;&quot;</span><span class="p">,</span>
  <span class="s1">&#39;cutlineDSName&#39;</span> <span class="p">:</span> <span class="s1">&#39;data/TM_WORLD_BORDERS-0.3.shp&#39;</span>
<span class="p">}</span>
<span class="n">sds</span>     <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">,</span><span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">,</span><span class="s1">&#39;FparLai_QC&#39;</span><span class="p">]</span>
<span class="n">tile</span>    <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;h17v03&#39;</span><span class="p">,</span><span class="s1">&#39;h18v03&#39;</span><span class="p">,</span><span class="s1">&#39;h17v04&#39;</span><span class="p">,</span><span class="s1">&#39;h18v04&#39;</span><span class="p">]</span>
<span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;MCD15A3H&#39;</span>
<span class="n">year</span>    <span class="o">=</span> <span class="mi">2019</span>
    
<span class="n">mfiles</span> <span class="o">=</span> <span class="n">modis_annual</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">tile</span><span class="p">,</span><span class="n">product</span><span class="p">,</span><span class="n">sds</span><span class="o">=</span><span class="n">sds</span><span class="p">,</span><span class="n">warp_args</span><span class="o">=</span><span class="n">warp_args</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">mfiles</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">we</span> <span class="n">dont</span> <span class="n">need</span> <span class="n">to</span> <span class="n">process</span> <span class="n">MCD15A3H</span><span class="o">.</span><span class="n">_h17v03_h18v03_h17v04_h18v04_</span><span class="o">.</span><span class="mi">2019</span>
<span class="n">dict_keys</span><span class="p">([</span><span class="s1">&#39;bandnames&#39;</span><span class="p">,</span> <span class="s1">&#39;Lai_500m&#39;</span><span class="p">,</span> <span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">,</span> <span class="s1">&#39;FparLai_QC&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># scale</span>
<span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.1</span>
<span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.1</span>
</pre></div>
</div>
<p>There is a feature in the <code class="docutils literal notranslate"><span class="pre">LaiStdDev_500m</span></code> dataset where some pixels have apparently zero uncertainty. Indeed, all LAI values with an uncertainty under 1.0 seem suspect as individual values. So we treat them hear, to set all values less than 1 to 1.</p>
<p>We know that LAI values over 10 (100 * 0.1) are invalid, so we should make sure these are also weighted zero:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">])</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">]</span>

<span class="c1"># fix low values</span>
<span class="n">std</span><span class="p">[</span><span class="n">std</span><span class="o">&lt;</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">std</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">weight</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">std</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">weight</span><span class="p">[</span><span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">weight</span><span class="p">[</span><span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="c1"># look at some stats</span>
<span class="nb">print</span><span class="p">(</span><span class="n">weight</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">weight</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">0.0</span> <span class="mf">1.0</span>
</pre></div>
</div>
<p>We can now go ahead and plot the dataset and the weights. We switch to a greyscale colourmap to make the interpretation of numbers easier.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># produce image plots of the both quantities</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;LAI Luxembourg 2019&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>\
                       <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;bandnames&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
<p><img alt="png" src="_images/033_GDAL_timeseries_50_0.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the weight</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
<span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;LAI weight Luxembourg 2019&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">weight</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">,</span>\
                       <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;bandnames&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
<p><img alt="png" src="_images/033_GDAL_timeseries_51_0.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># LAI time series</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">doy</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;bandnames&#39;</span><span class="p">]]</span>

<span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>

<span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>

<span class="n">pixel</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">70</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">doy</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="n">pixel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">pixel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">j</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">][:,</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">])</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">p0</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">p1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># ensure the same scale for all</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="png" src="_images/033_GDAL_timeseries_52_0.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># weight time series plots </span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">doy</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;bandnames&#39;</span><span class="p">]]</span>

<span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>

<span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>

<span class="n">pixel</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">70</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">doy</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="n">pixel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">pixel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">j</span>
        <span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">weight</span><span class="p">[:,</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">])</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">p0</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">p1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># ensure the same scale for all</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="png" src="_images/033_GDAL_timeseries_53_0.png" /></p>
<p>We can look at an individual plot now, and use the weights for error bars.</p>
<p>In this case, we want to convert the array <code class="docutils literal notranslate"><span class="pre">weight</span></code> to an array <code class="docutils literal notranslate"><span class="pre">error</span></code>, applying the opposite of what we did above to get standard deviation, and multiplying by <a class="reference external" href="https://en.wikipedia.org/wiki/1.96">1.96</a>.</p>
<p>We want to avoid the division <code class="docutils literal notranslate"><span class="pre">1/0</span></code>, so we first build an array the same as weight, but fiulled with zero values:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
</pre></div>
</div>
<p>and then only do the division for the mask <code class="docutils literal notranslate"><span class="pre">weight&gt;0</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">error</span><span class="p">[</span><span class="n">weight</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">weight</span><span class="p">[</span><span class="n">weight</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="p">))</span> <span class="o">*</span> <span class="mf">1.97</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
<span class="n">error</span><span class="p">[</span><span class="n">weight</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">weight</span><span class="p">[</span><span class="n">weight</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="p">))</span> <span class="o">*</span> <span class="mf">1.97</span>

<span class="n">doy</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;bandnames&#39;</span><span class="p">]]</span>
<span class="n">p0</span><span class="p">,</span><span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">107</span><span class="p">,</span><span class="mi">72</span><span class="p">)</span>
<span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>

<span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="p">))</span>

<span class="n">pixel</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">70</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">doy</span>

<span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">][:,</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">],</span><span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">[:,</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">]</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">p0</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">p1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># ensure the same scale for all</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;DOY 2019&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;LAI&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;LAI&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="png" src="_images/033_GDAL_timeseries_55_1.png" /></p>
<p>We might question the validity of some of the LAI uncertainty here: we expect LAI to have a smnooth trajectory in time, but that is clearly not always the case here. However, they provide a traceable estimate of the reliability of each individual measurement and are useful in that respect.</p>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>We now know how to combine geospatial data in both space and time VRT files using <code class="docutils literal notranslate"><span class="pre">gdal</span></code>. Remember that we can also do such things using <code class="docutils literal notranslate"><span class="pre">numpy</span></code>, but if we are able to keep the geospatial information and other metadata in a <code class="docutils literal notranslate"><span class="pre">gdal</span></code> file, so much the better. We have seen how to write the dataset to a portable file format such as GeoTiff.</p>
<p>We have seen that some datasets such as the MODIS LAI product come with a per-pixel estimate of uncertainty. We have investigated this data field and used it to provide a weighting to associate with the reliability of each pixel. We have written a function <code class="docutils literal notranslate"><span class="pre">modis_annual</span></code> that uses a yaml database to see if it needs to reconstruct a large annual datafile.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">GEOG0111 Scientific Computing</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="docindex.html">GEOG0111</a></li>
<li class="toctree-l1"><a class="reference internal" href="docindex.html#geog0111-scientific-computing">GEOG0111 Scientific Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="001_Notebook_use.html">001 Use of Jupyter notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="002_Unix.html">002 Some basic UNIX</a></li>
<li class="toctree-l1"><a class="reference internal" href="003_Help.html">003 Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="004_Accounts.html">004 Setup, Accounts and logins</a></li>
<li class="toctree-l1"><a class="reference internal" href="005_Packages.html">005 Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="001_Notebook_use_answers.html">001 Use of Jupyter notebooks : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="002_Unix_answers.html">002 Some basic UNIX : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="003_Help_answers.html">003 Help : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="010_Python_Introduction.html">010 Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="011_Python_data_types.html">011 Python data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="012_Python_strings.html">012 String formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="013_Python_string_methods.html">013 String methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="014_Python_groups.html">014 Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="015_Python_control.html">015 Control in Python: <code class="docutils literal notranslate"><span class="pre">if</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="016_Python_for.html">016 More control in Python: <code class="docutils literal notranslate"><span class="pre">for</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="017_Functions.html">Functions in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="018_Running_Python.html">018 Python codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="010_Python_Introduction_answers.html">010 Introduction to Python : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="011_Python_data_types_answers.html">011 Python data types : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="012_Python_strings_answers.html">012 String formatting : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="013_Python_string_methods_answers.html">013 String methods : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="014_Python_groups_answers.html">014 Groups : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="015_Python_control_answers.html">015 Control in Python: <code class="docutils literal notranslate"><span class="pre">if</span></code> : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="016_Python_for_answers.html">016 More control in Python: <code class="docutils literal notranslate"><span class="pre">for</span></code> : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="017_Functions_answers.html">Functions in Python : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="018_Running_Python_answers.html">018 Python codes : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="020_Python_files.html">020 Files and other Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="021_Streams.html">021 Streams</a></li>
<li class="toctree-l1"><a class="reference internal" href="022_Read_write_files.html">022 Read and Write: URLs and files</a></li>
<li class="toctree-l1"><a class="reference internal" href="023_Plotting.html">Plotting Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="024_Image_display.html">024 Image display</a></li>
<li class="toctree-l1"><a class="reference internal" href="020_Python_files_answers.html">020 Files and other Resources : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="021_Streams_answers.html">021 Streams : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="022_Read_write_files_answers.html">022 Read and Write: URLs and files : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="023_Plotting_answers.html">Plotting Graphs : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="024_Image_display_answers.html">024 Image display : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="030_NASA_MODIS_Earthdata.html">030 NASA MODIS Earthdata</a></li>
<li class="toctree-l1"><a class="reference internal" href="030_NASA_MODIS_Earthdata.html#summary">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="031_Numpy.html">031 Manipulating data: <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="032_GDAL_mosaicing_and_masking.html">032 GDAL: mosaicing and masking</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">033 GDAL: time series</a></li>
<li class="toctree-l1"><a class="reference internal" href="034_Weigthed_smoothing_and_interpolation.html">034 Weighted interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="035_Weighted_interpolation.html">035 Weighted interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="036_Model_Fitting.html">036 Model Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="030_NASA_MODIS_Earthdata_answers.html">030 NASA MODIS Earthdata : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="031_Numpy_answers.html">031 Manipulating data: <code class="docutils literal notranslate"><span class="pre">numpy</span></code> : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="032_GDAL_mosaicing_and_masking_answers.html">032 GDAL: mosaicing and masking : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="040_Practical_Part1.html">Assessed Practical</a></li>
<li class="toctree-l1"><a class="reference internal" href="041_Practical_Part2.html">041 Assessed Practical</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="032_GDAL_mosaicing_and_masking.html" title="previous chapter">032 GDAL: mosaicing and masking</a></li>
      <li>Next: <a href="034_Weigthed_smoothing_and_interpolation.html" title="next chapter">034 Weighted interpolation</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, P. Lewis and J. Gomez-Dans.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/033_GDAL_timeseries.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>