
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3.6 Reconciling projections &#8212; GEOG0111 Scientific Computing 1.0.1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Table of Contents" href="050_Linear_models.html" />
    <link rel="prev" title="3.4 Stacking and interpolating data" href="043_GDAL_stacking_and_interpolating.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="reconciling-projections">
<h1>3.6 Reconciling projections<a class="headerlink" href="#reconciling-projections" title="Permalink to this headline">¶</a></h1>
<h1>Table of Contents<span class="tocSkip"></span></h1>
<div class="toc"><ul class="toc-item"><li><span><a href="#3.6-Reconciling-projections" data-toc-modified-id="3.6-Reconciling-projections-1">3.6 Reconciling projections</a></span><ul class="toc-item"><li><span><a href="#3.6.1-Introduction" data-toc-modified-id="3.6.1-Introduction-1.1">3.6.1 Introduction</a></span></li><li><span><a href="#3.6.1.1-Projections" data-toc-modified-id="3.6.1.1-Projections-1.2">3.6.1.1 Projections</a></span></li><li><span><a href="#3.6.1.2-Changing-Projections" data-toc-modified-id="3.6.1.2-Changing-Projections-1.3">3.6.1.2 Changing Projections</a></span></li><li><span><a href="#3.6.2-Requirements" data-toc-modified-id="3.6.2-Requirements-1.4">3.6.2 Requirements</a></span><ul class="toc-item"><li><span><a href="#3.6.2.1-Run-the-pre-requisite-scripts" data-toc-modified-id="3.6.2.1-Run-the-pre-requisite-scripts-1.4.1">3.6.2.1 Run the pre-requisite scripts</a></span></li></ul></li><li><span><a href="#3.6.3-Reconcile-the-datasets" data-toc-modified-id="3.6.3-Reconcile-the-datasets-1.5">3.6.3 Reconcile the datasets</a></span><ul class="toc-item"><li><span><a href="#3.6.3.1-load-an-exemplar-dataset" data-toc-modified-id="3.6.3.1-load-an-exemplar-dataset-1.5.1">3.6.3.1 load an exemplar dataset</a></span></li><li><span><a href="#3.6.3.2-get-information-from-source-file" data-toc-modified-id="3.6.3.2-get-information-from-source-file-1.5.2">3.6.3.2 get information from source file</a></span></li><li><span><a href="#3.6.3.4-reprojection" data-toc-modified-id="3.6.3.4-reprojection-1.5.3">3.6.3.4 reprojection</a></span></li><li><span><a href="#3.6.3.5-crop" data-toc-modified-id="3.6.3.5-crop-1.5.4">3.6.3.5 crop</a></span></li></ul></li><li><span><a href="#3.6.3.6-Putting-this-together" data-toc-modified-id="3.6.3.6-Putting-this-together-1.6">3.6.3.6 Putting this together</a></span></li><li><span><a href="#3.6.6-Summary" data-toc-modified-id="3.6.6-Summary-1.7">3.6.6 Summary</a></span></li></ul></li></ul></div><div class="section" id="introduction">
<h2>3.6.1 Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This section of notes is optional to the course, and the tutor may decide <em>not</em> to go through this in class.</p>
<p>That said, the information and examples contained here can be very useful for accessing and processing certain types of geospatial data.</p>
<p>In particular, we deal with obtaining climate data records from <a class="reference external" href="http://apps.ecmwf.int/datasets/data/era40-daily/levtype=sfc">ECMWF</a> that we will later use for model fitting. These data come in a <a class="reference external" href="https://confluence.ecmwf.int/display/CKB/What+are+NetCDF+files+and+how+can+I+read+them">netcdf</a> format (commonly used for climate data) with a grid in latitude/longitude. To ‘overlay’ these data with another dataset (e.g. the MODIS LAI product that we have been using) in a different (equal area) projection, we use the <code class="docutils literal notranslate"><span class="pre">gdal</span></code> function</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gdal</span><span class="o">.</span><span class="n">ReprojectImage</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">src_proj</span><span class="p">,</span> <span class="n">dst_proj</span><span class="p">,</span> <span class="n">interp</span><span class="p">)</span>
</pre></div>
</div>
<p>where:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">src</span>      <span class="p">:</span> <span class="n">a</span> <span class="n">source</span> <span class="n">dataset</span> <span class="n">that</span> <span class="n">we</span> <span class="n">want</span> <span class="n">to</span> <span class="n">process</span> 
<span class="n">dst</span>      <span class="p">:</span> <span class="n">a</span> <span class="n">blank</span> <span class="n">destination</span> <span class="n">dataset</span> <span class="n">that</span> <span class="n">we</span> <span class="nb">set</span> <span class="n">up</span> <span class="k">with</span> <span class="n">the</span> 
           <span class="n">required</span> <span class="p">(</span><span class="n">output</span><span class="p">)</span> <span class="n">data</span> <span class="nb">type</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="ow">and</span> <span class="n">geotransform</span> <span class="ow">and</span> <span class="n">projection</span>
<span class="n">src_proj</span> <span class="p">:</span> <span class="n">the</span> <span class="n">source</span> <span class="n">dataset</span> <span class="n">projection</span> <span class="n">wkt</span> 
<span class="n">dst_proj</span> <span class="p">:</span> <span class="n">the</span> <span class="n">destination</span> <span class="n">projection</span> <span class="n">wkt</span> 
<span class="n">interp</span>   <span class="p">:</span> <span class="n">the</span> <span class="n">required</span> <span class="n">interpolation</span> <span class="n">method</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">gdalconst</span><span class="o">.</span><span class="n">GRA_Bilinear</span>
</pre></div>
</div>
<p>where wkt stands for <a class="reference external" href="https://en.wikipedia.org/wiki/Well-known_text">well known text</a> and is a projection format string.</p>
<p>Other codes we use are ones we have developed earlier.</p>
<p>In these notes, we will learn:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">how</span> <span class="n">to</span> <span class="n">access</span> <span class="n">an</span> <span class="n">ECMWF</span> <span class="n">daily</span> <span class="n">climate</span> <span class="n">dataset</span> <span class="p">(</span><span class="kn">from</span> <span class="nn">ERA</span> <span class="n">interim</span><span class="p">)</span>
<span class="o">*</span> <span class="n">how</span> <span class="n">to</span> <span class="n">reproject</span> <span class="n">the</span> <span class="n">dataset</span> <span class="n">to</span> <span class="n">match</span> <span class="n">another</span> <span class="n">spatial</span> <span class="n">dataset</span> <span class="p">(</span><span class="n">MODIS</span> <span class="n">LAI</span><span class="p">)</span>
</pre></div>
</div>
<p>We will then save some datasets that we will use later in the notes. For this reason, it’s possile to skip this section, and return to it later.</p>
</div>
<div class="section" id="projections">
<h2>3.6.1.1 Projections<a class="headerlink" href="#projections" title="Permalink to this headline">¶</a></h2>
<p>For various reasons, different geospatial datasets will come in different <a class="reference external" href="http://desktop.arcgis.com/en/arcmap/10.3/guide-books/map-projections/what-are-map-projections.htm">projections</a>.</p>
<p>Considering for example, satellite-derived data from Low Earth Orbit <a class="reference external" href="https://en.wikipedia.org/wiki/Low_Earth_orbit">LEO</a>, the satellite sensor will typically obtain image data in a swath as it passes over the Earth surface. Projected onto the Earth surface, this appears as a strip of data:</p>
<p><img alt="https://earthobservatory.nasa.gov/Features/LDCMLongSwath" src="_images/long_swath_map_720.png" /></p>
<p>but in the satellite data recording system, the data are stored as a regular array. We call such satellite data ‘swath’ (or ‘swath-like’) data (in the satellite imager coordinate system) and we may obtain data products in anything up to <a class="reference external" href="https://earthdata.nasa.gov/earth-science-data-systems-program/policies/data-information-policy/data-levels">Level 2</a> in such a form.</p>
<p>These data are often difficult for data scientists to deal with. They generally prefer to have a dataset mapped to a uniform space-time grid, even though this may involve some re-sampling, which can sometimes result in loss of information. The convenience of a uniform space-time grid means that you can. for example, look at dynamic features (information over time).</p>
<p>The properties of the ‘uniform space-time grid’ will depend on <a class="reference external" href="http://desktop.arcgis.com/en/arcmap/10.3/tools/coverage-toolbox/choosing-a-map-projection.htm">user requirements</a>. For some, it is important to have an <a class="reference external" href="https://www.giss.nasa.gov/tools/gprojector/help/projections/">equal area projection</a>, one where the ‘pixel size’ is consistent throughout the dataset.</p>
<p><img alt="https://www.giss.nasa.gov/tools/gprojector/hehttps://www.giss.nasa.gov/tools/gprojector/help/projections/CylindricalEqualArea.png" src="_images/CylindricalEqualArea.png" /></p>
<p>even if this is not convenient for viewing some areas of the Earth (map projections are very political!).</p>
<p>Or other factors may be more important, such as user familiarity with a simple latitude/longitude grid typically used by climate scientists.</p>
<p><img alt="https://www.giss.nasa.gov/tools/gprojector/help/projections/CylindricalStereographic.png" src="_images/CylindricalStereographic.png" /></p>
<p>For others, a conformal projection (preserving angles, as a cost of distance distortion) may be vital.</p>
<p><img alt="https://www.giss.nasa.gov/tools/gprojector/help/projections/AdamsHemisphereInASquare.png" src="_images/AdamsHemisphereInASquare.png" /></p>
<p>We have see that MODIS data products, for example, come described in an equal area sinusoidal grid:</p>
<p><img alt="https://www.giss.nasa.gov/tools/gprojector/help/projections/Sinusoidal.png" src="_images/Sinusoidal.png" />.</p>
<p>but the data for high latitudes and longitudes appears very distorted.</p>
<p>We must accept then, that dealing with geospatial data must involve some understanding of projections, as well as practically, how to convert datasets between different projections.</p>
<p><strong>Earth shape</strong></p>
<p>One factor that can make life even more complicated than using just different projections is the use of different assumptions about the Earth shape (e.g. sphere, spheroid, radius variations). Often, the particular assumptions used by a group of users is just a result of history: it is what has ‘traditionally’ used for that purpose. It can be seen as too bothersome or expensive to change this.</p>
<p>Since we can convert between different projections though, we can also deal with different Earth shape assumptions. We just have to be very clear about what was assumed. If at all possible, the geospatial datasets themselves should contain a full description of the projection and Earth shape assumed, but this is not always the case.</p>
<p>The datasets we will mostly be dealing are in the following projections:</p>
<ul>
<li><p>MODIS Sinusoidal (<a class="reference external" href="https://github.com/SciTools/cartopy/blob/master/lib/cartopy/tests/crs/test_sinusoidal.py">tested</a>), which assumes a custom spherical Earth of radius 6371007.181 m. In <code class="docutils literal notranslate"><span class="pre">cartopy</span></code> this is given as <a class="reference external" href="https://github.com/SciTools/cartopy/blob/master/lib/cartopy/crs.py">Sinusoidal.MODIS</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="c1"># MODIS data products use a Sinusoidal projection of a spherical Earth</span>
  <span class="c1"># http://modis-land.gsfc.nasa.gov/GCTP.html</span>
  <span class="n">Sinusoidal</span><span class="o">.</span><span class="n">MODIS</span> <span class="o">=</span> <span class="n">Sinusoidal</span><span class="p">(</span><span class="n">globe</span><span class="o">=</span><span class="n">Globe</span><span class="p">(</span><span class="n">ellipse</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                        <span class="n">semimajor_axis</span><span class="o">=</span><span class="mf">6371007.181</span><span class="p">,</span>
                                        <span class="n">semiminor_axis</span><span class="o">=</span><span class="mf">6371007.181</span><span class="p">))</span>
</pre></div>
</div>
<p>In the MODIS data hdf products, the projection information is stored directly. Extracted as a wkt, this is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="p">[[</span><span class="n">PROJCS</span><span class="p">[</span><span class="s2">&quot;unnamed&quot;</span><span class="p">,</span>
     <span class="n">GEOGCS</span><span class="p">[</span><span class="s2">&quot;Unknown datum based upon the custom spheroid&quot;</span><span class="p">,</span>
         <span class="n">DATUM</span><span class="p">[</span><span class="s2">&quot;Not_specified_based_on_custom_spheroid&quot;</span><span class="p">,</span>
             <span class="n">SPHEROID</span><span class="p">[</span><span class="s2">&quot;Custom spheroid&quot;</span><span class="p">,</span><span class="mf">6371007.181</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span>
     <span class="n">PRIMEM</span><span class="p">[</span><span class="s2">&quot;Greenwich&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
     <span class="n">UNIT</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span><span class="mf">0.0174532925199433</span><span class="p">]],</span>
 <span class="n">PROJECTION</span><span class="p">[</span><span class="s2">&quot;Sinusoidal&quot;</span><span class="p">],</span>
 <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;longitude_of_center&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
 <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;false_easting&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
 <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;false_northing&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
 <span class="n">UNIT</span><span class="p">[</span><span class="s2">&quot;metre&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;9001&quot;</span><span class="p">]]]</span>
</pre></div>
</div>
<p>According to <a class="reference external" href="http://spatialreference.org/ref/sr-org/6965/">SR-ORG</a>, the MODIS projection uses a spherical projection ellipsoid but a WGS84 datum ellipsoid. This is not quite the same as the definition in the wkt above.</p>
<p>It is also defined by SR-ORG with the EPSG code <a class="reference external" href="http://spatialreference.org/ref/sr-org/6974/">6974</a> for software that can use <code class="docutils literal notranslate"><span class="pre">semi_major</span></code> and <code class="docutils literal notranslate"><span class="pre">semi_minor</span></code> projection definitions.</p>
<p>Some software may use the simpler <a class="reference external" href="http://spatialreference.org/ref/sr-org/6965/">6965</a> definition (or the older <a class="reference external" href="http://spatialreference.org/ref/sr-org/6842/">6842</a>).</p>
<p>The MODIS projection 6974 is given as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">PROJCS</span><span class="p">[</span><span class="s2">&quot;MODIS Sinusoidal&quot;</span><span class="p">,</span>
      <span class="n">GEOGCS</span><span class="p">[</span><span class="s2">&quot;WGS 84&quot;</span><span class="p">,</span>
          <span class="n">DATUM</span><span class="p">[</span><span class="s2">&quot;WGS_1984&quot;</span><span class="p">,</span>
              <span class="n">SPHEROID</span><span class="p">[</span><span class="s2">&quot;WGS 84&quot;</span><span class="p">,</span><span class="mi">6378137</span><span class="p">,</span><span class="mf">298.257223563</span><span class="p">,</span>
                  <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;7030&quot;</span><span class="p">]],</span>
          <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;6326&quot;</span><span class="p">]],</span>
      <span class="n">PRIMEM</span><span class="p">[</span><span class="s2">&quot;Greenwich&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
          <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;8901&quot;</span><span class="p">]],</span>
      <span class="n">UNIT</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span><span class="mf">0.01745329251994328</span><span class="p">,</span>
          <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;9122&quot;</span><span class="p">]],</span>
      <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;4326&quot;</span><span class="p">]],</span>
  <span class="n">PROJECTION</span><span class="p">[</span><span class="s2">&quot;Sinusoidal&quot;</span><span class="p">],</span>
  <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;false_easting&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span>
  <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;false_northing&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span>
  <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;central_meridian&quot;</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span>
  <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;semi_major&quot;</span><span class="p">,</span><span class="mf">6371007.181</span><span class="p">],</span>
  <span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;semi_minor&quot;</span><span class="p">,</span><span class="mf">6371007.181</span><span class="p">],</span>
  <span class="n">UNIT</span><span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],</span>
  <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;SR-ORG&quot;</span><span class="p">,</span><span class="s2">&quot;6974&quot;</span><span class="p">]]</span>
</pre></div>
</div>
<p>None of these codes are defined in <code class="docutils literal notranslate"><span class="pre">gdal</span></code> (see files in $GDAL_DATA/*.wkt for details), so to use them, we have to take the file from <a class="reference external" href="http://spatialreference.org/ref/sr-org/6974/ogcwkt/">SR-ORG</a>.</p>
<p>For the datasets we are using, it makes no real difference whether the projection information from the file is used instead of MODIS projection 6974, so we will use that from the file. For other areas and especially for any higher spatial resolution datasets, it is worth investigating which is more appropriate.</p>
</li>
<li><p>ECMWF netcdf format (derived from GRIB) <a class="reference external" href="https://www.ecmwf.int/en/forecasts/datasets/archive-datasets/reanalysis-datasets/era-interim">ERA Interim</a> climate datasets (1979-Present). These are geographic coordinates (latitude/longitude) in a custom spheroid with a radius 6371200 m.</p></li>
</ul>
<p>This information can be obtained from any example of a GRIB file, as we shall see below. As a wkt, this is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="p">[</span><span class="s1">&#39;GEOGCS[&quot;Coordinate System imported from GRIB file&quot;,</span>
    <span class="n">DATUM</span><span class="p">[</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span><span class="n">SPHEROID</span><span class="p">[</span><span class="s2">&quot;Sphere&quot;</span><span class="p">,</span><span class="mi">6371200</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span>
    <span class="n">PRIMEM</span><span class="p">[</span><span class="s2">&quot;Greenwich&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">UNIT</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span><span class="mf">0.0174532925199433</span><span class="p">]]</span><span class="s1">&#39;]</span>
</pre></div>
</div>
<ul>
<li><p>A more common spheroid to use is <a class="reference external" href="https://confluence.qps.nl/qinsy/en/world-geodetic-system-1984-wgs84-29855173.html">WGS84</a>, although even in that case there are multiple ‘realisations’ available (used mainly by the DoD). Users should generally implement that given in EPSG code <a class="reference external" href="http://spatialreference.org/ref/epsg/4326/">4326</a> used by the GPS system, for example.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="p">[</span><span class="n">GEOGCS</span><span class="p">[</span><span class="s2">&quot;WGS 84&quot;</span><span class="p">,</span>
      <span class="n">DATUM</span><span class="p">[</span><span class="s2">&quot;WGS_1984&quot;</span><span class="p">,</span>
          <span class="n">SPHEROID</span><span class="p">[</span><span class="s2">&quot;WGS 84&quot;</span><span class="p">,</span><span class="mi">6378137</span><span class="p">,</span><span class="mf">298.257223563</span><span class="p">,</span>
              <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;7030&quot;</span><span class="p">]],</span>
          <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;6326&quot;</span><span class="p">]],</span>
      <span class="n">PRIMEM</span><span class="p">[</span><span class="s2">&quot;Greenwich&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span>
          <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;8901&quot;</span><span class="p">]],</span>
      <span class="n">UNIT</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span><span class="mf">0.01745329251994328</span><span class="p">,</span>
          <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;9122&quot;</span><span class="p">]],</span>
      <span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;4326&quot;</span><span class="p">]]]</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="changing-projections">
<h2>3.6.1.2 Changing Projections<a class="headerlink" href="#changing-projections" title="Permalink to this headline">¶</a></h2>
<p>We can conveniently use the Python <a class="reference external" href="https://scitools.org.uk/cartopy/docs/v0.16/"><code class="docutils literal notranslate"><span class="pre">cartopy</span></code></a> package to explore projections.</p>
<p>We download an image taken from the satellite sensor (<a class="reference external" href="https://www.esa.int/Our_Activities/Observing_the_Earth/Meteosat/SEVIRI">SEVIRI</a>):</p>
<p><img alt="http://www.esa.int/spaceinimages/Images/2005/12/Artist_s_view_of_SEVIRI_in_orbit" src="_images/Artist_s_view_of_SEVIRI_in_orbit_node_full_image_2.png" /></p>
<p>The sensor builds up images of the Earth disc from geostationarty orbit, actioned by the platform spin.</p>
<p><img alt="http://www.esa.int/spaceinimages/Images/2015/08/MSG-4_Europe_s_latest_weather_satellite_delivers_first_image" src="_images/MSG-4_Europe_s_latest_weather_satellite_delivers_first_image_node_full_image_2.png" /></p>
<p>In the code below, we plot the dataset in the ‘earth disk’ (Orthographic) projection, then re-map it to the equal area Sinusoidal projection.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">urllib2</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">are_you_sure</span> <span class="o">=</span> <span class="kc">False</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">=====================================================</span>
<span class="sd">Don&#39;t run this cell in class as it will take too long!</span>

<span class="sd">                 Use it for homework</span>
<span class="sd">                 set are_you_sure = True</span>
<span class="sd">=====================================================</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">from https://scitools.org.uk/cartopy/docs/v0.16/\</span>
<span class="sd">            gallery/geostationary.html#sphx-glr-gallery-geostationary-py</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="k">def</span> <span class="nf">geos_image</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return a specific SEVIRI image by retrieving it from a github gist URL.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    img : numpy array</span>
<span class="sd">        The pixels of the image in a numpy array.</span>
<span class="sd">    img_proj : cartopy CRS</span>
<span class="sd">        The rectangular coordinate system of the image.</span>
<span class="sd">    img_extent : tuple of floats</span>
<span class="sd">        The extent of the image ``(x0, y0, x1, y1)`` referenced in</span>
<span class="sd">        the ``img_proj`` coordinate system.</span>
<span class="sd">    origin : str</span>
<span class="sd">        The origin of the image to be passed through to matplotlib&#39;s imshow.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;https://gist.github.com/pelson/5871263/raw/&#39;</span>
           <span class="s1">&#39;EIDA50_201211061300_clip2.png&#39;</span><span class="p">)</span>
    <span class="n">img_handle</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">img_handle</span><span class="p">)</span>
    <span class="n">img_proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Geostationary</span><span class="p">(</span><span class="n">satellite_height</span><span class="o">=</span><span class="mi">35786000</span><span class="p">)</span>
    <span class="n">img_extent</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">5500000</span><span class="p">,</span> <span class="mi">5500000</span><span class="p">,</span> <span class="o">-</span><span class="mi">5500000</span><span class="p">,</span> <span class="mi">5500000</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">img</span><span class="p">,</span> <span class="n">img_proj</span><span class="p">,</span> <span class="n">img_extent</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span>

<span class="k">if</span> <span class="n">are_you_sure</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Retrieving image...&#39;</span><span class="p">)</span>
    <span class="n">img</span><span class="p">,</span> <span class="n">crs</span><span class="p">,</span> <span class="n">extent</span><span class="p">,</span> <span class="n">origin</span> <span class="o">=</span> <span class="n">geos_image</span><span class="p">()</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span>\
                         <span class="n">ccrs</span><span class="o">.</span><span class="n">Orthographic</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_global</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span>\
                         <span class="n">ccrs</span><span class="o">.</span><span class="n">Sinusoidal</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> \
                            <span class="n">false_easting</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">false_northing</span><span class="o">=</span><span class="mf">0.0</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_global</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Projecting and plotting image (this may take a while)...&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Retrieving</span> <span class="n">image</span><span class="o">...</span>
<span class="n">Projecting</span> <span class="ow">and</span> <span class="n">plotting</span> <span class="n">image</span> <span class="p">(</span><span class="n">this</span> <span class="n">may</span> <span class="n">take</span> <span class="n">a</span> <span class="k">while</span><span class="p">)</span><span class="o">...</span>
</pre></div>
</div>
<p><img alt="png" src="_images/044_GDAL_Reconciling_projections_6_1.png" /></p>
<p><img alt="png" src="_images/044_GDAL_Reconciling_projections_6_2.png" /></p>
<p>The full list of <a class="reference external" href="https://scitools.org.uk/cartopy/docs/v0.16/crs/projections.html"><code class="docutils literal notranslate"><span class="pre">cartopy</span></code> projections</a> is quite entensive.</p>
<p><strong>Exercise 3.6.1</strong> Extra Homework</p>
<ul class="simple">
<li><p>Explore some different types of projection using <code class="docutils literal notranslate"><span class="pre">cartopy</span></code> and make a note of their features.</p></li>
<li><p>Read up (follow the links in the text above) on projections.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#do exercise here</span>
</pre></div>
</div>
</div>
<div class="section" id="requirements">
<h2>3.6.2 Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
<p>We will need to:</p>
<ul class="simple">
<li><p>make sure we have the MODIS LAI dataset locally</p></li>
<li><p>read them in for a given country.</p></li>
<li><p>register with ecmwf, install ecmwfapi</p></li>
<li><p>get the temperature datasset from ECMWF for 2006 and 2017 for Europe</p></li>
<li><p>get the country borders shapefile</p></li>
</ul>
<p><strong>Set up the conditions</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># required general imports</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">gdal</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Set the country code and year to be used here</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">country_code</span> <span class="o">=</span> <span class="s1">&#39;UK&#39;</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2017</span>
<span class="n">shpfile</span> <span class="o">=</span> <span class="s2">&quot;data/TM_WORLD_BORDERS-0.3.shp&quot;</span>
</pre></div>
</div>
<div class="section" id="run-the-pre-requisite-scripts">
<h3>3.6.2.1 Run the pre-requisite scripts<a class="headerlink" href="#run-the-pre-requisite-scripts" title="Permalink to this headline">¶</a></h3>
<p><strong>Make sure you register with ECMWF</strong></p>
<ul>
<li><p>register with ECMWF and install the API</p>
<p>Follow the <a class="reference external" href="https://confluence.ecmwf.int/display/WEBAPI/Access+ECMWF+Public+Datasets">ECMWF instructions</a></p>
</li>
</ul>
<p><strong>Sort data prerequisities</strong></p>
<ul>
<li><p>Run the codes in the <a class="reference internal" href="#"><span class="doc">prerequisites section</span></a></p>
<p>OR</p>
</li>
<li><p>Run the [prerequisites script]:</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span># install ecmwf api -- do this once only
ECMWF = &#39;https://software.ecmwf.int/wiki/download/attachments/56664858/ecmwf-api-client-python.tgz&#39;
try:
    from ecmwfapi import ECMWFDataServer
except:
    try:
        !pip install $ECMWF
    except:
        # on Unix/Linux
        !pip install --user $ECMWF
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span># just make sure the pre-requisites are run
%run geog0111/Chapter3_6A_prerequisites.py $country_code $year
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;geog0111/Chapter3_6A_prerequisites.py&#39;</span><span class="p">,</span> <span class="s1">&#39;UK&#39;</span><span class="p">,</span> <span class="s1">&#39;2017&#39;</span><span class="p">]</span> <span class="mi">2017</span> <span class="n">UK</span>
<span class="n">Looking</span> <span class="k">for</span> <span class="n">match</span> <span class="n">to</span> <span class="n">sample</span>  <span class="mi">2017</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">Looking</span> <span class="k">for</span> <span class="n">match</span> <span class="n">to</span> <span class="n">sample</span>  <span class="mi">2017</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">10</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">Looking</span> <span class="k">for</span> <span class="n">match</span> <span class="n">to</span> <span class="n">sample</span>  <span class="mi">2017</span><span class="o">-</span><span class="mi">03</span><span class="o">-</span><span class="mi">22</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">Looking</span> <span class="k">for</span> <span class="n">match</span> <span class="n">to</span> <span class="n">sample</span>  <span class="mi">2017</span><span class="o">-</span><span class="mi">05</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">Looking</span> <span class="k">for</span> <span class="n">match</span> <span class="n">to</span> <span class="n">sample</span>  <span class="mi">2017</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">10</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">Looking</span> <span class="k">for</span> <span class="n">match</span> <span class="n">to</span> <span class="n">sample</span>  <span class="mi">2017</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">20</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">Looking</span> <span class="k">for</span> <span class="n">match</span> <span class="n">to</span> <span class="n">sample</span>  <span class="mi">2017</span><span class="o">-</span><span class="mi">08</span><span class="o">-</span><span class="mi">29</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">Looking</span> <span class="k">for</span> <span class="n">match</span> <span class="n">to</span> <span class="n">sample</span>  <span class="mi">2017</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">08</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">Looking</span> <span class="k">for</span> <span class="n">match</span> <span class="n">to</span> <span class="n">sample</span>  <span class="mi">2017</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">17</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="n">Looking</span> <span class="k">for</span> <span class="n">match</span> <span class="n">to</span> <span class="n">sample</span>  <span class="mi">2017</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">27</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
<span class="mf">18.45137418797783</span>
<span class="mf">0.19862203366558234</span>
<span class="p">(</span><span class="mi">2624</span><span class="p">,</span> <span class="mi">1396</span><span class="p">,</span> <span class="mi">92</span><span class="p">)</span> <span class="p">(</span><span class="mi">2624</span><span class="p">,</span> <span class="mi">1396</span><span class="p">,</span> <span class="mi">92</span><span class="p">)</span>
<span class="n">interpolating</span> <span class="o">...</span>
<span class="p">(</span><span class="mi">2624</span><span class="p">,</span> <span class="mi">1396</span><span class="p">,</span> <span class="mi">92</span><span class="p">)</span>
<span class="n">saving</span> <span class="o">...</span>
<span class="n">europe_data_2016_2017</span><span class="o">.</span><span class="n">nc</span> <span class="n">exists</span>
<span class="n">GEOGCS</span><span class="p">[</span><span class="s2">&quot;Coordinate System imported from GRIB file&quot;</span><span class="p">,</span><span class="n">DATUM</span><span class="p">[</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span><span class="n">SPHEROID</span><span class="p">[</span><span class="s2">&quot;Sphere&quot;</span><span class="p">,</span><span class="mi">6371200</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span><span class="n">PRIMEM</span><span class="p">[</span><span class="s2">&quot;Greenwich&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">UNIT</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span><span class="mf">0.0174532925199433</span><span class="p">]]</span>
<span class="n">Refreshing</span> <span class="n">nc</span> <span class="n">file</span> <span class="n">europe_data_2016_2017</span><span class="o">.</span><span class="n">nc</span>
<span class="n">data</span><span class="o">/</span><span class="n">europe_data_2016</span><span class="o">.</span><span class="n">nc</span>
<span class="n">data</span><span class="o">/</span><span class="n">europe_data_2017</span><span class="o">.</span><span class="n">nc</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># read in the LAI data for given country code</span>
<span class="n">tiles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]:</span>
        <span class="n">tiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;h</span><span class="si">{</span><span class="n">h</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">v</span><span class="si">{</span><span class="n">v</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
<span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;lai_data_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">.npz&#39;</span>
<span class="n">ofile</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">/</span><span class="n">fname</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># read data from npz file</span>
    <span class="n">lai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ofile</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lai</span><span class="p">[</span><span class="s1">&#39;lai&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ofile</span><span class="si">}</span><span class="s2"> doesn&#39;t exist: sort the pre-requisites&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">2624</span><span class="p">,</span> <span class="mi">1396</span><span class="p">,</span> <span class="mi">92</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># a quick look at some stats to see if there are data there</span>
<span class="c1"># and they are sensible</span>
<span class="n">lai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ofile</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lai</span><span class="p">[</span><span class="s1">&#39;lai&#39;</span><span class="p">][</span><span class="mi">1000</span><span class="p">,</span><span class="mi">700</span><span class="p">]),</span>\
      <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lai</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">][</span><span class="mi">1000</span><span class="p">,</span><span class="mi">700</span><span class="p">]))</span>
<span class="c1"># does it have the interpolated value?</span>
<span class="k">if</span> <span class="s1">&#39;interpolated_lai&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">lai</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lai</span><span class="p">[</span><span class="s1">&#39;interpolated_lai&#39;</span><span class="p">][</span><span class="mi">1000</span><span class="p">,</span><span class="mi">700</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">1.1</span> <span class="mf">1.1</span> <span class="mf">1.2</span> <span class="mf">0.9</span> <span class="mf">0.9</span> <span class="mf">1.2</span> <span class="mf">1.</span>  <span class="mf">0.8</span> <span class="mf">1.4</span> <span class="mf">0.3</span> <span class="mf">0.</span>  <span class="mf">0.5</span> <span class="mf">0.3</span> <span class="mf">0.9</span> <span class="mf">0.6</span> <span class="mf">1.</span>  <span class="mf">0.7</span> <span class="mf">0.5</span>
 <span class="mf">0.7</span> <span class="mf">0.6</span> <span class="mf">1.3</span> <span class="mf">0.7</span> <span class="mf">0.1</span> <span class="mf">1.</span>  <span class="mf">1.</span>  <span class="mf">0.6</span> <span class="mf">1.1</span> <span class="mf">0.5</span> <span class="mf">1.1</span> <span class="mf">1.</span>  <span class="mf">1.1</span> <span class="mf">1.1</span> <span class="mf">1.1</span> <span class="mf">0.</span>  <span class="mf">0.6</span> <span class="mf">1.4</span>
 <span class="mf">1.3</span> <span class="mf">1.6</span> <span class="mf">1.7</span> <span class="mf">1.7</span> <span class="mf">1.1</span> <span class="mf">0.3</span> <span class="mf">1.3</span> <span class="mf">1.7</span> <span class="mf">1.5</span> <span class="mf">1.2</span> <span class="mf">0.5</span> <span class="mf">0.6</span> <span class="mf">1.6</span> <span class="mf">3.1</span> <span class="mf">0.3</span> <span class="mf">2.</span>  <span class="mf">1.6</span> <span class="mf">0.5</span>
 <span class="mf">2.6</span> <span class="mf">2.5</span> <span class="mf">0.4</span> <span class="mf">0.4</span> <span class="mf">0.4</span> <span class="mf">0.4</span> <span class="mf">0.4</span> <span class="mf">1.1</span> <span class="mf">1.7</span> <span class="mf">0.5</span> <span class="mf">1.5</span> <span class="mf">1.4</span> <span class="mf">0.1</span> <span class="mf">1.4</span> <span class="mf">1.</span>  <span class="mf">1.</span>  <span class="mf">0.3</span> <span class="mf">1.1</span>
 <span class="mf">0.2</span> <span class="mf">1.1</span> <span class="mf">0.1</span> <span class="mf">0.7</span> <span class="mf">2.6</span> <span class="mf">1.7</span> <span class="mf">2.</span>  <span class="mf">1.4</span> <span class="mf">1.4</span> <span class="mf">0.3</span> <span class="mf">0.4</span> <span class="mf">0.7</span> <span class="mf">1.1</span> <span class="mf">1.1</span> <span class="mf">0.8</span> <span class="mf">0.8</span> <span class="mf">0.9</span> <span class="mf">1.2</span>
 <span class="mf">1.2</span> <span class="mf">1.2</span><span class="p">]</span> <span class="p">[</span><span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span>
 <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">1.</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">0.23606798</span> <span class="mf">1.</span>         <span class="mf">1.</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">0.23606798</span> <span class="mf">0.23606798</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">0.23606798</span> <span class="mf">1.</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">0.23606798</span> <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">0.23606798</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">0.23606798</span> <span class="mf">0.23606798</span> <span class="mf">0.23606798</span> <span class="mf">0.23606798</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>
 <span class="mf">0.23606798</span> <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span>
 <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span>
 <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span>
 <span class="mf">0.38196601</span> <span class="mf">0.38196601</span><span class="p">]</span>
<span class="p">[</span><span class="mf">1.08683704</span> <span class="mf">1.07935938</span> <span class="mf">1.06092468</span> <span class="mf">1.03161555</span> <span class="mf">0.99133678</span> <span class="mf">0.93493706</span>
 <span class="mf">0.86317607</span> <span class="mf">0.78136836</span> <span class="mf">0.70352293</span> <span class="mf">0.64487202</span> <span class="mf">0.61266704</span> <span class="mf">0.60678279</span>
 <span class="mf">0.61883651</span> <span class="mf">0.63991235</span> <span class="mf">0.66383767</span> <span class="mf">0.68530728</span> <span class="mf">0.7020839</span>  <span class="mf">0.71506691</span>
 <span class="mf">0.72433462</span> <span class="mf">0.73247513</span> <span class="mf">0.74002342</span> <span class="mf">0.7487489</span>  <span class="mf">0.76081558</span> <span class="mf">0.77753903</span>
 <span class="mf">0.79985155</span> <span class="mf">0.82674875</span> <span class="mf">0.8580399</span>  <span class="mf">0.89089931</span> <span class="mf">0.92313233</span> <span class="mf">0.95320821</span>
 <span class="mf">0.98065863</span> <span class="mf">1.00873477</span> <span class="mf">1.04290792</span> <span class="mf">1.08866497</span> <span class="mf">1.14943392</span> <span class="mf">1.22080857</span>
 <span class="mf">1.2929335</span>  <span class="mf">1.35676154</span> <span class="mf">1.4021202</span>  <span class="mf">1.42632177</span> <span class="mf">1.43105239</span> <span class="mf">1.41880135</span>
 <span class="mf">1.40112126</span> <span class="mf">1.38702625</span> <span class="mf">1.38535581</span> <span class="mf">1.40496862</span> <span class="mf">1.45132144</span> <span class="mf">1.52190587</span>
 <span class="mf">1.6097794</span>  <span class="mf">1.70184005</span> <span class="mf">1.78498301</span> <span class="mf">1.84800873</span> <span class="mf">1.88579434</span> <span class="mf">1.89137779</span>
 <span class="mf">1.85216521</span> <span class="mf">1.7573269</span>  <span class="mf">1.60194669</span> <span class="mf">1.4068558</span>  <span class="mf">1.2226864</span>  <span class="mf">1.09378123</span>
 <span class="mf">1.03387865</span> <span class="mf">1.01734516</span> <span class="mf">1.02167784</span> <span class="mf">1.02682062</span> <span class="mf">1.02221966</span> <span class="mf">1.00590369</span>
 <span class="mf">0.98109385</span> <span class="mf">0.95002526</span> <span class="mf">0.91607184</span> <span class="mf">0.8832294</span>  <span class="mf">0.85542066</span> <span class="mf">0.83730438</span>
 <span class="mf">0.83548611</span> <span class="mf">0.85858254</span> <span class="mf">0.90888448</span> <span class="mf">0.98602178</span> <span class="mf">1.07794995</span> <span class="mf">1.15678679</span>
 <span class="mf">1.19786983</span> <span class="mf">1.18422965</span> <span class="mf">1.12426637</span> <span class="mf">1.04138037</span> <span class="mf">0.9671476</span>  <span class="mf">0.91852027</span>
 <span class="mf">0.90214004</span> <span class="mf">0.90955621</span> <span class="mf">0.93302657</span> <span class="mf">0.96662729</span> <span class="mf">1.00304032</span> <span class="mf">1.03742083</span>
 <span class="mf">1.06445991</span> <span class="mf">1.08219511</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="reconcile-the-datasets">
<h2>3.6.3 Reconcile the datasets<a class="headerlink" href="#reconcile-the-datasets" title="Permalink to this headline">¶</a></h2>
<p>In this section, we will use <code class="docutils literal notranslate"><span class="pre">gdal</span></code> to transform two datasets into the same coordinate system.</p>
<p>To do this, we identify one dataset with the projection and geographic extent that we want for our data (a MODIS sub-dataset here, the ‘exemplar’).</p>
<p>We then download a climate dataset in a latitude/longitude grid (<a class="reference external" href="https://www.unidata.ucar.edu/software/netcdf/">netcdf</a> format) and transform this to be consistent with the MODIS dataset.</p>
<div class="section" id="load-an-exemplar-dataset">
<h3>3.6.3.1 load an exemplar dataset<a class="headerlink" href="#load-an-exemplar-dataset" title="Permalink to this headline">¶</a></h3>
<p>Since we want to match up datasets, we need to produce an example of the dataset we want to match up to.</p>
<p>We save the exemplar as a GeoTiff format file here.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span><span class="p">,</span> <span class="n">gdalconst</span><span class="p">,</span><span class="n">osr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">geog0111.process_timeseries</span> <span class="kn">import</span> <span class="n">mosaic_and_clip</span>

<span class="c1"># set to True if you want to override</span>
<span class="c1"># the MODIS projection (see above)</span>
<span class="n">use_6974</span> <span class="o">=</span> <span class="kc">False</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">https://stackoverflow.com/questions/10454316/</span>
<span class="sd">how-to-project-and-resample-a-grid-to-match-another-grid-with-gdal-python</span>
<span class="sd">&#39;&#39;&#39;</span>
        
<span class="c1"># first get an exemplar LAI file, clipped to</span>
<span class="c1"># the required limits. We will use this to match  </span>
<span class="c1"># the t2 dataset to</span>
<span class="n">match_filename</span> <span class="o">=</span> <span class="n">mosaic_and_clip</span><span class="p">(</span><span class="n">tiles</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">year</span><span class="p">,</span><span class="n">ofolder</span><span class="o">=</span><span class="s1">&#39;tmp&#39;</span><span class="p">,</span>\
                    <span class="n">country_code</span><span class="o">=</span><span class="n">country_code</span><span class="p">,</span><span class="n">shpfile</span><span class="o">=</span><span class="n">shpfile</span><span class="p">,</span><span class="n">frmat</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">match_filename</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Now get the projection, geotransform and dataset</span>
<span class="sd">size that we want to match to</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">match_ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">match_filename</span><span class="p">,</span> <span class="n">gdalconst</span><span class="o">.</span><span class="n">GA_ReadOnly</span><span class="p">)</span>
<span class="n">match_proj</span> <span class="o">=</span> <span class="n">match_ds</span><span class="o">.</span><span class="n">GetProjection</span><span class="p">()</span>
<span class="n">match_geotrans</span> <span class="o">=</span> <span class="n">match_ds</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
<span class="n">wide</span> <span class="o">=</span> <span class="n">match_ds</span><span class="o">.</span><span class="n">RasterXSize</span>
<span class="n">high</span> <span class="o">=</span> <span class="n">match_ds</span><span class="o">.</span><span class="n">RasterYSize</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Projection from file:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">match_proj</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">set Projection 6974 from SR-OR</span>
<span class="sd">by setting use_6974 = True</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="k">if</span> <span class="n">use_6974</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Projection 6974 from SR-ORG:&#39;</span><span class="p">)</span>
    <span class="n">modis_wkt</span> <span class="o">=</span> <span class="s1">&#39;data/modis_6974.wkt&#39;</span>
    <span class="n">match_proj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">modis_wkt</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="n">match_ds</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">match_proj</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">match_proj</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Visualise</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Exemplar LAI dataset for </span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">match_ds</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
<span class="c1"># close the file -- we dont need it any more</span>
<span class="k">del</span> <span class="n">match_ds</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tmp</span><span class="o">/</span><span class="n">Lai_500m_2017_001_UK</span><span class="o">.</span><span class="n">tif</span>

<span class="n">Projection</span> <span class="kn">from</span> <span class="nn">file</span><span class="p">:</span>
<span class="n">PROJCS</span><span class="p">[</span><span class="s2">&quot;unnamed&quot;</span><span class="p">,</span><span class="n">GEOGCS</span><span class="p">[</span><span class="s2">&quot;Unknown datum based upon the custom spheroid&quot;</span><span class="p">,</span><span class="n">DATUM</span><span class="p">[</span><span class="s2">&quot;Not_specified_based_on_custom_spheroid&quot;</span><span class="p">,</span><span class="n">SPHEROID</span><span class="p">[</span><span class="s2">&quot;Custom spheroid&quot;</span><span class="p">,</span><span class="mf">6371007.181</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span><span class="n">PRIMEM</span><span class="p">[</span><span class="s2">&quot;Greenwich&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">UNIT</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span><span class="mf">0.0174532925199433</span><span class="p">]],</span><span class="n">PROJECTION</span><span class="p">[</span><span class="s2">&quot;Sinusoidal&quot;</span><span class="p">],</span><span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;longitude_of_center&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;false_easting&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">PARAMETER</span><span class="p">[</span><span class="s2">&quot;false_northing&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">UNIT</span><span class="p">[</span><span class="s2">&quot;metre&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">AUTHORITY</span><span class="p">[</span><span class="s2">&quot;EPSG&quot;</span><span class="p">,</span><span class="s2">&quot;9001&quot;</span><span class="p">]]]</span> 
</pre></div>
</div>
<p><img alt="png" src="_images/044_GDAL_Reconciling_projections_19_1.png" /></p>
</div>
<div class="section" id="get-information-from-source-file">
<h3>3.6.3.2 get information from source file<a class="headerlink" href="#get-information-from-source-file" title="Permalink to this headline">¶</a></h3>
<p>Now, we pull the information we need from the source file (the netcdf format t2 dataset).</p>
<p>We need to know:</p>
<ul class="simple">
<li><p>the data type</p></li>
<li><p>the number of bands (time samples in this case)</p></li>
<li><p>the geotransform of the dataset (the fact that it’s 0.25 degree resolution over Europe)</p></li>
</ul>
<p>and access these from the source dataset.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span><span class="p">,</span> <span class="n">gdalconst</span><span class="p">,</span><span class="n">osr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># set up conditions</span>
<span class="n">src_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;data/europe_data_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">.nc&#39;</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">access information from source</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">src_dataname</span> <span class="o">=</span> <span class="s1">&#39;NETCDF:&quot;&#39;</span><span class="o">+</span><span class="n">src_filename</span><span class="o">+</span><span class="s1">&#39;&quot;:t2m&#39;</span>
<span class="n">src</span>     <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">src_filename</span><span class="p">,</span> <span class="n">gdalconst</span><span class="o">.</span><span class="n">GA_ReadOnly</span><span class="p">)</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Get geotrans, data type and number of bands</span>
<span class="sd">from source dataset</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">band1</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">src_proj</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">GetProjection</span><span class="p">()</span>
<span class="n">src_geotrans</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
<span class="n">nbands</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">RasterCount</span>
<span class="n">src_format</span> <span class="o">=</span> <span class="n">band1</span><span class="o">.</span><span class="n">DataType</span>
<span class="n">nx</span> <span class="o">=</span> <span class="n">band1</span><span class="o">.</span><span class="n">XSize</span>
<span class="n">ny</span> <span class="o">=</span> <span class="n">band1</span><span class="o">.</span><span class="n">YSize</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Information found&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;GeoTransform:   &#39;</span><span class="p">,</span><span class="n">src_geotrans</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Projection:     &#39;</span><span class="p">,</span><span class="n">src_proj</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;number of bands:&#39;</span><span class="p">,</span><span class="n">nbands</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;format:         &#39;</span><span class="p">,</span><span class="n">src_format</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;nx,ny:          &#39;</span><span class="p">,</span><span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">)</span>

<span class="c1"># read data</span>
<span class="n">t2m</span> <span class="o">=</span> <span class="n">band1</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;T2 ECMWF dataset for </span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">: band 1&#39;</span><span class="p">)</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">t2m</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Information</span> <span class="n">found</span>
<span class="n">GeoTransform</span><span class="p">:</span>    <span class="p">(</span><span class="o">-</span><span class="mf">20.125</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">75.125</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.25</span><span class="p">)</span>
<span class="n">Projection</span><span class="p">:</span>      <span class="n">GEOGCS</span><span class="p">[</span><span class="s2">&quot;Coordinate System imported from GRIB file&quot;</span><span class="p">,</span><span class="n">DATUM</span><span class="p">[</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span><span class="n">SPHEROID</span><span class="p">[</span><span class="s2">&quot;Sphere&quot;</span><span class="p">,</span><span class="mi">6371200</span><span class="p">,</span><span class="mi">0</span><span class="p">]],</span><span class="n">PRIMEM</span><span class="p">[</span><span class="s2">&quot;Greenwich&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">UNIT</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span><span class="mf">0.0174532925199433</span><span class="p">]]</span>
<span class="n">number</span> <span class="n">of</span> <span class="n">bands</span><span class="p">:</span> <span class="mi">365</span>
<span class="nb">format</span><span class="p">:</span>          <span class="mi">6</span>
<span class="n">nx</span><span class="p">,</span><span class="n">ny</span><span class="p">:</span>           <span class="mi">321</span> <span class="mi">261</span>
</pre></div>
</div>
<p><img alt="png" src="_images/044_GDAL_Reconciling_projections_21_1.png" /></p>
</div>
<div class="section" id="reprojection">
<h3>3.6.3.4 reprojection<a class="headerlink" href="#reprojection" title="Permalink to this headline">¶</a></h3>
<p>Now, set up a blank gdal dataset (in memory) with the size, data type, projection etc. that we want, the reproject the temperature dataset into this.</p>
<p>The processing may take some time if the LAI dataset is large (e.g. France).</p>
<p>The result will be of the same size, projection etc as the cropped LAI dataset.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dst_filename</span> <span class="o">=</span> <span class="n">src_filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">.tif&#39;</span><span class="p">)</span>
<span class="n">force</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">dst_filename</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
    
    <span class="n">dst</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s1">&#39;MEM&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">wide</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">nbands</span><span class="p">,</span> <span class="n">src_format</span><span class="p">)</span>

    <span class="n">dst</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span> <span class="n">match_geotrans</span> <span class="p">)</span>
    <span class="n">dst</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span> <span class="n">match_proj</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Information found&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wide:      &#39;</span><span class="p">,</span><span class="n">wide</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;high:      &#39;</span><span class="p">,</span><span class="n">high</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;geotrans:  &#39;</span><span class="p">,</span><span class="n">match_geotrans</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;projection:&#39;</span><span class="p">,</span><span class="n">match_proj</span><span class="p">)</span>

    <span class="c1"># Do the work: reproject the dataset</span>
    <span class="c1"># This will take a few minutes, depending on dataset size</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">ReprojectImage</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> <span class="n">src_proj</span><span class="p">,</span> <span class="n">match_proj</span><span class="p">,</span> <span class="n">gdalconst</span><span class="o">.</span><span class="n">GRA_Bilinear</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">xOrigin</span> <span class="o">=</span> <span class="n">match_geotrans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">yOrigin</span> <span class="o">=</span> <span class="n">match_geotrans</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">pixelWidth</span> <span class="o">=</span> <span class="n">match_geotrans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">pixelHeight</span> <span class="o">=</span> <span class="n">match_geotrans</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

<span class="n">extent</span> <span class="o">=</span> <span class="p">(</span><span class="n">xOrigin</span><span class="p">,</span><span class="n">xOrigin</span><span class="o">+</span><span class="n">pixelWidth</span><span class="o">*</span><span class="n">wide</span><span class="p">,</span>\
         <span class="n">yOrigin</span><span class="o">+</span><span class="n">pixelHeight</span><span class="o">*</span><span class="p">(</span><span class="n">high</span><span class="p">),</span><span class="n">yOrigin</span><span class="o">+</span><span class="n">pixelHeight</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">extent</span><span class="p">)</span>
    
<span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">dst_filename</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>



    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Visualise: takes some time to plot</span>
<span class="sd">               due to reprojections</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">t2m</span> <span class="o">=</span> <span class="n">dst</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>
    <span class="n">match_ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">match_filename</span><span class="p">,</span> <span class="n">gdalconst</span><span class="o">.</span><span class="n">GA_ReadOnly</span><span class="p">)</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>

    <span class="c1"># visualise</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Sinusoidal</span><span class="o">.</span><span class="n">MODIS</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="s1">&#39;10m&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;T2m ECMWF dataset for </span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">: band 1&#39;</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">t2m</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>


    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Sinusoidal</span><span class="o">.</span><span class="n">MODIS</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="s1">&#39;10m&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MODIS LAI </span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">match_ds</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">-</span><span class="mf">528121.3116353625</span><span class="p">,</span> <span class="mf">118541.0173548233</span><span class="p">,</span> <span class="mf">5549929.5167459585</span><span class="p">,</span> <span class="mf">6765137.823590214</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="crop">
<h3>3.6.3.5 crop<a class="headerlink" href="#crop" title="Permalink to this headline">¶</a></h3>
<p>Finally, we crop the temperature dataset using <code class="docutils literal notranslate"><span class="pre">gdal.Warp()</span></code> and save it to a (GeoTiff) file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span> <span class="c1"># Output / destination</span>
<span class="n">dst_filename</span> <span class="o">=</span> <span class="n">src_filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.nc&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">.tif&#39;</span><span class="p">)</span>
<span class="n">force</span> <span class="o">=</span> <span class="kc">False</span>


<span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">dst_filename</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Only run this if file doesnt exist</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">frmat</span> <span class="o">=</span> <span class="s1">&#39;GTiff&#39;</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Warp</span><span class="p">(</span><span class="n">dst_filename</span><span class="p">,</span>
                <span class="n">dst</span><span class="p">,</span>
                <span class="nb">format</span><span class="o">=</span><span class="n">frmat</span><span class="p">,</span>
                <span class="n">dstNodata</span><span class="o">=-</span><span class="mi">300</span><span class="p">,</span>
                <span class="n">cutlineDSName</span><span class="o">=</span><span class="n">shpfile</span><span class="p">,</span>
                <span class="n">cutlineWhere</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;FIPS=&#39;</span><span class="si">{</span><span class="n">country_code</span><span class="si">:</span><span class="s2">s</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                <span class="n">cropToCutline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">dst</span> <span class="c1"># Flush</span>
    <span class="k">del</span> <span class="n">g</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualise</span>
<span class="nb">print</span><span class="p">(</span><span class="n">dst_filename</span><span class="p">)</span>
<span class="n">t2m</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">dst_filename</span><span class="p">,</span> <span class="n">gdalconst</span><span class="o">.</span><span class="n">GA_ReadOnly</span><span class="p">)</span>
<span class="n">t2m</span> <span class="o">=</span> <span class="n">t2m</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>
<span class="n">t2m</span><span class="p">[</span><span class="n">t2m</span><span class="o">==-</span><span class="mi">300</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
<span class="n">match_ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">match_filename</span><span class="p">,</span> <span class="n">gdalconst</span><span class="o">.</span><span class="n">GA_ReadOnly</span><span class="p">)</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>

<span class="c1"># visualise</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Sinusoidal</span><span class="o">.</span><span class="n">MODIS</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="s1">&#39;10m&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;T2m ECMWF dataset for </span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">: band 1&#39;</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">t2m</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span> <span class="p">(</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Sinusoidal</span><span class="o">.</span><span class="n">MODIS</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="s1">&#39;10m&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MODIS Exemplar LAI </span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">match_ds</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">/</span><span class="n">europe_data_2017_UK</span><span class="o">.</span><span class="n">tif</span>
</pre></div>
</div>
<p><img alt="png" src="_images/044_GDAL_Reconciling_projections_27_1.png" /></p>
<p>Now let’s look at the time information in the metadata:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">meta</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">src_filename</span><span class="p">)</span><span class="o">.</span><span class="n">GetMetadata</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">meta</span><span class="p">[</span><span class="s1">&#39;time#units&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hours</span> <span class="n">since</span> <span class="mi">1900</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">01</span> <span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mf">00.0</span>
</pre></div>
</div>
<p>The time information is in hours since <code class="docutils literal notranslate"><span class="pre">1900-01-01</span> <span class="pre">00:00:00.0</span></code>. This is not such a convenient unit for plotting, so we can use <code class="docutils literal notranslate"><span class="pre">datetime</span></code> to fix that:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">timer</span> <span class="o">=</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;NETCDF_DIM_time_VALUES&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">timer</span><span class="p">[:</span><span class="mi">100</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="mi">1025628</span><span class="p">,</span><span class="mi">1025652</span><span class="p">,</span><span class="mi">1025676</span><span class="p">,</span><span class="mi">1025700</span><span class="p">,</span><span class="mi">1025724</span><span class="p">,</span><span class="mi">1025748</span><span class="p">,</span><span class="mi">1025772</span><span class="p">,</span><span class="mi">1025796</span><span class="p">,</span><span class="mi">1025820</span><span class="p">,</span><span class="mi">1025844</span><span class="p">,</span><span class="mi">1025868</span><span class="p">,</span><span class="mi">1025892</span><span class="p">,</span><span class="mi">102</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># split the string into integers</span>
<span class="n">timer</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;NETCDF_DIM_time_VALUES&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">timer</span><span class="p">[:</span><span class="mi">20</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mi">1025628</span><span class="p">,</span> <span class="mi">1025652</span><span class="p">,</span> <span class="mi">1025676</span><span class="p">,</span> <span class="mi">1025700</span><span class="p">,</span> <span class="mi">1025724</span><span class="p">,</span> <span class="mi">1025748</span><span class="p">,</span> <span class="mi">1025772</span><span class="p">,</span> <span class="mi">1025796</span><span class="p">,</span> <span class="mi">1025820</span><span class="p">,</span> <span class="mi">1025844</span><span class="p">,</span> <span class="mi">1025868</span><span class="p">,</span> <span class="mi">1025892</span><span class="p">,</span> <span class="mi">1025916</span><span class="p">,</span> <span class="mi">1025940</span><span class="p">,</span> <span class="mi">1025964</span><span class="p">,</span> <span class="mi">1025988</span><span class="p">,</span> <span class="mi">1026012</span><span class="p">,</span> <span class="mi">1026036</span><span class="p">,</span> <span class="mi">1026060</span><span class="p">,</span> <span class="mi">1026084</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># split the string into integers</span>
<span class="c1"># convert to days</span>
<span class="n">timer</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="mf">24.</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;NETCDF_DIM_time_VALUES&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">timer</span><span class="p">[:</span><span class="mi">20</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">42734.5</span><span class="p">,</span> <span class="mf">42735.5</span><span class="p">,</span> <span class="mf">42736.5</span><span class="p">,</span> <span class="mf">42737.5</span><span class="p">,</span> <span class="mf">42738.5</span><span class="p">,</span> <span class="mf">42739.5</span><span class="p">,</span> <span class="mf">42740.5</span><span class="p">,</span> <span class="mf">42741.5</span><span class="p">,</span> <span class="mf">42742.5</span><span class="p">,</span> <span class="mf">42743.5</span><span class="p">,</span> <span class="mf">42744.5</span><span class="p">,</span> <span class="mf">42745.5</span><span class="p">,</span> <span class="mf">42746.5</span><span class="p">,</span> <span class="mf">42747.5</span><span class="p">,</span> <span class="mf">42748.5</span><span class="p">,</span> <span class="mf">42749.5</span><span class="p">,</span> <span class="mf">42750.5</span><span class="p">,</span> <span class="mf">42751.5</span><span class="p">,</span> <span class="mf">42752.5</span><span class="p">,</span> <span class="mf">42753.5</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span><span class="n">timedelta</span>

<span class="c1"># add base date</span>
<span class="c1"># split the string into integers</span>
<span class="c1"># convert to days</span>
<span class="n">timer</span> <span class="o">=</span> <span class="p">[(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1900</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="mf">24.</span><span class="p">))</span> \
         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;NETCDF_DIM_time_VALUES&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)]</span>

<span class="nb">print</span> <span class="p">(</span><span class="n">timer</span><span class="p">[:</span><span class="mi">20</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2017</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="putting-this-together">
<h2>3.6.3.6 Putting this together<a class="headerlink" href="#putting-this-together" title="Permalink to this headline">¶</a></h2>
<p>We can now put these codes together to make a function <code class="docutils literal notranslate"><span class="pre">match_netcdf_to_data()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span><span class="p">,</span> <span class="n">gdalconst</span><span class="p">,</span><span class="n">osr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">geog0111.process_timeseries</span> <span class="kn">import</span> <span class="n">mosaic_and_clip</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span> 

<span class="k">def</span> <span class="nf">match_netcdf_to_data</span><span class="p">(</span><span class="n">src_filename</span><span class="p">,</span><span class="n">match_filename</span><span class="p">,</span><span class="n">dst_filename</span><span class="p">,</span><span class="n">year</span><span class="p">,</span>\
                         <span class="n">country_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">shpfile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>\
                         <span class="n">nodata</span><span class="o">=-</span><span class="mi">300</span><span class="p">,</span><span class="n">frmat</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    see :</span>
<span class="sd">    https://stackoverflow.com/questions/10454316/</span>
<span class="sd">    how-to-project-and-resample-a-grid-to-match-another-grid-with-gdal-python</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get the projection, geotransform and dataset</span>
<span class="sd">    size that we want to match to</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;getting info from match file </span><span class="si">{</span><span class="n">match_filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">match_ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">match_filename</span><span class="p">,</span> <span class="n">gdalconst</span><span class="o">.</span><span class="n">GA_ReadOnly</span><span class="p">)</span>

    <span class="n">match_proj</span> <span class="o">=</span> <span class="n">match_ds</span><span class="o">.</span><span class="n">GetProjection</span><span class="p">()</span>
    <span class="n">match_geotrans</span> <span class="o">=</span> <span class="n">match_ds</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
    <span class="n">wide</span> <span class="o">=</span> <span class="n">match_ds</span><span class="o">.</span><span class="n">RasterXSize</span>
    <span class="n">high</span> <span class="o">=</span> <span class="n">match_ds</span><span class="o">.</span><span class="n">RasterYSize</span>
    <span class="c1"># close the file -- we dont need it any more</span>
    <span class="k">del</span> <span class="n">match_ds</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    access information from source</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;getting info from source netcdf file </span><span class="si">{</span><span class="n">src_filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">src_dataname</span> <span class="o">=</span> <span class="s1">&#39;NETCDF:&quot;&#39;</span><span class="o">+</span><span class="n">src_filename</span><span class="o">+</span><span class="s1">&#39;&quot;:t2m&#39;</span>
        <span class="n">src</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">src_dataname</span><span class="p">,</span> <span class="n">gdalconst</span><span class="o">.</span><span class="n">GA_ReadOnly</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;failed&#39;</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># get meta data</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">src_filename</span><span class="p">,</span> <span class="n">gdalconst</span><span class="o">.</span><span class="n">GA_ReadOnly</span><span class="p">)</span><span class="o">.</span><span class="n">GetMetadata</span><span class="p">()</span>

    <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">match_geotrans</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">match_geotrans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">match_geotrans</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">wide</span><span class="p">,</span>\
              <span class="n">match_geotrans</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">match_geotrans</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">*</span><span class="n">high</span><span class="p">,</span><span class="n">match_geotrans</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
    <span class="c1"># get time info</span>
    <span class="n">timer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">1900</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">/</span><span class="mf">24.</span><span class="p">))</span> \
         <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">meta</span><span class="p">[</span><span class="s1">&#39;NETCDF_DIM_time_VALUES&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)])</span>

    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">dst_filename</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span> <span class="ow">or</span> <span class="n">force</span><span class="p">:</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Get geotrans, proj, data type and number of bands</span>
<span class="sd">        from source dataset</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">band1</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">src_geotrans</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
        <span class="n">src_proj</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">GetProjection</span><span class="p">()</span>

        <span class="n">nbands</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">RasterCount</span>
        <span class="n">src_format</span> <span class="o">=</span> <span class="n">band1</span><span class="o">.</span><span class="n">DataType</span>

        <span class="n">dst</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s1">&#39;MEM&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span>\
                                        <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">wide</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> \
                                        <span class="n">nbands</span><span class="p">,</span> <span class="n">src_format</span><span class="p">)</span>
        <span class="n">dst</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span> <span class="n">match_geotrans</span> <span class="p">)</span>
        <span class="n">dst</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span> <span class="n">match_proj</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;reprojecting ...&#39;</span><span class="p">)</span>
            <span class="c1"># Output / destination</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">ReprojectImage</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">,</span> \
                                    <span class="n">src_proj</span><span class="p">,</span> \
                                    <span class="n">match_proj</span><span class="p">,</span>\
                                    <span class="n">gdalconst</span><span class="o">.</span><span class="n">GRA_Bilinear</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;cropping to </span><span class="si">{</span><span class="n">country_code</span><span class="si">:</span><span class="s1">s</span><span class="si">}</span><span class="s1"> ...&#39;</span><span class="p">)</span>
        <span class="n">done</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Warp</span><span class="p">(</span><span class="n">dst_filename</span><span class="p">,</span>
                        <span class="n">dst</span><span class="p">,</span>
                        <span class="nb">format</span><span class="o">=</span><span class="n">frmat</span><span class="p">,</span>
                        <span class="n">dstNodata</span><span class="o">=</span><span class="n">nodata</span><span class="p">,</span>
                        <span class="n">cutlineDSName</span><span class="o">=</span><span class="n">shpfile</span><span class="p">,</span>
                        <span class="n">cutlineWhere</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;FIPS=&#39;</span><span class="si">{</span><span class="n">country_code</span><span class="si">:</span><span class="s2">s</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                        <span class="n">cropToCutline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">dst</span>
 
    <span class="k">return</span><span class="p">(</span><span class="n">timer</span><span class="p">,</span><span class="n">dst_filename</span><span class="p">,</span><span class="n">extent</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">osgeo</span> <span class="kn">import</span> <span class="n">gdal</span><span class="p">,</span> <span class="n">gdalconst</span><span class="p">,</span><span class="n">osr</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">geog0111.process_timeseries</span> <span class="kn">import</span> <span class="n">mosaic_and_clip</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span><span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">geog0111.match_netcdf_to_data</span> <span class="kn">import</span> <span class="n">match_netcdf_to_data</span>
<span class="kn">from</span> <span class="nn">geog0111.geog_data</span> <span class="kn">import</span> <span class="n">procure_dataset</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="c1"># set conditions</span>

<span class="n">country_code</span> <span class="o">=</span> <span class="s1">&#39;UK&#39;</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2017</span>
<span class="n">shpfile</span> <span class="o">=</span> <span class="s2">&quot;data/TM_WORLD_BORDERS-0.3.shp&quot;</span>
<span class="n">src_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;data/europe_data_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">.nc&#39;</span>
<span class="n">dst_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;data/europe_data_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">.tif&#39;</span>
<span class="n">t2_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;data/europe_data_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">.npz&#39;</span>
<span class="c1"># read in the LAI data for given country code</span>
<span class="n">tiles</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]:</span>
        <span class="n">tiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;h</span><span class="si">{</span><span class="n">h</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">v</span><span class="si">{</span><span class="n">v</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        

<span class="c1">#read LAI</span>
<span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;lai_data_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">.npz&#39;</span>
<span class="n">ofile</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span><span class="o">/</span><span class="n">fname</span>
<span class="n">lai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ofile</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">t2_filename</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;calculating dataset match in </span><span class="si">{</span><span class="n">t2_filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="c1"># first get an exemplar LAI file, clipped to</span>
    <span class="c1"># the required limits. We will use this to match  </span>
    <span class="c1"># the t2 dataset to</span>
    <span class="n">match_filename</span> <span class="o">=</span> <span class="n">mosaic_and_clip</span><span class="p">(</span><span class="n">tiles</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">year</span><span class="p">,</span>\
                        <span class="n">country_code</span><span class="o">=</span><span class="n">country_code</span><span class="p">,</span>\
                        <span class="n">shpfile</span><span class="o">=</span><span class="n">shpfile</span><span class="p">,</span><span class="n">frmat</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">)</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Match the datasets using the function</span>
<span class="sd">    we have developed</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">meta</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">src_filename</span><span class="p">,</span> <span class="n">gdalconst</span><span class="o">.</span><span class="n">GA_ReadOnly</span><span class="p">)</span><span class="o">.</span><span class="n">GetMetadata</span><span class="p">()</span>

    <span class="n">timer</span><span class="p">,</span><span class="n">dst_filename</span><span class="p">,</span><span class="n">extent</span> <span class="o">=</span> <span class="n">match_netcdf_to_data</span><span class="p">(</span>\
                                    <span class="n">src_filename</span><span class="p">,</span><span class="n">match_filename</span><span class="p">,</span>\
                                    <span class="n">dst_filename</span><span class="p">,</span><span class="n">year</span><span class="p">,</span>\
                                    <span class="n">country_code</span><span class="o">=</span><span class="n">country_code</span><span class="p">,</span>\
                                    <span class="n">shpfile</span><span class="o">=</span><span class="n">shpfile</span><span class="p">,</span>\
                                    <span class="n">nodata</span><span class="o">=-</span><span class="mi">300</span><span class="p">,</span><span class="n">frmat</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span>\
                                    <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># read and interpret the t2 data and flip</span>
    <span class="n">temp2</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">dst_filename</span><span class="p">)</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()[:,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">temp2</span><span class="p">[</span><span class="n">temp2</span><span class="o">==-</span><span class="mi">300</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">temp2</span> <span class="o">-=</span> <span class="mf">273.15</span>
    <span class="c1"># save these</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;saving data to </span><span class="si">{</span><span class="n">t2_filename</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savez_compressed</span><span class="p">(</span><span class="n">t2_filename</span><span class="p">,</span><span class="n">timer</span><span class="o">=</span><span class="n">timer</span><span class="p">,</span><span class="n">temp2</span><span class="o">=</span><span class="n">temp2</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>

<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;dataset in </span><span class="si">{</span><span class="n">t2_filename</span><span class="si">}</span><span class="s1"> exists&#39;</span><span class="p">)</span>
    
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
<span class="n">t2data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">t2_filename</span><span class="p">)</span>
<span class="n">timer</span><span class="p">,</span><span class="n">temp2</span><span class="p">,</span><span class="n">extent</span> <span class="o">=</span> <span class="n">t2data</span><span class="p">[</span><span class="s1">&#39;timer&#39;</span><span class="p">],</span><span class="n">t2data</span><span class="p">[</span><span class="s1">&#39;temp2&#39;</span><span class="p">],</span><span class="n">t2data</span><span class="p">[</span><span class="s1">&#39;extent&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">calculating</span> <span class="n">dataset</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">data</span><span class="o">/</span><span class="n">europe_data_2017_UK</span><span class="o">.</span><span class="n">npz</span>
<span class="n">getting</span> <span class="n">info</span> <span class="kn">from</span> <span class="nn">match</span> <span class="n">file</span> <span class="n">data</span><span class="o">/</span><span class="n">Lai_500m_2017_001_UK</span><span class="o">.</span><span class="n">tif</span>
<span class="n">getting</span> <span class="n">info</span> <span class="kn">from</span> <span class="nn">source</span> <span class="n">netcdf</span> <span class="n">file</span> <span class="n">data</span><span class="o">/</span><span class="n">europe_data_2017</span><span class="o">.</span><span class="n">nc</span>
<span class="n">saving</span> <span class="n">data</span> <span class="n">to</span> <span class="n">data</span><span class="o">/</span><span class="n">europe_data_2017_UK</span><span class="o">.</span><span class="n">npz</span>
<span class="n">done</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># visualise the interpolated dataset</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">12</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span> <span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Sinusoidal</span><span class="o">.</span><span class="n">MODIS</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="s1">&#39;10m&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;T2m ECMWF dataset for </span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">timer</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">temp2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span> <span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span> <span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">Sinusoidal</span><span class="o">.</span><span class="n">MODIS</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="s1">&#39;10m&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MODIS LAI </span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">timer</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">interpolated_lai</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">shrink</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span> <span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mean T2m for </span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timer</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">temp2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;temperature 2m / C&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span> <span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span> <span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;mean LAI for </span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">interpolated_lai</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timer</span><span class="p">[::</span><span class="mi">4</span><span class="p">],</span><span class="n">mean</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span> <span class="n">at</span> <span class="mh">0x11dc20b38</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p><img alt="png" src="_images/044_GDAL_Reconciling_projections_38_1.png" /></p>
</div>
<div class="section" id="summary">
<h2>3.6.6 Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>In this section, we have learned about projections, and have reconciled two datasets that were originally in different projections. NThey also were defined with geoids with different Earth radius assumptions.</p>
<p>These issues are typical when dealing with geospatial data.</p>
<p>This part of the notes is non compulsory, as the codes and ideas are quite complicated for people just begining to learn coding. We have included it here to allow students to revisit this later. It is also included because we want to develop some interesting datasets for modelling, so we need to deal with reconciling datasets from different providers in different projections.</p>
<p>In this section, we have developed the following datasets:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geog0111.geog_data</span> <span class="kn">import</span> <span class="n">procure_dataset</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="n">year</span> <span class="o">=</span> <span class="mi">2017</span>
<span class="n">country_code</span> <span class="o">=</span> <span class="s1">&#39;UK&#39;</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">LAI data</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="c1"># read in the LAI data for given country code</span>
<span class="n">lai_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;data/lai_data_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">.npz&#39;</span>
<span class="c1"># get the dataset in case its not here</span>
<span class="n">procure_dataset</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">lai_filename</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">lai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">lai_filename</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lai_filename</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">lai</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">T 2m data</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="n">t2_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;data/europe_data_</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">country_code</span><span class="si">}</span><span class="s1">.npz&#39;</span>
<span class="c1"># get the dataset in case its not here</span>
<span class="n">procure_dataset</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">t2_filename</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">t2data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">t2_filename</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">t2_filename</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">t2data</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">/</span><span class="n">lai_data_2017_UK</span><span class="o">.</span><span class="n">npz</span> <span class="p">[</span><span class="s1">&#39;dates&#39;</span><span class="p">,</span> <span class="s1">&#39;lai&#39;</span><span class="p">,</span> <span class="s1">&#39;weights&#39;</span><span class="p">,</span> <span class="s1">&#39;interpolated_lai&#39;</span><span class="p">]</span>
<span class="n">data</span><span class="o">/</span><span class="n">europe_data_2017_UK</span><span class="o">.</span><span class="n">npz</span> <span class="p">[</span><span class="s1">&#39;timer&#39;</span><span class="p">,</span> <span class="s1">&#39;temp2&#39;</span><span class="p">,</span> <span class="s1">&#39;extent&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># a quick look at some stats to see if there are data there</span>
<span class="c1"># and they are sensible</span>
<span class="n">lai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">ofile</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lai</span><span class="p">[</span><span class="s1">&#39;lai&#39;</span><span class="p">][</span><span class="mi">1000</span><span class="p">,</span><span class="mi">700</span><span class="p">]),</span>\
      <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lai</span><span class="p">[</span><span class="s1">&#39;weights&#39;</span><span class="p">][</span><span class="mi">1000</span><span class="p">,</span><span class="mi">700</span><span class="p">]))</span>
<span class="c1"># does it have the interpolated value?</span>
<span class="k">if</span> <span class="s1">&#39;interpolated_lai&#39;</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">lai</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lai</span><span class="p">[</span><span class="s1">&#39;interpolated_lai&#39;</span><span class="p">][</span><span class="mi">1000</span><span class="p">,</span><span class="mi">700</span><span class="p">]))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">1.1</span> <span class="mf">1.1</span> <span class="mf">1.2</span> <span class="mf">0.9</span> <span class="mf">0.9</span> <span class="mf">1.2</span> <span class="mf">1.</span>  <span class="mf">0.8</span> <span class="mf">1.4</span> <span class="mf">0.3</span> <span class="mf">0.</span>  <span class="mf">0.5</span> <span class="mf">0.3</span> <span class="mf">0.9</span> <span class="mf">0.6</span> <span class="mf">1.</span>  <span class="mf">0.7</span> <span class="mf">0.5</span>
 <span class="mf">0.7</span> <span class="mf">0.6</span> <span class="mf">1.3</span> <span class="mf">0.7</span> <span class="mf">0.1</span> <span class="mf">1.</span>  <span class="mf">1.</span>  <span class="mf">0.6</span> <span class="mf">1.1</span> <span class="mf">0.5</span> <span class="mf">1.1</span> <span class="mf">1.</span>  <span class="mf">1.1</span> <span class="mf">1.1</span> <span class="mf">1.1</span> <span class="mf">0.</span>  <span class="mf">0.6</span> <span class="mf">1.4</span>
 <span class="mf">1.3</span> <span class="mf">1.6</span> <span class="mf">1.7</span> <span class="mf">1.7</span> <span class="mf">1.1</span> <span class="mf">0.3</span> <span class="mf">1.3</span> <span class="mf">1.7</span> <span class="mf">1.5</span> <span class="mf">1.2</span> <span class="mf">0.5</span> <span class="mf">0.6</span> <span class="mf">1.6</span> <span class="mf">3.1</span> <span class="mf">0.3</span> <span class="mf">2.</span>  <span class="mf">1.6</span> <span class="mf">0.5</span>
 <span class="mf">2.6</span> <span class="mf">2.5</span> <span class="mf">0.4</span> <span class="mf">0.4</span> <span class="mf">0.4</span> <span class="mf">0.4</span> <span class="mf">0.4</span> <span class="mf">1.1</span> <span class="mf">1.7</span> <span class="mf">0.5</span> <span class="mf">1.5</span> <span class="mf">1.4</span> <span class="mf">0.1</span> <span class="mf">1.4</span> <span class="mf">1.</span>  <span class="mf">1.</span>  <span class="mf">0.3</span> <span class="mf">1.1</span>
 <span class="mf">0.2</span> <span class="mf">1.1</span> <span class="mf">0.1</span> <span class="mf">0.7</span> <span class="mf">2.6</span> <span class="mf">1.7</span> <span class="mf">2.</span>  <span class="mf">1.4</span> <span class="mf">1.4</span> <span class="mf">0.3</span> <span class="mf">0.4</span> <span class="mf">0.7</span> <span class="mf">1.1</span> <span class="mf">1.1</span> <span class="mf">0.8</span> <span class="mf">0.8</span> <span class="mf">0.9</span> <span class="mf">1.2</span>
 <span class="mf">1.2</span> <span class="mf">1.2</span><span class="p">]</span> <span class="p">[</span><span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span>
 <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">1.</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">0.23606798</span> <span class="mf">1.</span>         <span class="mf">1.</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">0.23606798</span> <span class="mf">0.23606798</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">0.23606798</span> <span class="mf">1.</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">0.23606798</span> <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">0.23606798</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">0.23606798</span> <span class="mf">0.23606798</span> <span class="mf">0.23606798</span> <span class="mf">0.23606798</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>
 <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">1.</span>
 <span class="mf">0.23606798</span> <span class="mf">1.</span>         <span class="mf">1.</span>         <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span>
 <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span>
 <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span> <span class="mf">0.38196601</span>
 <span class="mf">0.38196601</span> <span class="mf">0.38196601</span><span class="p">]</span>
<span class="p">[</span><span class="mf">1.08683704</span> <span class="mf">1.07935938</span> <span class="mf">1.06092468</span> <span class="mf">1.03161555</span> <span class="mf">0.99133678</span> <span class="mf">0.93493706</span>
 <span class="mf">0.86317607</span> <span class="mf">0.78136836</span> <span class="mf">0.70352293</span> <span class="mf">0.64487202</span> <span class="mf">0.61266704</span> <span class="mf">0.60678279</span>
 <span class="mf">0.61883651</span> <span class="mf">0.63991235</span> <span class="mf">0.66383767</span> <span class="mf">0.68530728</span> <span class="mf">0.7020839</span>  <span class="mf">0.71506691</span>
 <span class="mf">0.72433462</span> <span class="mf">0.73247513</span> <span class="mf">0.74002342</span> <span class="mf">0.7487489</span>  <span class="mf">0.76081558</span> <span class="mf">0.77753903</span>
 <span class="mf">0.79985155</span> <span class="mf">0.82674875</span> <span class="mf">0.8580399</span>  <span class="mf">0.89089931</span> <span class="mf">0.92313233</span> <span class="mf">0.95320821</span>
 <span class="mf">0.98065863</span> <span class="mf">1.00873477</span> <span class="mf">1.04290792</span> <span class="mf">1.08866497</span> <span class="mf">1.14943392</span> <span class="mf">1.22080857</span>
 <span class="mf">1.2929335</span>  <span class="mf">1.35676154</span> <span class="mf">1.4021202</span>  <span class="mf">1.42632177</span> <span class="mf">1.43105239</span> <span class="mf">1.41880135</span>
 <span class="mf">1.40112126</span> <span class="mf">1.38702625</span> <span class="mf">1.38535581</span> <span class="mf">1.40496862</span> <span class="mf">1.45132144</span> <span class="mf">1.52190587</span>
 <span class="mf">1.6097794</span>  <span class="mf">1.70184005</span> <span class="mf">1.78498301</span> <span class="mf">1.84800873</span> <span class="mf">1.88579434</span> <span class="mf">1.89137779</span>
 <span class="mf">1.85216521</span> <span class="mf">1.7573269</span>  <span class="mf">1.60194669</span> <span class="mf">1.4068558</span>  <span class="mf">1.2226864</span>  <span class="mf">1.09378123</span>
 <span class="mf">1.03387865</span> <span class="mf">1.01734516</span> <span class="mf">1.02167784</span> <span class="mf">1.02682062</span> <span class="mf">1.02221966</span> <span class="mf">1.00590369</span>
 <span class="mf">0.98109385</span> <span class="mf">0.95002526</span> <span class="mf">0.91607184</span> <span class="mf">0.8832294</span>  <span class="mf">0.85542066</span> <span class="mf">0.83730438</span>
 <span class="mf">0.83548611</span> <span class="mf">0.85858254</span> <span class="mf">0.90888448</span> <span class="mf">0.98602178</span> <span class="mf">1.07794995</span> <span class="mf">1.15678679</span>
 <span class="mf">1.19786983</span> <span class="mf">1.18422965</span> <span class="mf">1.12426637</span> <span class="mf">1.04138037</span> <span class="mf">0.9671476</span>  <span class="mf">0.91852027</span>
 <span class="mf">0.90214004</span> <span class="mf">0.90955621</span> <span class="mf">0.93302657</span> <span class="mf">0.96662729</span> <span class="mf">1.00304032</span> <span class="mf">1.03742083</span>
 <span class="mf">1.06445991</span> <span class="mf">1.08219511</span><span class="p">]</span>
</pre></div>
</div>
<p><strong>Exercise 3.6.2</strong> Extra Homework</p>
<p>Go carefully through these notes and make notes of the processes we have to go through to reconcile datasets such as these.</p>
<p>Learn what issues to look out for when coming across a new dataset, and how to use Python code to deal with it. Try to stick to one geospatial package as far as possible (<code class="docutils literal notranslate"><span class="pre">gdal</span></code> here) as you can make problems for yourself by mixing them.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># do exercise here</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">GEOG0111 Scientific Computing</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="docindex.html">GEOG0111</a></li>
<li class="toctree-l1"><a class="reference internal" href="docindex.html#geog0111-scientific-computing">GEOG0111 Scientific Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="001_Notebook_use.html">001 Use of Jupyter notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="002_Unix.html">002 Some basic UNIX</a></li>
<li class="toctree-l1"><a class="reference internal" href="003_Help.html">003 Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="004_Accounts.html">004 Setup, Accounts and logins</a></li>
<li class="toctree-l1"><a class="reference internal" href="001_Notebook_use_answers.html">001 Use of Jupyter notebooks : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="002_Unix_answers.html">002 Some basic UNIX : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="003_Help_answers.html">003 Help : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="010_Python_Introduction.html">010 Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="011_Python_data_types.html">011 Python data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="012_Python_strings.html">012 String formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="013_Python_string_methods.html">013 String methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="014_Python_groups.html">014 Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="015_Python_control.html">015 Control in Python: <code class="docutils literal notranslate"><span class="pre">if</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="016_Python_for.html">016 More control in Python: <code class="docutils literal notranslate"><span class="pre">for</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="017_Functions.html">Functions in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="018_Packages.html">Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="019_Running_Python.html">019 Python codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="010_Python_Introduction_answers.html">010 Introduction to Python : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="011_Python_data_types_answers.html">011 Python data types : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="012_Python_strings_answers.html">012 String formatting : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="013_Python_string_methods_answers.html">013 String methods : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="014_Python_groups_answers.html">014 Groups : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="015_Python_control_answers.html">015 Control in Python: <code class="docutils literal notranslate"><span class="pre">if</span></code> : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="016_Python_for_answers.html">016 More control in Python: <code class="docutils literal notranslate"><span class="pre">for</span></code> : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="017_Functions_answers.html">Functions in Python : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="019_Running_Python_answers.html">019 Python codes : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="020_NASA_MODIS_Earthdata.html">NASA MODIS Earthdata</a></li>
<li class="toctree-l1"><a class="reference internal" href="020_NASA_MODIS_Earthdata.html#exercises">Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="020_NASA_MODIS_Earthdata.html#summary">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="020_Python_files.html">020 Files and other Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="021_Read_files.html">021 Read Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="022_NASA_MODIS_Earthdata.html">NASA MODIS Earthdata</a></li>
<li class="toctree-l1"><a class="reference internal" href="022_NASA_MODIS_Earthdata.html#exercises">Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="022_NASA_MODIS_Earthdata.html#summary">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="022_Pandas_and_plotting.html"><code class="docutils literal notranslate"><span class="pre">pandas</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="024_GoogleEarthEngine.html">201 Google Earth Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="020_NASA_MODIS_Earthdata_answers.html">NASA MODIS Earthdata : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="020_Python_files_answers.html">020 Files and other Resources : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="021_Read_files_answers.html">021 Read Files : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="022_NASA_MODIS_Earthdata_answers.html">NASA MODIS Earthdata : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="031_Numpy_matplotlib.html">Manipulating data: <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="040_GDAL.html">3 Geospatial processing with <code class="docutils literal notranslate"><span class="pre">gdal</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="041_MODIS_download.html">3.2 Accessing MODIS Data products</a></li>
<li class="toctree-l1"><a class="reference internal" href="042_GDAL_masking.html">3.3 GDAL, and OGR masking</a></li>
<li class="toctree-l1"><a class="reference internal" href="043_GDAL_stacking_and_interpolating.html">3.4 Stacking and interpolating data</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">3.6 Reconciling projections</a></li>
<li class="toctree-l1"><a class="reference internal" href="050_Linear_models.html">Table of Contents</a></li>
<li class="toctree-l1"><a class="reference internal" href="050_Linear_models.html#fitting-to-the-mauna-loa-co-2-record">Fitting to the Mauna Loa $CO_2$ record</a></li>
<li class="toctree-l1"><a class="reference internal" href="051_Modelling_and_optimisation.html">5 Modelling and optimisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="DEV_Local_Install.html">003 Full native installation  of software and notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="DEV_scripts.html">Scripts</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="043_GDAL_stacking_and_interpolating.html" title="previous chapter">3.4 Stacking and interpolating data</a></li>
      <li>Next: <a href="050_Linear_models.html" title="next chapter">Table of Contents</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, P. Lewis and J. Gomez-Dans.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/044_GDAL_Reconciling_projections.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>