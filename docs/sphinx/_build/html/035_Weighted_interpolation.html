
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>035 Weighted interpolation &#8212; GEOG0111 Scientific Computing 1.0.1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="036 Model Fitting" href="036_Model_Fitting.html" />
    <link rel="prev" title="034 Weighted interpolation" href="034_Weigthed_smoothing_and_interpolation.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="weighted-interpolation">
<h1>035 Weighted interpolation<a class="headerlink" href="#weighted-interpolation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<div class="section" id="purpose">
<h3>Purpose<a class="headerlink" href="#purpose" title="Permalink to this headline">¶</a></h3>
<p>We have seen in <a class="reference internal" href="034_Weigthed_smoothing_and_interpolation.html"><span class="doc">034_Weigthed_smoothing_and_interpolation</span></a> how we can regularise a dataset using colvolution filtering. We investigate and apply that now to allow us to provide gap-filled datasets.</p>
</div>
<div class="section" id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>You must make sure you can recall the details of the work covered in <a class="reference internal" href="032_GDAL_mosaicing_and_masking.html"><span class="doc">032_GDAL_mosaicing_and_masking</span></a> and understand the material in <a class="reference internal" href="034_Weigthed_smoothing_and_interpolation.html"><span class="doc">034_Weigthed_smoothing_and_interpolation</span></a>. You will also need to know how to do <a class="reference internal" href="023_Plotting.html"><span class="doc">graph plotting</span></a>, including sub-figures and errorbars, and <a class="reference internal" href="024_Image_display.html"><span class="doc">image display</span></a>.</p>
</div>
<div class="section" id="test">
<h3>Test<a class="headerlink" href="#test" title="Permalink to this headline">¶</a></h3>
<p>You should run a <a class="reference internal" href="004_Accounts.html"><span class="doc">NASA account test</span></a> if you have not already done so.</p>
</div>
</div>
<div class="section" id="smoothing">
<h2>Smoothing<a class="headerlink" href="#smoothing" title="Permalink to this headline">¶</a></h2>
<p>In convolution, we combine a <em>signal</em> $y$ with a <em>filter</em> $f$ to achieve a filtered signal. For example, if we have an noisy signal, we will attempt to reduce the influence of high frequency information in the signal (a ‘low pass’ filter, as we let the low frequency information <em>pass</em>).</p>
<p>We can perform a weighted interpolation by:</p>
<ul class="simple">
<li><p>numerator   = smooth( signal $\times$ weight)</p></li>
<li><p>denominator = smooth( weight)</p></li>
<li><p>result = numerator/denominator</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdal</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">geog0111.modis_annual</span> <span class="kn">import</span> <span class="n">modis_annual</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># load some data</span>

<span class="n">warp_args</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;dstNodata&#39;</span>     <span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
  <span class="s1">&#39;format&#39;</span>        <span class="p">:</span> <span class="s1">&#39;MEM&#39;</span><span class="p">,</span>
  <span class="s1">&#39;cropToCutline&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
  <span class="s1">&#39;cutlineWhere&#39;</span>  <span class="p">:</span> <span class="s2">&quot;FIPS=&#39;LU&#39;&quot;</span><span class="p">,</span>
  <span class="s1">&#39;cutlineDSName&#39;</span> <span class="p">:</span> <span class="s1">&#39;data/TM_WORLD_BORDERS-0.3.shp&#39;</span>
<span class="p">}</span>
<span class="n">sds</span>     <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">,</span><span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">,</span><span class="s1">&#39;FparLai_QC&#39;</span><span class="p">]</span>
<span class="n">tile</span>    <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;h17v03&#39;</span><span class="p">,</span><span class="s1">&#39;h18v03&#39;</span><span class="p">,</span><span class="s1">&#39;h17v04&#39;</span><span class="p">,</span><span class="s1">&#39;h18v04&#39;</span><span class="p">]</span>
<span class="n">product</span> <span class="o">=</span> <span class="s1">&#39;MCD15A3H&#39;</span>
<span class="n">year</span>    <span class="o">=</span> <span class="mi">2019</span>
    
<span class="n">mfiles</span> <span class="o">=</span> <span class="n">modis_annual</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">tile</span><span class="p">,</span><span class="n">product</span><span class="p">,</span><span class="n">sds</span><span class="o">=</span><span class="n">sds</span><span class="p">,</span><span class="n">warp_args</span><span class="o">=</span><span class="n">warp_args</span><span class="p">)</span>

<span class="c1"># apply weights as previously</span>

<span class="n">lai</span> <span class="o">=</span> <span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;Lai_500m&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.1</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;LaiStdDev_500m&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.1</span>

<span class="n">std</span><span class="p">[</span><span class="n">std</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">std</span><span class="p">)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">std</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">weight</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">std</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">weight</span><span class="p">[</span><span class="n">lai</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

<span class="c1"># look at some stats</span>
<span class="nb">print</span><span class="p">(</span><span class="n">weight</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">weight</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">we</span> <span class="n">dont</span> <span class="n">need</span> <span class="n">to</span> <span class="n">process</span> <span class="n">MCD15A3H</span><span class="o">.</span><span class="n">_h17v03_h18v03_h17v04_h18v04_</span><span class="o">.</span><span class="mi">2019</span>
<span class="mf">0.0</span> <span class="mf">1.0</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
<span class="n">error</span><span class="p">[</span><span class="n">weight</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">weight</span><span class="p">[</span><span class="n">weight</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span> <span class="p">))</span> <span class="o">*</span> <span class="mf">1.97</span>

<span class="n">doy</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;bandnames&#39;</span><span class="p">]]</span>
<span class="n">p0</span><span class="p">,</span><span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">107</span><span class="p">,</span><span class="mi">72</span><span class="p">)</span>
<span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>

<span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">doy</span>

<span class="n">axs</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">lai</span><span class="p">[:,</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">],</span><span class="n">yerr</span><span class="o">=</span><span class="n">error</span><span class="p">[:,</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">]</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">p0</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">p1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># ensure the same scale for all</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;DOY 2019&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;LAI&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;LAI&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="png" src="_images/035_Weighted_interpolation_3_1.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">scipy.ndimage.filters</span>

<span class="n">sigma</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">sigma</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="n">sigma</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">gaussian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">sigma</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">gaussian</span><span class="p">)</span>

<span class="n">numerator</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">convolve1d</span><span class="p">(</span><span class="n">lai</span> <span class="o">*</span> <span class="n">weight</span><span class="p">,</span> <span class="n">gaussian</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wrap&#39;</span><span class="p">)</span>
<span class="n">denominator</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">filters</span><span class="o">.</span><span class="n">convolve1d</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">gaussian</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;wrap&#39;</span><span class="p">)</span>

<span class="c1"># avoid divide by 0 problems by setting zero values</span>
<span class="c1"># of the denominator to not a number (NaN)</span>
<span class="n">denominator</span><span class="p">[</span><span class="n">denominator</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">interpolated_lai</span> <span class="o">=</span> <span class="n">numerator</span><span class="o">/</span><span class="n">denominator</span>
</pre></div>
</div>
<p><img alt="png" src="_images/035_Weighted_interpolation_4_0.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">107</span><span class="p">,</span><span class="mi">72</span><span class="p">)</span>
<span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">doy</span>
<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">interpolated_lai</span><span class="p">[:,</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">],</span><span class="s1">&#39;r--&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;smoothed LAI&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">lai</span><span class="p">[:,</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">],</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;LAI&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">weight</span><span class="p">[:,</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">],</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;weight&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">p0</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">p1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="c1"># ensure the same scale for all</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;DOY 2019&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;LAI&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">Legend</span> <span class="n">at</span> <span class="mh">0x7fdf13c5c890</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><img alt="png" src="_images/035_Weighted_interpolation_5_1.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the interpolated_lai</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">interpolated_lai</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">interpolated_lai</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">vmax</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">inferno_r</span><span class="p">,</span>\
                       <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;bandnames&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
<p><img alt="png" src="_images/035_Weighted_interpolation_6_0.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>

<span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="p">[],</span> <span class="n">yticks</span><span class="o">=</span><span class="p">[])</span>

<span class="n">pixel</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">70</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">doy</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">p0</span> <span class="o">=</span> <span class="n">pixel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">pixel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">j</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">interpolated_lai</span><span class="p">[:,</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">])</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">lai</span><span class="p">[:,</span><span class="n">p0</span><span class="p">,</span><span class="n">p1</span><span class="p">],</span><span class="s1">&#39;+&#39;</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">p0</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">p1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="c1"># ensure the same scale for all</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="png" src="_images/035_Weighted_interpolation_7_0.png" /></p>
</div>
<div class="section" id="data-mask">
<h2>data mask<a class="headerlink" href="#data-mask" title="Permalink to this headline">¶</a></h2>
<p>Although these datasets look complete when we plot them, it is still possible that some pixels have no valid data points or invalid pixels. Earlier, we set</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">denominator</span><span class="p">[</span><span class="n">denominator</span><span class="o">==</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</pre></div>
</div>
<p>so we would expect invalid pixels to contain <code class="docutils literal notranslate"><span class="pre">np.nan</span></code>. We can build a mask for these pixels, for example by summing along the time axis (axis 0):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolated_lai</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>This will build a 2D dataset that is <code class="docutils literal notranslate"><span class="pre">np.nan</span></code> if incvalid. We can then use <code class="docutils literal notranslate"><span class="pre">~np.isnan</span></code> to build a boolean mask. The <code class="docutils literal notranslate"><span class="pre">~</span></code> symbol is the same as doing <code class="docutils literal notranslate"><span class="pre">np.logical_not()</span></code> in this context. It will be <code class="docutils literal notranslate"><span class="pre">True</span></code> where invalid, and <code class="docutils literal notranslate"><span class="pre">False</span></code> where valid:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolated_lai</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">doy</span>
<span class="n">axs</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;data mask&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;data mask&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="png" src="_images/035_Weighted_interpolation_9_1.png" /></p>
<p>Lets now load some land cover data:</p>
<p>We will use <code class="docutils literal notranslate"><span class="pre">LC_Type3</span></code> as this is the classification associated with the LAI product. You will find a CSV file defining the LC types in <a class="reference external" href="data/LC_Type3_colour.csv"><code class="docutils literal notranslate"><span class="pre">data/LC_Type3_colour.csv</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">geog0111.modis</span> <span class="kn">import</span> <span class="n">Modis</span>

<span class="c1"># LU</span>
<span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;tile&#39;</span>      <span class="p">:</span>    <span class="p">[</span><span class="s1">&#39;h17v03&#39;</span><span class="p">,</span> <span class="s1">&#39;h18v03&#39;</span><span class="p">,</span><span class="s1">&#39;h17v04&#39;</span><span class="p">,</span> <span class="s1">&#39;h18v04&#39;</span><span class="p">],</span>
    <span class="s1">&#39;product&#39;</span>   <span class="p">:</span>    <span class="s1">&#39;MCD12Q1&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">year</span>  <span class="o">=</span> <span class="mi">2019</span>
<span class="n">doy</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># get the data</span>
<span class="n">modis</span> <span class="o">=</span> <span class="n">Modis</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="n">warp_args</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;dstNodata&#39;</span>     <span class="p">:</span> <span class="mi">255</span><span class="p">,</span>
    <span class="s1">&#39;format&#39;</span>        <span class="p">:</span> <span class="s1">&#39;MEM&#39;</span><span class="p">,</span>
    <span class="s1">&#39;cropToCutline&#39;</span> <span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s1">&#39;cutlineWhere&#39;</span>  <span class="p">:</span> <span class="s2">&quot;FIPS=&#39;LU&#39;&quot;</span><span class="p">,</span>
    <span class="s1">&#39;cutlineDSName&#39;</span> <span class="p">:</span> <span class="s1">&#39;data/TM_WORLD_BORDERS-0.3.shp&#39;</span>
<span class="p">}</span>

<span class="c1"># specify day of year (DOY) and year</span>
<span class="n">lcfiles</span> <span class="o">=</span> <span class="n">modis</span><span class="o">.</span><span class="n">get_modis</span><span class="p">(</span><span class="n">year</span><span class="p">,</span><span class="n">doy</span><span class="p">,</span><span class="n">warp_args</span><span class="o">=</span><span class="n">warp_args</span><span class="p">)</span>
<span class="n">lcfiles</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dict_keys</span><span class="p">([</span><span class="s1">&#39;LC_Prop1&#39;</span><span class="p">,</span> <span class="s1">&#39;LC_Prop1_Assessment&#39;</span><span class="p">,</span> <span class="s1">&#39;LC_Prop2&#39;</span><span class="p">,</span> <span class="s1">&#39;LC_Prop2_Assessment&#39;</span><span class="p">,</span> <span class="s1">&#39;LC_Prop3&#39;</span><span class="p">,</span> <span class="s1">&#39;LC_Prop3_Assessment&#39;</span><span class="p">,</span> <span class="s1">&#39;LC_Type1&#39;</span><span class="p">,</span> <span class="s1">&#39;LC_Type2&#39;</span><span class="p">,</span> <span class="s1">&#39;LC_Type3&#39;</span><span class="p">,</span> <span class="s1">&#39;LC_Type4&#39;</span><span class="p">,</span> <span class="s1">&#39;LC_Type5&#39;</span><span class="p">,</span> <span class="s1">&#39;LW&#39;</span><span class="p">,</span> <span class="s1">&#39;QC&#39;</span><span class="p">,</span> <span class="s1">&#39;bandnames&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1"># read the colour data</span>
<span class="n">lc_Type3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/LC_Type3_colour.csv&#39;</span><span class="p">)</span>
<span class="n">lc_Type3</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">dataframe</span> <span class="n">tbody</span> <span class="n">tr</span> <span class="n">th</span> <span class="p">{</span>
    <span class="n">vertical</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">top</span><span class="p">;</span>
<span class="p">}</span>

<span class="o">.</span><span class="n">dataframe</span> <span class="n">thead</span> <span class="n">th</span> <span class="p">{</span>
    <span class="n">text</span><span class="o">-</span><span class="n">align</span><span class="p">:</span> <span class="n">right</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>code</th>
      <th>colour</th>
      <th>class</th>
      <th>description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>#1c0dff</td>
      <td>Water Bodies</td>
      <td>at least 60% of area is covered by permanent w...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>#b6ff05</td>
      <td>Grasslands</td>
      <td>dominated by herbaceous annuals (&lt;2m) includin...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>#dcd159</td>
      <td>Shrublands</td>
      <td>shrub (1-2m) cover &gt;10%.</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>#c24f44</td>
      <td>Broadleaf</td>
      <td>Croplands: bominated by herbaceous annuals (&lt;2...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>#fbff13</td>
      <td>Savannas</td>
      <td>between 10-60% tree cover (&gt;2m).</td>
    </tr>
    <tr>
      <th>5</th>
      <td>5</td>
      <td>#086a10</td>
      <td>Evergreen Broadleaf Forests</td>
      <td>dominated by evergreen broadleaf and palmate t...</td>
    </tr>
    <tr>
      <th>6</th>
      <td>6</td>
      <td>#78d203</td>
      <td>Deciduous Broadleaf Forests</td>
      <td>dominated by deciduous broadleaf trees (canopy...</td>
    </tr>
    <tr>
      <th>7</th>
      <td>7</td>
      <td>#05450a</td>
      <td>Evergreen Needleleaf Forests</td>
      <td>dominated by evergreen conifer trees (canopy &gt;...</td>
    </tr>
    <tr>
      <th>8</th>
      <td>8</td>
      <td>#54a708</td>
      <td>Deciduous Needleleaf Forests</td>
      <td>dominated by deciduous needleleaf (larch) tree...</td>
    </tr>
    <tr>
      <th>9</th>
      <td>9</td>
      <td>#f9ffa4</td>
      <td>Non-Vegetated Lands</td>
      <td>at least 60% of area is non-vegetated barren (...</td>
    </tr>
    <tr>
      <th>10</th>
      <td>10</td>
      <td>#a5a5a5</td>
      <td>Urban and Built-up Lands</td>
      <td>at least 30% impervious surface area including...</td>
    </tr>
    <tr>
      <th>11</th>
      <td>255</td>
      <td>#000000</td>
      <td>Unclassified</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># generate matplotlib cmap and norm objects from these</span>
<span class="c1"># as in session 024</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span>

<span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span>\
        <span class="n">ListedColormap</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">lc_Type3</span><span class="p">[</span><span class="s1">&#39;colour&#39;</span><span class="p">]))</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span>\
        <span class="n">BoundaryNorm</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">lc_Type3</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">lc_Type3</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">]))</span>

<span class="c1"># set up the legend</span>
<span class="n">legend_labels</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">lc_Type3</span><span class="p">[</span><span class="s1">&#39;colour&#39;</span><span class="p">]),</span><span class="nb">list</span><span class="p">(</span><span class="n">lc_Type3</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">])))</span>
<span class="n">patches</span> <span class="o">=</span> <span class="p">[</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>
           <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="n">legend_labels</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gdal</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># read the LC_Type3 dataset</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">lcfiles</span><span class="p">[</span><span class="s1">&#39;LC_Type3&#39;</span><span class="p">])</span>
<span class="n">land_cover</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">land_cover</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lcfiles</span><span class="p">[</span><span class="s1">&#39;LC_Type3&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>  <span class="mi">1</span>   <span class="mi">3</span>   <span class="mi">4</span>   <span class="mi">5</span>   <span class="mi">6</span>   <span class="mi">7</span>  <span class="mi">10</span> <span class="mi">255</span><span class="p">]</span>
<span class="o">/</span><span class="n">shared</span><span class="o">/</span><span class="n">groups</span><span class="o">/</span><span class="n">jrole001</span><span class="o">/</span><span class="n">geog0111</span><span class="o">/</span><span class="n">work</span><span class="o">/</span><span class="n">MCD12Q1</span><span class="o">/</span><span class="n">data</span><span class="o">.</span><span class="n">LC_Type3</span><span class="o">.</span><span class="n">_h17v03_h18v03_h17v04_h18v04_</span><span class="o">.</span><span class="mf">2019.001</span><span class="o">.</span><span class="mi">001</span><span class="n">_warp</span><span class="o">.</span><span class="n">vrt</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">land_cover</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">patches</span><span class="p">,</span>
          <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.6</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
          <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">Legend</span> <span class="n">at</span> <span class="mh">0x7fdf10066150</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><img alt="png" src="_images/035_Weighted_interpolation_16_1.png" /></p>
<p>We can now consider masking both for valid pixels and for a particular land cover type.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the code for Grasslands</span>
<span class="c1"># might be easier to look in the table ...</span>
<span class="c1"># but we can extract it</span>
<span class="n">classy</span> <span class="o">=</span> <span class="s1">&#39;Grasslands&#39;</span>
<span class="n">code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">lc_Type3</span><span class="p">[</span><span class="s1">&#39;code&#39;</span><span class="p">][</span><span class="n">lc_Type3</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">classy</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;code for </span><span class="si">{</span><span class="n">classy</span><span class="si">}</span><span class="s1"> is </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">code</span> <span class="k">for</span> <span class="n">Grasslands</span> <span class="ow">is</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># code </span>
<span class="n">code_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">land_cover</span> <span class="o">==</span> <span class="n">code</span><span class="p">)</span>
<span class="n">valid_mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">interpolated_lai</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># combine</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">code_mask</span><span class="p">,</span><span class="n">valid_mask</span><span class="p">)</span>
<span class="n">masked_lai</span> <span class="o">=</span> <span class="n">interpolated_lai</span><span class="p">[:,</span><span class="n">mask</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">masked_lai</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="mi">92</span><span class="p">,</span> <span class="mi">2661</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice how we used <code class="docutils literal notranslate"><span class="pre">interpolated_lai[:,mask]</span></code> to apply the mask to the last 2 dimensions of the `interpolated_laia dataset. The result is 2D, the first dimension being the number of time samples.</p>
<p>Now, take the mean, over axis 1:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mean_lai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">interpolated_lai</span><span class="p">[:,</span><span class="n">mask</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">median_lai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">interpolated_lai</span><span class="p">[:,</span><span class="n">mask</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">max_lai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">interpolated_lai</span><span class="p">[:,</span><span class="n">mask</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">min_lai</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">interpolated_lai</span><span class="p">[:,</span><span class="n">mask</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># get the doy data as above</span>
<span class="n">doy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">mfiles</span><span class="p">[</span><span class="s1">&#39;bandnames&#39;</span><span class="p">]])</span>

<span class="c1"># check they have the same shape before we plot them!</span>
<span class="n">grass_lai</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">doy</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">((</span><span class="mi">92</span><span class="p">,),</span> <span class="p">(</span><span class="mi">92</span><span class="p">,))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot </span>
<span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">x_size</span><span class="p">,</span><span class="n">y_size</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">doy</span>
<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">mean_lai</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">classy</span><span class="si">}</span><span class="s2"> mean&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">median_lai</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">classy</span><span class="si">}</span><span class="s2"> median&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">max_lai</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">classy</span><span class="si">}</span><span class="s2"> max&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">min_lai</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">classy</span><span class="si">}</span><span class="s2"> min&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;smoothed LAI LU&#39;</span><span class="p">)</span>
<span class="c1"># ensure the same scale for all</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;LAI&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;DOY 2019&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">365</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">Legend</span> <span class="n">at</span> <span class="mh">0x7fdf018ee750</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><img alt="png" src="_images/035_Weighted_interpolation_22_1.png" /></p>
<div class="section" id="exercise-1">
<h3>Exercise 1<a class="headerlink" href="#exercise-1" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Produce plots of summary statistics for each land cover in the dataset</p></li>
<li><p>Compare LAI for two countries withing the bounds of the dataset, for given land cover classes.</p></li>
</ul>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>From this session, you should be able to acquire a MODIS timeseries dataset and associated land cover map. You should be able to treat the data, so that by defining a weight for weach observation, you can produce a regularised (smoothed, interpolated) dataset from original noisy observations. In this case, we used variable weighting, according to an uncertainty measure, but if that is not available, you can simply use a weight of 1 for a valid observation and 0 when there is no valid value.</p>
<p>You should then be able to calculate statistics from the data. You should be capable of doing this for any MODIS geophysical variable, and also of developing functiuons that bring some of these ideas together into more compact, reusable code.</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">GEOG0111 Scientific Computing</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="docindex.html">GEOG0111</a></li>
<li class="toctree-l1"><a class="reference internal" href="docindex.html#geog0111-scientific-computing">GEOG0111 Scientific Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="001_Notebook_use.html">001 Use of Jupyter notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="002_Unix.html">002 Some basic UNIX</a></li>
<li class="toctree-l1"><a class="reference internal" href="003_Help.html">003 Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="004_Accounts.html">004 Setup, Accounts and logins</a></li>
<li class="toctree-l1"><a class="reference internal" href="005_Packages.html">005 Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="001_Notebook_use_answers.html">001 Use of Jupyter notebooks : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="002_Unix_answers.html">002 Some basic UNIX : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="003_Help_answers.html">003 Help : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="010_Python_Introduction.html">010 Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="011_Python_data_types.html">011 Python data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="012_Python_strings.html">012 String formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="013_Python_string_methods.html">013 String methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="014_Python_groups.html">014 Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="015_Python_control.html">015 Control in Python: <code class="docutils literal notranslate"><span class="pre">if</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="016_Python_for.html">016 More control in Python: <code class="docutils literal notranslate"><span class="pre">for</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="017_Functions.html">Functions in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="018_Running_Python.html">018 Python codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="010_Python_Introduction_answers.html">010 Introduction to Python : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="011_Python_data_types_answers.html">011 Python data types : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="012_Python_strings_answers.html">012 String formatting : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="013_Python_string_methods_answers.html">013 String methods : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="014_Python_groups_answers.html">014 Groups : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="015_Python_control_answers.html">015 Control in Python: <code class="docutils literal notranslate"><span class="pre">if</span></code> : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="016_Python_for_answers.html">016 More control in Python: <code class="docutils literal notranslate"><span class="pre">for</span></code> : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="017_Functions_answers.html">Functions in Python : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="018_Running_Python_answers.html">018 Python codes : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="020_Python_files.html">020 Files and other Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="021_Streams.html">021 Streams</a></li>
<li class="toctree-l1"><a class="reference internal" href="022_Read_write_files.html">022 Read and Write: URLs and files</a></li>
<li class="toctree-l1"><a class="reference internal" href="023_Plotting.html">Plotting Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="024_Image_display.html">024 Image display</a></li>
<li class="toctree-l1"><a class="reference internal" href="020_Python_files_answers.html">020 Files and other Resources : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="021_Streams_answers.html">021 Streams : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="022_Read_write_files_answers.html">022 Read and Write: URLs and files : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="023_Plotting_answers.html">Plotting Graphs : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="024_Image_display_answers.html">024 Image display : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="030_NASA_MODIS_Earthdata.html">030 NASA MODIS Earthdata</a></li>
<li class="toctree-l1"><a class="reference internal" href="030_NASA_MODIS_Earthdata.html#summary">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="031_Numpy.html">031 Manipulating data: <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="032_GDAL_mosaicing_and_masking.html">032 GDAL: mosaicing and masking</a></li>
<li class="toctree-l1"><a class="reference internal" href="033_GDAL_timeseries.html">033 GDAL: time series</a></li>
<li class="toctree-l1"><a class="reference internal" href="034_Weigthed_smoothing_and_interpolation.html">034 Weighted interpolation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">035 Weighted interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="036_Model_Fitting.html">036 Model Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="030_NASA_MODIS_Earthdata_answers.html">030 NASA MODIS Earthdata : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="031_Numpy_answers.html">031 Manipulating data: <code class="docutils literal notranslate"><span class="pre">numpy</span></code> : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="032_GDAL_mosaicing_and_masking_answers.html">032 GDAL: mosaicing and masking : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="040_Practical_Part1.html">Assessed Practical</a></li>
<li class="toctree-l1"><a class="reference internal" href="041_Practical_Part2.html">041 Assessed Practical</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="034_Weigthed_smoothing_and_interpolation.html" title="previous chapter">034 Weighted interpolation</a></li>
      <li>Next: <a href="036_Model_Fitting.html" title="next chapter">036 Model Fitting</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, P. Lewis and J. Gomez-Dans.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/035_Weighted_interpolation.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>