
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Table of Contents &#8212; GEOG0111 Scientific Computing 1.0.1 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="5 Modelling and optimisation" href="051_Modelling_and_optimisation.html" />
    <link rel="prev" title="3.6 Reconciling projections" href="044_GDAL_Reconciling_projections.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="table-of-contents">
<h1>Table of Contents<a class="headerlink" href="#table-of-contents" title="Permalink to this headline">¶</a></h1>
 <p><div class="lev1 toc-item"><a href="#Fitting-to-the-Mauna-Loa-CO_2-record" data-toc-modified-id="Fitting-to-the-Mauna-Loa-CO_2-record-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>Fitting to the Mauna Loa $CO_2$ record</a></div><div class="lev2 toc-item"><a href="#Introduction" data-toc-modified-id="Introduction-11"><span class="toc-item-num">1.1&nbsp;&nbsp;</span>Introduction</a></div><div class="lev2 toc-item"><a href="#Obtaining-the-data" data-toc-modified-id="Obtaining-the-data-12"><span class="toc-item-num">1.2&nbsp;&nbsp;</span>Obtaining the data</a></div><div class="lev3 toc-item"><a href="#Downloading-the-data" data-toc-modified-id="Downloading-the-data-121"><span class="toc-item-num">1.2.1&nbsp;&nbsp;</span>Downloading the data</a></div><div class="lev3 toc-item"><a href="#Exploring-the-data" data-toc-modified-id="Exploring-the-data-122"><span class="toc-item-num">1.2.2&nbsp;&nbsp;</span>Exploring the data</a></div><div class="lev2 toc-item"><a href="#Loading-the-data-into-Python" data-toc-modified-id="Loading-the-data-into-Python-13"><span class="toc-item-num">1.3&nbsp;&nbsp;</span>Loading the data into Python</a></div><div class="lev2 toc-item"><a href="#A-model-for-CO_2-concentration" data-toc-modified-id="A-model-for-CO_2-concentration-14"><span class="toc-item-num">1.4&nbsp;&nbsp;</span>A model for $CO_2$ concentration</a></div><div class="lev3 toc-item"><a href="#A-linear-trend-model" data-toc-modified-id="A-linear-trend-model-141"><span class="toc-item-num">1.4.1&nbsp;&nbsp;</span>A linear trend model</a></div><div class="lev3 toc-item"><a href="#A-quadratic-model" data-toc-modified-id="A-quadratic-model-142"><span class="toc-item-num">1.4.2&nbsp;&nbsp;</span>A quadratic model</a></div><div class="lev2 toc-item"><a href="#Solving-the-problem-using-linear-algebra" data-toc-modified-id="Solving-the-problem-using-linear-algebra-15"><span class="toc-item-num">1.5&nbsp;&nbsp;</span>Solving the problem using linear algebra</a></div><div class="lev3 toc-item"><a href="#Solution-using-np.linalg.lstsq" data-toc-modified-id="Solution-using-np.linalg.lstsq-151"><span class="toc-item-num">1.5.1&nbsp;&nbsp;</span>Solution using <code>np.linalg.lstsq</code></a></div><div class="lev2 toc-item"><a href="#A-model-with-seasonality" data-toc-modified-id="A-model-with-seasonality-16"><span class="toc-item-num">1.6&nbsp;&nbsp;</span>A model with seasonality</a></div></div>
<div class="section" id="fitting-to-the-mauna-loa-co-2-record">
<h1>Fitting to the Mauna Loa $CO_2$ record<a class="headerlink" href="#fitting-to-the-mauna-loa-co-2-record" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>$CO_2$ concentration in the atmosphere has been steadily increasing. The flask measurements collected in Mauna Loa provide a fairly long time series that allows us to see the temporal evolution of this trace gas.</p>
<div class="alert alert-success">
<b>Why</b> is CO2 important?
</div><p>The time series looks like this</p>
<p><img alt="Mauna Loa CO2 record" src="https://www.pmel.noaa.gov/co2/files/co2_data_mlo_med.jpg" /></p>
<div class="alert alert-success">
Knowing that Mauna Loa is in Hawaii (Northern Hemisphere), can you broadly explain what's going on?
</div><p>In today’s session, we shall consider how to “model” the $CO_2$ record. We’ll develop some simple models of $CO_2$ as a function of time, and will try to “fit” them to the data.</p>
<div class="alert alert-success">
Can you think why fitting some models based on time to the Mauna Loa record might not be particularly insightful?
</div><p>We first have an import cell that deals with importing all the usual modules that we’ll require: numpy, matplotlib as well as pandas to read the data file. If you put all your imports at the top and run them first, they should be available for all other cells…</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>  <span class="c1"># Checks for files and so on</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>  <span class="c1"># Numpy for arrays and so on</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>  <span class="c1"># Matplotlib for plotting</span>
<span class="c1"># Ensure the plots are shown in the notebook</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="c1"># Instead of using requests, we might as well use Python&#39;s buil-in</span>
<span class="c1"># HTTP downloader</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlretrieve</span>
</pre></div>
</div>
</div>
<div class="section" id="obtaining-the-data">
<h2>Obtaining the data<a class="headerlink" href="#obtaining-the-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="downloading-the-data">
<h3>Downloading the data<a class="headerlink" href="#downloading-the-data" title="Permalink to this headline">¶</a></h3>
<p>The data are available on line from <a class="reference external" href="https://www.esrl.noaa.gov/gmd/ccgg/trends/data.html">NOAA</a>. We want the monthly  average dataset, which can be found there. If the data is not yet available in your system, the next Python cell will download it from <a class="reference external" href="ftp://aftp.cmdl.noaa.gov/products/trends/co2/co2_mm_mlo.txt"><code class="docutils literal notranslate"><span class="pre">ftp://aftp.cmdl.noaa.gov/products/trends/co2/co2_mm_mlo.txt</span></code></a>. In this case, because the url is an FTP one we will use the <code class="docutils literal notranslate"><span class="pre">urllib2</span></code> package rather than requests, that doesn’t deal with FTP. We will save it to a file with the same name locally:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The remote URL for the data file is address:</span>
<span class="n">address</span> <span class="o">=</span> <span class="s1">&#39;ftp://aftp.cmdl.noaa.gov/products/trends/co2/&#39;</span>
<span class="c1"># We&#39;ll create a folder if it doesn&#39;t exist in the data folder for</span>
<span class="c1"># the data</span>
<span class="n">dest_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;data/Mauna_Loa/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fname</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s2">&quot;data/Mauna_Loa/co2_mm_mlo.txt&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="c1"># Data file not present, let&#39;s download it</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloading remote file&quot;</span><span class="p">)</span>
    <span class="n">urlretrieve</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">address</span><span class="si">:</span><span class="s2">s</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">fname</span><span class="o">.</span><span class="n">name</span><span class="si">:</span><span class="s2">s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fname</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Remote file downloaded to </span><span class="si">{</span><span class="n">fname</span><span class="o">.</span><span class="n">name</span><span class="si">:</span><span class="s2">s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fname</span><span class="o">.</span><span class="n">name</span><span class="si">:</span><span class="s2">s</span><span class="si">}</span><span class="s2"> already present, no need to download again&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">co2_mm_mlo</span><span class="o">.</span><span class="n">txt</span> <span class="n">already</span> <span class="n">present</span><span class="p">,</span> <span class="n">no</span> <span class="n">need</span> <span class="n">to</span> <span class="n">download</span> <span class="n">again</span>
</pre></div>
</div>
</div>
<div class="section" id="exploring-the-data">
<h3>Exploring the data<a class="headerlink" href="#exploring-the-data" title="Permalink to this headline">¶</a></h3>
<p>We can have a peek at the text file. We note that most of the first few lines are “comments” (lines start by <code class="docutils literal notranslate"><span class="pre">#</span></code>), which describe useful <em>metadata</em>. We note that we have several columns of data:</p>
<ol class="simple">
<li><p>The year</p></li>
<li><p>The month</p></li>
<li><p>The decimal date</p></li>
<li><p>The monthly mean CO2 mole fraction determined from daily averages</p></li>
</ol>
<p>We will mostly be bothered about columns three and four.</p>
<p>We can peek at the data (first 73 lines) using the UNIX shell <a class="reference external" href="http://www.linfo.org/head.html"><code class="docutils literal notranslate"><span class="pre">head</span></code></a> command (this will not work on Windows, but will probably work on OSX):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>!head -n 73 data/Mauna_Loa/co2_mm_mlo.txt
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># --------------------------------------------------------------------</span>
<span class="c1"># USE OF NOAA ESRL DATA</span>
<span class="c1"># </span>
<span class="c1"># These data are made freely available to the public and the</span>
<span class="c1"># scientific community in the belief that their wide dissemination</span>
<span class="c1"># will lead to greater understanding and new scientific insights.</span>
<span class="c1"># The availability of these data does not constitute publication</span>
<span class="c1"># of the data.  NOAA relies on the ethics and integrity of the user to</span>
<span class="c1"># ensure that GML receives fair credit for their work.  If the data </span>
<span class="c1"># are obtained for potential use in a publication or presentation, </span>
<span class="c1"># GML should be informed at the outset of the nature of this work.  </span>
<span class="c1"># If the GML data are essential to the work, or if an important </span>
<span class="c1"># result or conclusion depends on the GML data, co-authorship</span>
<span class="c1"># may be appropriate.  This should be discussed at an early stage in</span>
<span class="c1"># the work.  Manuscripts using the GML data should be sent to GML</span>
<span class="c1"># for review before they are submitted for publication so we can</span>
<span class="c1"># ensure that the quality and limitations of the data are accurately</span>
<span class="c1"># represented.</span>
<span class="c1"># </span>
<span class="c1"># Contact:   Pieter Tans (303 497 6678; pieter.tans@noaa.gov)</span>
<span class="c1"># </span>
<span class="c1"># File Creation:  Wed Aug  5 09:08:30 2020</span>
<span class="c1"># </span>
<span class="c1"># RECIPROCITY</span>
<span class="c1"># </span>
<span class="c1"># Use of these data implies an agreement to reciprocate.</span>
<span class="c1"># Laboratories making similar measurements agree to make their</span>
<span class="c1"># own data available to the general public and to the scientific</span>
<span class="c1"># community in an equally complete and easily accessible form.</span>
<span class="c1"># Modelers are encouraged to make available to the community,</span>
<span class="c1"># upon request, their own tools used in the interpretation</span>
<span class="c1"># of the GML data, namely well documented model code, transport</span>
<span class="c1"># fields, and additional information necessary for other</span>
<span class="c1"># scientists to repeat the work and to run modified versions.</span>
<span class="c1"># Model availability includes collaborative support for new</span>
<span class="c1"># users of the models.</span>
<span class="c1"># --------------------------------------------------------------------</span>
<span class="c1">#  </span>
<span class="c1">#  </span>
<span class="c1"># See www.esrl.noaa.gov/gmd/ccgg/trends/ for additional details.</span>
<span class="c1">#  </span>
<span class="c1"># Data from March 1958 through April 1974 have been obtained by C. David Keeling</span>
<span class="c1"># of the Scripps Institution of Oceanography (SIO) and were obtained from the</span>
<span class="c1"># Scripps website (scrippsco2.ucsd.edu).</span>
<span class="c1">#</span>
<span class="c1"># The &quot;average&quot; column contains the monthly mean CO2 mole fraction determined</span>
<span class="c1"># from daily averages.  The mole fraction of CO2, expressed as parts per million</span>
<span class="c1"># (ppm) is the number of molecules of CO2 in every one million molecules of dried</span>
<span class="c1"># air (water vapor removed).  If there are missing days concentrated either early</span>
<span class="c1"># or late in the month, the monthly mean is corrected to the middle of the month</span>
<span class="c1"># using the average seasonal cycle.  Missing months are denoted by -99.99.</span>
<span class="c1"># The &quot;interpolated&quot; column includes average values from the preceding column</span>
<span class="c1"># and interpolated values where data are missing.  Interpolated values are</span>
<span class="c1"># computed in two steps.  First, we compute for each month the average seasonal</span>
<span class="c1"># cycle in a 7-year window around each monthly value.  In this way the seasonal</span>
<span class="c1"># cycle is allowed to change slowly over time.  We then determine the &quot;trend&quot;</span>
<span class="c1"># value for each month by removing the seasonal cycle; this result is shown in</span>
<span class="c1"># the &quot;trend&quot; column.  Trend values are linearly interpolated for missing months.</span>
<span class="c1"># The interpolated monthly mean is then the sum of the average seasonal cycle</span>
<span class="c1"># value and the trend value for the missing month.</span>
<span class="c1">#</span>
<span class="c1"># NOTE: In general, the data presented for the last year are subject to change, </span>
<span class="c1"># depending on recalibration of the reference gas mixtures used, and other quality</span>
<span class="c1"># control procedures. Occasionally, earlier years may also be changed for the same</span>
<span class="c1"># reasons.  Usually these changes are minor.</span>
<span class="c1">#</span>
<span class="c1"># CO2 expressed as a mole fraction in dry air, micromol/mol, abbreviated as ppm</span>
<span class="c1">#</span>
<span class="c1">#  (-99.99 missing data;  -1 no data for #daily means in month)</span>
<span class="c1">#</span>
<span class="c1">#            decimal     average   interpolated    trend    #days</span>
<span class="c1">#             date                             (season corr)</span>
<span class="mi">1958</span>   <span class="mi">3</span>    <span class="mf">1958.208</span>      <span class="mf">315.71</span>      <span class="mf">315.71</span>      <span class="mf">314.62</span>     <span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="loading-the-data-into-python">
<h2>Loading the data into Python<a class="headerlink" href="#loading-the-data-into-python" title="Permalink to this headline">¶</a></h2>
<p>This is quite straightforward using <a class="reference external" href="https://scipython.com/book/chapter-6-numpy/examples/using-numpys-loadtxt-method/"><code class="docutils literal notranslate"><span class="pre">np.loadtxt</span></code></a>…</p>
<p>We will also “mask” if the data is missing checking for the value -99.99…</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">hdr</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">,</span> <span class="s2">&quot;decimal_date&quot;</span><span class="p">,</span> <span class="s2">&quot;average&quot;</span><span class="p">,</span> <span class="s2">&quot;interpolated&quot;</span><span class="p">,</span> <span class="s2">&quot;trend&quot;</span><span class="p">,</span> <span class="s2">&quot;days&quot;</span>
<span class="p">]</span>
<span class="n">co2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="n">fname</span><span class="p">,</span>
    <span class="n">comment</span><span class="o">=</span><span class="s1">&#39;#&#39;</span><span class="p">,</span>
    <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">names</span><span class="o">=</span><span class="n">hdr</span><span class="p">,</span>
    <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">99.99</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">co2</span><span class="o">.</span><span class="n">decimal_date</span><span class="p">,</span> <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Interpolated&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">co2</span><span class="o">.</span><span class="n">decimal_date</span><span class="p">,</span> <span class="n">co2</span><span class="o">.</span><span class="n">average</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Average&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">co2</span><span class="o">.</span><span class="n">decimal_date</span><span class="p">,</span> <span class="n">co2</span><span class="o">.</span><span class="n">trend</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Trend&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;CO2 conc.&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">Legend</span> <span class="n">at</span> <span class="mh">0x7fbc6114b090</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><img alt="png" src="_images/050_Linear_models_8_1.png" /></p>
<p>So this is quite similar to what we had above. There’s an average line, an interpolated line, as well as some smoothed trend line. We’re interested in the interpolated line.</p>
</div>
<div class="section" id="a-model-for-co-2-concentration">
<h2>A model for $CO_2$ concentration<a class="headerlink" href="#a-model-for-co-2-concentration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="a-linear-trend-model">
<h3>A linear trend model<a class="headerlink" href="#a-linear-trend-model" title="Permalink to this headline">¶</a></h3>
<p>We might be curious about a simple model for $CO_2$ concentration. Perhaps the simplest model is a linear trend, which we can write as the concentration at some time step $i$, $W_i$ being just a linear scaling of the time $t_i$:</p>
<p>$$
W_i = m \cdot t_i + c.
$$</p>
<p>We can define a Python function for this very easily:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">linear_model</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="n">m</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">p</span>
    <span class="k">return</span> <span class="n">m</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">c</span>
</pre></div>
</div>
<p>We can now try to plot some model trajectories and the data by supplying parameters for the slope ($m$) and intercept ($c$). Let’s start by assuming that the slope can be approximated by the difference between minimum and maximum concentrations divided  by the number of timesteps:</p>
<p>$$
m \approx  \frac{411-310}{728}
$$</p>
<p>$c$ is the minimum value, so $c\approx 310$.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">n_times</span> <span class="o">=</span> <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">max_co2</span> <span class="o">=</span> <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">min_co2</span> <span class="o">=</span> <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;There are </span><span class="si">{</span><span class="n">n_times</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2"> steps in the data&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Maximum CO2 concentration </span><span class="si">{</span><span class="n">max_co2</span><span class="si">:</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Minimum CO2 concentration </span><span class="si">{</span><span class="n">min_co2</span><span class="si">:</span><span class="s2">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_times</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Measured&quot;</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="mf">403.</span> <span class="o">-</span> <span class="mf">305.</span><span class="p">)</span> <span class="o">/</span> <span class="mi">716</span>
<span class="n">c</span> <span class="o">=</span> <span class="mf">305.</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">linear_model</span><span class="p">([</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="n">x</span><span class="p">),</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Modelled&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">linear_model</span><span class="p">([</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;0.8&quot;</span><span class="p">)</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">linear_model</span><span class="p">([</span><span class="n">m</span><span class="p">,</span> <span class="n">c</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sum of squared residuals: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">S</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">There</span> <span class="n">are</span> <span class="mi">749</span> <span class="n">steps</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">data</span>
<span class="n">Maximum</span> <span class="n">CO2</span> <span class="n">concentration</span> <span class="mf">417.070000</span>
<span class="n">Minimum</span> <span class="n">CO2</span> <span class="n">concentration</span> <span class="mf">312.660000</span>
<span class="n">Sum</span> <span class="n">of</span> <span class="n">squared</span> <span class="n">residuals</span><span class="p">:</span> <span class="mf">15956.69223949002</span>
</pre></div>
</div>
<p><img alt="png" src="_images/050_Linear_models_12_1.png" /></p>
<p>So, not really a great fit… The overall shape is a bit off, and the model isn’t really fitting the annual seasonality in the curve. The residuals plot tells us that the residuals aren’t really noise around zero: they show a very clear trend, suggesting that <strong>the model is too simple to fit the data</strong>.</p>
</div>
<div class="section" id="a-quadratic-model">
<h3>A quadratic model<a class="headerlink" href="#a-quadratic-model" title="Permalink to this headline">¶</a></h3>
<p>Maybe we need a higher order model, like a quadratic model:</p>
<p>$$
W_i = a_0 \cdot t_i^2  + a_1 \cdot t_i + a_2.
$$</p>
<p>In this case, it is a bit harder to eyeball what good starting parameters for $\left[a_0, a_1, a_2\right]$ would be. A strategy for this would be to consider what a good fit would look like, and then use this to define a metric of good fit. A good fit would basically overlap the measurements, being indistinguishable from them. The <em>residual</em> is the difference between the measurement and the model. In this case, it can be positive or negative (whether the model over- or undershoots the observations), but by squaring the residual we get rid of the sign. Then we can add up all the squared residuals, and the best fit will be the one that has the lowest sum of squares. This is in essence the <a class="reference external" href="https://en.wikipedia.org/wiki/Least_squares">method of least squares</a>. Let’s see how this works <em>intuitevely</em>: we’ll loop over the parameters and plot the different predicted concentrations… First we need our model function…</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">quadratic_model</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">p</span>
    <span class="k">return</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">a2</span>
</pre></div>
</div>
<p>We can get a feeling of what the parameters might be just by eyeballing reading up some points from the graph, and then solving the system manually:</p>
<p>$$
\begin{aligned}
403 &amp;= a_0\cdot (728)^2 + a_1\cdot (728) + a_2\
340 &amp;= a_0\cdot (300)^2 + a_1\cdot (300) + a_2\
315 &amp;= a_0\cdot (0)^2 + a_1\cdot (0) + a_2\
\end{aligned}
$$</p>
<p>From this, we can get some rough estimates, which in this case are</p>
<p>$$
\begin{aligned}
a_0 &amp;= 9.5\cdot 10^{-5}\
a_1 &amp;= 5.48\cdot 10^{-2}\
a_2 &amp;= 315.\
\end{aligned}
$$</p>
<p>We can just basically run the model around these numbers and plot the different model predictions with a loop over $a_0$ and another one over $a_1$ (assuming $a_2$ is well defined)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">a2</span> <span class="o">=</span> <span class="mf">315.</span>
<span class="k">for</span> <span class="n">a0</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mf">20e-5</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">a1</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mf">10e-2</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">quadratic_model</span><span class="p">([</span><span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">],</span> <span class="n">x</span><span class="p">),</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;0.8&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Measured&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span> <span class="n">at</span> <span class="mh">0x7fbc50ed4ad0</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p><img alt="png" src="_images/050_Linear_models_16_1.png" /></p>
<p>This is quite complicated, we can see that there might be a good line of fit, but we don’t see clearly what parameters provide it! We can store the goodness of fit metric (sum of squared residuals) in a 2D array and then plot it as an image. It should be more obvious where the minimum lies…</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define a 2D array for the sum of squares (sos)</span>
<span class="n">sos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="c1"># the time axis redefined again, in case it got confused with something else</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_times</span><span class="p">)</span>

<span class="c1"># first loop is over a0, 20 steps between 1e-5 and 20e-5</span>
<span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">a0</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mf">20e-5</span><span class="p">,</span> <span class="mi">20</span><span class="p">)):</span>
    <span class="c1"># 2nd loop is over a1, 10 steps between 1e-2 and 10e-2</span>
    <span class="k">for</span> <span class="n">jj</span><span class="p">,</span> <span class="n">a1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mf">10e-2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)):</span>
        <span class="c1"># for the current values of a0 and a1, calculate the residual</span>
        <span class="n">residual</span> <span class="o">=</span> <span class="n">quadratic_model</span><span class="p">([</span><span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span>
        <span class="n">sq_residual</span> <span class="o">=</span> <span class="n">residual</span> <span class="o">*</span> <span class="n">residual</span>
        <span class="n">sum_of_residuals</span> <span class="o">=</span> <span class="n">sq_residual</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="c1"># Store the sum_of_residuals into our array</span>
        <span class="n">sos</span><span class="p">[</span><span class="n">jj</span><span class="p">,</span> <span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="p">(</span><span class="n">quadratic_model</span><span class="p">([</span><span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">],</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Plotting!</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="c1"># Set up the x and y axis for the plot</span>
<span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mf">20e-5</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mf">10e-2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="c1"># Do a contour plot. The logspace bit basically defines the location</span>
<span class="c1"># of 20 contour lines</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">yy</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">sos</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">magma_r</span><span class="p">)</span>
<span class="c1"># Colorbar</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="c1"># Now, just plot the rough guess of a0 and a1 into this plot</span>
<span class="c1"># We want to plot an empty circle with a green edge</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">9.51242659e-05</span><span class="p">,</span> <span class="mf">5.47960536e-02</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span> <span class="n">at</span> <span class="mh">0x7fbc3091b2d0</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<p><img alt="png" src="_images/050_Linear_models_18_1.png" /></p>
<p>So that’s pretty interesting, we get a very clear “valley”, with a minimum pretty close to where our first rough guess is… The shape is quite interesting: if we start at the first guess point, and move along the $x-$ or $y-$ axes, we quickly go into areas of large error. However, if we move along the diagonal line, we will be in the “trough” of the cost function, provided that when you move “up” (positive $a_0$), you also move “left” (negative $a_1$), or if you move “down” (negative $a_0$), you also move “right” (positive $a_1$). Basically, the cost function does not change if you can get the two parameters to co-operate and compensate the effect of each other.</p>
<p>Let’s find out where the actual minimum from our brute-force approach is. We can do this quickly by creating a mask where all the elements are <code class="docutils literal notranslate"><span class="pre">False</span></code> except where the minimum value of <code class="docutils literal notranslate"><span class="pre">sos</span></code> is located. We can then use this mask to multiply our <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> axes and just select the unique values that are larger than 0.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Best SoS: </span><span class="si">{</span><span class="n">sos</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">sos_mask</span> <span class="o">=</span> <span class="n">sos</span> <span class="o">==</span> <span class="n">sos</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">u1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">yy</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">sos_mask</span><span class="p">)</span>
<span class="n">yy_opt</span> <span class="o">=</span> <span class="n">u1</span><span class="p">[</span><span class="n">u1</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">u2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">xx</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">sos_mask</span><span class="p">)</span>
<span class="n">xx_opt</span> <span class="o">=</span> <span class="n">u2</span><span class="p">[</span><span class="n">u2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Best</span> <span class="n">SoS</span><span class="p">:</span> <span class="mf">4374.68</span>
</pre></div>
</div>
<p>The Sum of Squares of the first example was  around 15000, so we’ve improved our modelling by adding an extra (quadratic term). This is usually the case: you can improve your goodness of fit by adding extra terms, but usually at the cost of <em>specialising</em> your model too much to the training data. This will usually result in poor predictive abilities for the model outside the training region. Which isn’t cool.</p>
<p>We can plot now the cost function, as well as our first rough guess and the final guess:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plotting!</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="c1"># Set up the x and y axis for the plot</span>
<span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mf">20e-5</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="mf">10e-2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="c1"># Do a contour plot. The logspace bit basically defines the location</span>
<span class="c1"># of 20 contour lines</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">yy</span><span class="p">,</span> <span class="n">xx</span><span class="p">,</span> <span class="n">sos</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">magma_r</span><span class="p">)</span>
<span class="c1"># Colorbar</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="c1"># Now, just plot the rough guess of a0 and a1 into this plot</span>
<span class="c1"># We want to plot an empty circle with a green edge</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="mf">9.51242659e-05</span><span class="p">,</span>
    <span class="mf">5.47960536e-02</span><span class="p">,</span>
    <span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="n">mfc</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
    <span class="n">mec</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Rough guess&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yy_opt</span><span class="p">,</span> <span class="n">xx_opt</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">mfc</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">mec</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Brute force guess&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">Legend</span> <span class="n">at</span> <span class="mh">0x7fbc40fabed0</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><img alt="png" src="_images/050_Linear_models_22_1.png" /></p>
<p>That’s not <em>too bad</em>! But althogh we found a minimum, we haven’t shown how well our model really fits the observations! Let’s plot the prediction (with the “optimised parameters” as well as the roughly guessed ones):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">a2</span> <span class="o">=</span> <span class="mf">315.</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">quadratic_model</span><span class="p">([</span><span class="mf">9.51242659e-05</span><span class="p">,</span> <span class="mf">5.47960536e-02</span><span class="p">,</span> <span class="n">a2</span><span class="p">],</span> <span class="n">x</span><span class="p">),</span>
    <span class="s1">&#39;-&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Rough guess&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">quadratic_model</span><span class="p">([</span><span class="n">yy_opt</span><span class="p">,</span> <span class="n">xx_opt</span><span class="p">,</span> <span class="n">a2</span><span class="p">],</span> <span class="n">x</span><span class="p">),</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Brute force&quot;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Measured&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span> <span class="o">-</span> <span class="n">quadratic_model</span><span class="p">([</span><span class="n">yy_opt</span><span class="p">,</span> <span class="n">xx_opt</span><span class="p">,</span> <span class="n">a2</span><span class="p">],</span> <span class="n">x</span><span class="p">),</span>
    <span class="s1">&#39;s-&#39;</span><span class="p">,</span>
    <span class="n">lw</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">mfc</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="n">mec</span><span class="o">=</span><span class="s2">&quot;0.9&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.7&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span> <span class="n">at</span> <span class="mh">0x7fbc61618250</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><img alt="png" src="_images/050_Linear_models_24_1.png" /></p>
<p>So solvng by brute force with a quadratic appears to have worked better than fitting with our linear model. The residuals now mostly lie in the -5 to 5 units range, whereas the linear model had residuals floating around -12 and 12 or thereabouts. It is also clear that we’re missing out on the seasonality, and some rates of growth (particularly at the end) seem to be underemphasised.</p>
</div>
</div>
<div class="section" id="solving-the-problem-using-linear-algebra">
<h2>Solving the problem using linear algebra<a class="headerlink" href="#solving-the-problem-using-linear-algebra" title="Permalink to this headline">¶</a></h2>
<p>So we can see that our brute force search has given us a better fit than eyeballing it, which is what one might expect. It should be possible to solve this analytically. Let’s write this as a matrix problem:</p>
<p>$$
\begin{aligned}
\mathbf{A}\cdot\vec{x}&amp;=\vec{y}\
\mathbf{A}&amp;=\begin{bmatrix}
t_1^2 &amp; t_1 &amp; 1 \
t_2^2 &amp; t_2 &amp; 1 \
t_3^2 &amp; t_3 &amp; 1 \
\vdots &amp; \vdots \vdots \
t_N^{2} &amp; t_N &amp; 1 \\end{bmatrix}\
\vec{x} &amp;=\begin{bmatrix}a_0\a_1\a_2 \end{bmatrix}\
\vec{y} &amp;=\begin{bmatrix}W_1\W_2\W_3\ \vdots \W_N \end{bmatrix}\
\end{aligned}
$$</p>
<div class="alert alert-success">
Spend some time satisfying yourself that you understand how the previous matrices and vectors work together.
</div><p>So, we see that this is really an overdetermined linear problem, where we’ve got more observations ($N$) than parameters (3). We can solve this by calculating the pseudo inverse:</p>
<p>$$
\vec{x} = \left[\mathbf{A}^{\top}\mathbf{A}  \right]^{-1}\mathbf{A}^{\top}\vec{y},
$$
where $^{\top}$ is the <strong>transpose</strong>, and $^{-1}$ is the inverse matrix. We can solve this problem easily in Python, which can deal with linear algebra nicely. The <a class="reference external" href="https://docs.scipy.org/doc/numpy-1.13.0/reference/generated/numpy.linalg.lstsq.html"><code class="docutils literal notranslate"><span class="pre">np.linalg.lstsq</span></code></a> method has a direct solver, or you can also work it out by calculating the inverse matrix yourself. The latter approach is usually numerically more unstable, so we won’t be looking into it.</p>
<div class="section" id="solution-using-np-linalg-lstsq">
<h3>Solution using <code class="docutils literal notranslate"><span class="pre">np.linalg.lstsq</span></code><a class="headerlink" href="#solution-using-np-linalg-lstsq" title="Permalink to this headline">¶</a></h3>
<p>In this case, we need to define the matrix $\mathbf{A}$. The observations vector $\vec{y}$ is already defined. What is needed is to weed out the invalid measurements in both $\mathbf{A}$ and $\vec{y}$. We then use <a class="reference external" href="https://docs.scipy.org/doc/numpy-1.13.0/reference/generated/numpy.linalg.lstsq.html"><code class="docutils literal notranslate"><span class="pre">np.linalg.lstsq</span></code></a> to solve the linear overdetermined system. This returns a number of things:</p>
<ol class="simple">
<li><p>The solution vector.</p></li>
<li><p>The sum of squared residuals.</p></li>
<li><p>The rank of the matrix $\mathbf{A}$.</p></li>
<li><p>The eigenvalues.</p></li>
</ol>
<p>We’re really only interested in the first two (the other two outputs are important, but this is not your methods course!).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># We create the A matrix</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_times</span><span class="p">)</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">)])</span>
<span class="c1"># Now put the observations into y</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span>

<span class="c1"># Call lstsq</span>
<span class="n">xopt</span><span class="p">,</span> <span class="n">sum_of_residuals</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">evals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">rough_guess</span> <span class="o">=</span> <span class="p">[</span><span class="mf">9.51242659e-05</span><span class="p">,</span> <span class="mf">5.47960536e-02</span><span class="p">,</span> <span class="mi">315</span><span class="p">]</span>
<span class="n">brute_force</span> <span class="o">=</span> <span class="p">[</span><span class="n">yy_opt</span><span class="p">,</span> <span class="n">xx_opt</span><span class="p">,</span> <span class="mi">315</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Parameter   Matrix       Brute force     Rough guess&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;a</span><span class="si">{}</span><span class="s2">:         </span><span class="si">{:08.5e}</span><span class="se">\t</span><span class="s2"> </span><span class="si">{:08.5e}</span><span class="se">\t</span><span class="s2"> </span><span class="si">{:08.5e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">par</span><span class="p">,</span> <span class="n">xopt</span><span class="p">[</span><span class="n">par</span><span class="p">],</span> <span class="nb">float</span><span class="p">(</span><span class="n">brute_force</span><span class="p">[</span><span class="n">par</span><span class="p">]),</span> <span class="n">rough_guess</span><span class="p">[</span><span class="n">par</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Sum of residuals: </span><span class="si">{:g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sum_of_residuals</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Parameter   Matrix       Brute force     Rough guess
a0:         9.04677e-05	 8.00000e-05	 9.51243e-05
a1:         6.38326e-02	 6.66700e-02	 5.47961e-02
a2:         3.14601e+02	 3.15000e+02	 3.15000e+02
Sum of residuals: 3710.77


/Users/plewis/anaconda3/envs/geog0111/lib/python3.7/site-packages/ipykernel_launcher.py:8: FutureWarning: `rcond` parameter will change to the default of machine precision times ``max(M, N)`` where M and N are the input matrix dimensions.
To use the future default and silence this warning we advise to pass `rcond=None`, to keep using the old, explicitly pass `rcond=-1`.
</pre></div>
</div>
<p>The parameters we got from the linear solver are very similar to the brute force method. If we had used a finer grid in the brute force model, we’d get even closer, but at the price of incresing the number of model evaluations. We can also see that using the analytic least squares solution results in the actual minimum of the cost function, not a value close to it.</p>
<p>In the linear algebra case, the procedure is very simple, and provided the matrix $\mathbf{A}$ is invertible, one is mostly guaranteed a good solution.</p>
<p>As usual, let’s us plot model, data and residuals and see what we can spot…</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_times</span><span class="p">)</span>
<span class="n">a2</span> <span class="o">=</span> <span class="mf">315.</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">quadratic_model</span><span class="p">(</span><span class="n">rough_guess</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Rough guess&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">quadratic_model</span><span class="p">([</span><span class="n">yy_opt</span><span class="p">,</span> <span class="n">xx_opt</span><span class="p">,</span> <span class="n">a2</span><span class="p">],</span> <span class="n">x</span><span class="p">),</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Brute force&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">quadratic_model</span><span class="p">(</span><span class="n">xopt</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Linear least squares&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Measured&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span> <span class="o">-</span> <span class="n">quadratic_model</span><span class="p">(</span><span class="n">xopt</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span>
    <span class="s1">&#39;s-&#39;</span><span class="p">,</span>
    <span class="n">lw</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">mfc</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="n">mec</span><span class="o">=</span><span class="s2">&quot;0.9&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.7&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span> <span class="n">at</span> <span class="mh">0x7fbc50fcc3d0</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><img alt="png" src="_images/050_Linear_models_29_1.png" /></p>
<p>So we can see that the optimal value is quite similar to the other two solutions, but results in a better fit (3470 versus 4090). We can see that with this method we can solve for all three parameters, even though our first guess of 315 for $a_2$ was pretty close to the true solution.</p>
<div class="alert alert-danger">
Try to use the linear least squares method to fit the first order linear model that we fitted "by eye" at the start of the notebook.
</div></div>
</div>
<div class="section" id="a-model-with-seasonality">
<h2>A model with seasonality<a class="headerlink" href="#a-model-with-seasonality" title="Permalink to this headline">¶</a></h2>
<p>While the quadratic model appears to go through the centre of the Mauna Loa curve, it clearly misses an important feature: the seasonality of the $CO_2$ concentration. We can’t really emulate that behaviour with a simple quadratic function, but need a different model, one that deals with the seasonality. We can think that the seasonality is an additive cosine term, so that our model for $CO_2$ concentration is now</p>
<p>$$
W_i = a_0\cdot t_i^2 + a_1\cdot t_i + a_2 + a_3\cdot \cos\left(2\pi\frac{t_i}{T}  \right),
$$
where $T$ is the period of the seasonality, in this case, annual so $T=12$.</p>
<p>Although the model looks quite ugly, we see that we can write it like a sum (or a <em>linear combination</em>) of some functions ($t^2,,t,$, the cosine term) weighted by the model parameters $a_0, \cdots, a_3$. So this is a linear model like the ones we’ve seen before and with which you should be familiar.</p>
<p>In this case, the $\mathbf{A}$ matrix is now given by</p>
<p>$$
\mathbf{A}=\begin{bmatrix}<br />t_1^2 &amp; t_1 &amp; 1 &amp; \cos \left( 2\pi\frac{t_1}{T}\right)\
t_2^2 &amp; t_2 &amp; 1 &amp; \cos \left( 2\pi\frac{t_2}{T}\right)\
t_3^2 &amp; t_3 &amp; 1 &amp; \cos \left( 2\pi\frac{t_3}{T}\right)\
\vdots &amp; \vdots &amp; \vdots &amp; \vdots \
t_N^2 &amp; t_N &amp; 1 &amp; \cos \left( 2\pi\frac{t_N}{T}\right)\
\end{bmatrix}.
$$</p>
<p>We can still solve the problem by making use of <code class="docutils literal notranslate"><span class="pre">lstsq</span></code>. Let’s see how that works!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">quadratic_with_season</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mf">12.</span><span class="p">):</span>
    <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span> <span class="o">=</span> <span class="n">p</span>
    <span class="k">return</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">a2</span> <span class="o">+</span> <span class="n">a3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="n">period</span><span class="p">))</span>


<span class="n">period</span> <span class="o">=</span> <span class="mf">12.</span>
<span class="c1"># We create the A matrix</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_times</span><span class="p">)</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
              <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">period</span><span class="p">))])</span>
<span class="c1"># Now put the observations into y</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span>

<span class="c1"># Call lstsq</span>
<span class="n">xopt</span><span class="p">,</span> <span class="n">sum_of_residuals</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">evals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;a</span><span class="si">{}</span><span class="s2">:         </span><span class="si">{:08.5e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">xopt</span><span class="p">[</span><span class="n">par</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sum of squares: </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">sum_of_residuals</span><span class="p">)</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>a0:         9.01601e-05
a1:         6.40418e-02
a2:         3.14574e+02
a3:         2.29951e+00
Sum of squares: 1731.99


/Users/plewis/anaconda3/envs/geog0111/lib/python3.7/site-packages/ipykernel_launcher.py:15: FutureWarning: `rcond` parameter will change to the default of machine precision times ``max(M, N)`` where M and N are the input matrix dimensions.
To use the future default and silence this warning we advise to pass `rcond=None`, to keep using the old, explicitly pass `rcond=-1`.
  from ipykernel import kernelapp as app
</pre></div>
</div>
<p>Let’s do some plots of the function fitting and residuals, and compare to previous results…</p>
<div class="alert alert-danger">
Doing these sort of plots should be second nature to you by now. So do them!
</div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_times</span><span class="p">)</span>
<span class="n">a2</span> <span class="o">=</span> <span class="mf">315.</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">quadratic_with_season</span><span class="p">(</span><span class="n">xopt</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Linear least squares&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Measured&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">x</span><span class="p">,</span>
    <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span> <span class="o">-</span> <span class="n">quadratic_with_season</span><span class="p">(</span><span class="n">xopt</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span>
    <span class="s1">&#39;s-&#39;</span><span class="p">,</span>
    <span class="n">lw</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
    <span class="n">mfc</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="n">mec</span><span class="o">=</span><span class="s2">&quot;0.9&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;0.7&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span> <span class="n">at</span> <span class="mh">0x7fbc4110cf10</span><span class="o">&gt;</span>
</pre></div>
</div>
<p><img alt="png" src="_images/050_Linear_models_34_1.png" /></p>
<p>So that’s pretty good: by adding a simple cosine term, we can now start to model the annual seasonality in the measurements, and the sum of squared residuals is now further shrunk to around 1500. This is good, but in some ways unsurprising: you’re now solving for 4 parameters, rather than 3 or 2 (for the simple linear case), so you have more degrees of freedom, and you expect to be able to fit your data better.</p>
</div>
<div class="section" id="a-phase-shift">
<h2>A phase shift<a class="headerlink" href="#a-phase-shift" title="Permalink to this headline">¶</a></h2>
<p>Looking at the residuals, we might decide that there’s some mileage in shifting the cosine term a bit to get a better fit. We could do this by adding a phase shift so that the cosine terms would look like</p>
<p>$$
\cos\left[ \frac{2\pi}{T}(t+\phi)\right]
$$</p>
<p>However, it’d be hard to guess $\phi$ (we’ve effectively assumed it was 0 radians above!). So we’d need to use some non-linear solving approach. However, we might exploit the following trigonometrical identity:</p>
<p>$$
A\cos(\theta) + B\sin(\theta)=C\sin(\theta + \phi),
$$</p>
<div class="alert alert-success">
Can you prove the above identity? 
</div><p>This means that we can just add (drumroll…) yet another term to our model (a sine term), and the ratio of the cosine and sine terms will result in a phase shift. As we’re adding another term, we expect a better result, but in this case, we hope that the aim of adding this extra term is to have <strong>uncorrelated residuals around 0</strong>.</p>
<div class="alert alert-danger">
You should be able to do this yourself, including model fitting and plotting.
</div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">quadratic_with_season_shift</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mf">12.</span><span class="p">):</span>
    <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span><span class="p">,</span> <span class="n">a4</span> <span class="o">=</span> <span class="n">p</span>
    <span class="k">return</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">a2</span> <span class="o">+</span> \
                <span class="n">a3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="n">period</span><span class="p">))</span> <span class="o">+</span> \
                <span class="n">a4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="n">period</span><span class="p">))</span> 



<span class="n">period</span> <span class="o">=</span> <span class="mf">12.</span>
<span class="c1"># We create the A matrix</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_times</span><span class="p">)</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
              <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">period</span><span class="p">)),</span>
              <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">period</span><span class="p">))])</span>
<span class="c1"># Now put the observations into y</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span>

<span class="c1"># Call lstsq</span>
<span class="n">xopt</span><span class="p">,</span> <span class="n">sum_of_residuals</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">evals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;a</span><span class="si">{}</span><span class="s2">:         </span><span class="si">{:08.5e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">xopt</span><span class="p">[</span><span class="n">par</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sum of squares: </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">sum_of_residuals</span><span class="p">)</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>a0:         8.97749e-05
a1:         6.43387e-02
a2:         3.14528e+02
a3:         2.29780e+00
a4:         1.66387e+00
Sum of squares: 694.742


/Users/plewis/anaconda3/envs/geog0111/lib/python3.7/site-packages/ipykernel_launcher.py:19: FutureWarning: `rcond` parameter will change to the default of machine precision times ``max(M, N)`` where M and N are the input matrix dimensions.
To use the future default and silence this warning we advise to pass `rcond=None`, to keep using the old, explicitly pass `rcond=-1`.
</pre></div>
</div>
<p>The squared sum of residuals is now around 645, again an improvement on the solution. We can see the fit and residuals I got (yours should be similar) here</p>
<p><img alt="quadratic with seasonal shift" src="_images/quadratic_season_shift.png" /></p>
<p>We’re now within the +/- 2 units band, which is a reasonable estimate.</p>
</div>
<div class="section" id="prediction">
<h2>Prediction<a class="headerlink" href="#prediction" title="Permalink to this headline">¶</a></h2>
<p>A model isn’t very good if you don’t challenge it to predict phenomean outside the training range. We could just extend the $x-$ axis further left or right and see what the model predicts, but we’d be <strong>extrapolating</strong>.</p>
<div class="alert alert-success">
Given the simplicity of the model, and what you know about $CO_2$ dynamics over the past ~100 years, would you trust these extrapolations?
</div><p>We can sort of mimic this behaviour by fitting the model only to a subset of years, and then test it for the rest of the available time series. For example, fit for the first 20 years, and then forecasat the remaining years. Or fit the last 20 years and forecast the previous years until the 1950s… If the model is successful in its predictions, then we can say that the model is probably OK, but if the quality of the predictions is poor, then we need to start thinking about <strong>discarding</strong> the model, and looking for alternatives!</p>
<div class="alert alert-danger">
Fit the model to the first 30 years of data, and then use it to predict the <b>complete</b> time series. Your result should look something like below. Can you explain what's going on there?
</div><p><img alt="Extrapolation plot" src="_images/extrapolation.png" /></p>
</div>
<div class="section" id="uncertainty">
<h2>Uncertainty<a class="headerlink" href="#uncertainty" title="Permalink to this headline">¶</a></h2>
<p>We have not said anything about how the model predictions are <em>uncertain</em>: we only used a limited dataset, with measurements errors associated to it. Even within the training period, the residuals are not 0, so we can expect that the model has some bits of reality missing from it (it <em>is</em> a model, after all!). Uncertainty would allow us to  quantify how good or bad the predictions from the model are, but so far, we have ignored it…</p>
<div class="alert alert-success">
In the 30 year training experiment, can you sketch how you think uncertainty should look like?
</div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">quadratic_with_season_shift</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mf">12.</span><span class="p">):</span>
    <span class="n">a0</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span><span class="p">,</span> <span class="n">a3</span><span class="p">,</span> <span class="n">a4</span> <span class="o">=</span> <span class="n">p</span>
    <span class="k">return</span> <span class="n">a0</span> <span class="o">*</span> <span class="n">t</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">a2</span> <span class="o">+</span> \
                <span class="n">a3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="n">period</span><span class="p">))</span> <span class="o">+</span> \
                <span class="n">a4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">/</span> <span class="n">period</span><span class="p">))</span> 



<span class="n">period</span> <span class="o">=</span> <span class="mf">12.</span>
<span class="c1"># We create the A matrix</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_times</span><span class="p">)[:</span><span class="mi">12</span><span class="o">*</span><span class="mi">30</span><span class="p">]</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
              <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">period</span><span class="p">)),</span>
              <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">period</span><span class="p">))])</span>
<span class="c1"># Now put the observations into y</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">co2</span><span class="o">.</span><span class="n">interpolated</span><span class="p">[:</span><span class="mi">12</span><span class="o">*</span><span class="mi">30</span><span class="p">]</span>

<span class="c1"># Call lstsq</span>
<span class="n">xopt</span><span class="p">,</span> <span class="n">sum_of_residuals</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">evals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lstsq</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="k">for</span> <span class="n">par</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;a</span><span class="si">{}</span><span class="s2">:         </span><span class="si">{:08.5e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">par</span><span class="p">,</span> <span class="n">xopt</span><span class="p">[</span><span class="n">par</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sum of squares: </span><span class="si">{</span><span class="nb">float</span><span class="p">(</span><span class="n">sum_of_residuals</span><span class="p">)</span><span class="si">:</span><span class="s2">g</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>a0:         1.37498e-04
a1:         4.93748e-02
a2:         3.15199e+02
a3:         2.10181e+00
a4:         1.70328e+00
Sum of squares: 166.035


/Users/plewis/anaconda3/envs/geog0111/lib/python3.7/site-packages/ipykernel_launcher.py:19: FutureWarning: `rcond` parameter will change to the default of machine precision times ``max(M, N)`` where M and N are the input matrix dimensions.
To use the future default and silence this warning we advise to pass `rcond=None`, to keep using the old, explicitly pass `rcond=-1`.
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">GEOG0111 Scientific Computing</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="docindex.html">GEOG0111</a></li>
<li class="toctree-l1"><a class="reference internal" href="docindex.html#geog0111-scientific-computing">GEOG0111 Scientific Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="001_Notebook_use.html">001 Use of Jupyter notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="002_Unix.html">002 Some basic UNIX</a></li>
<li class="toctree-l1"><a class="reference internal" href="003_Help.html">003 Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="004_Accounts.html">004 Setup, Accounts and logins</a></li>
<li class="toctree-l1"><a class="reference internal" href="001_Notebook_use_answers.html">001 Use of Jupyter notebooks : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="002_Unix_answers.html">002 Some basic UNIX : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="003_Help_answers.html">003 Help : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="010_Python_Introduction.html">010 Introduction to Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="011_Python_data_types.html">011 Python data types</a></li>
<li class="toctree-l1"><a class="reference internal" href="012_Python_strings.html">012 String formatting</a></li>
<li class="toctree-l1"><a class="reference internal" href="013_Python_string_methods.html">013 String methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="014_Python_groups.html">014 Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="015_Python_control.html">015 Control in Python: <code class="docutils literal notranslate"><span class="pre">if</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="016_Python_for.html">016 More control in Python: <code class="docutils literal notranslate"><span class="pre">for</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="017_Functions.html">Functions in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="018_Packages.html">Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="019_Running_Python.html">019 Python codes</a></li>
<li class="toctree-l1"><a class="reference internal" href="010_Python_Introduction_answers.html">010 Introduction to Python : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="011_Python_data_types_answers.html">011 Python data types : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="012_Python_strings_answers.html">012 String formatting : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="013_Python_string_methods_answers.html">013 String methods : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="014_Python_groups_answers.html">014 Groups : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="015_Python_control_answers.html">015 Control in Python: <code class="docutils literal notranslate"><span class="pre">if</span></code> : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="016_Python_for_answers.html">016 More control in Python: <code class="docutils literal notranslate"><span class="pre">for</span></code> : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="017_Functions_answers.html">Functions in Python : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="019_Running_Python_answers.html">019 Python codes : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="020_NASA_MODIS_Earthdata.html">NASA MODIS Earthdata</a></li>
<li class="toctree-l1"><a class="reference internal" href="020_NASA_MODIS_Earthdata.html#exercises">Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="020_NASA_MODIS_Earthdata.html#summary">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="020_Python_files.html">020 Files and other Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="021_Read_files.html">021 Read Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="022_NASA_MODIS_Earthdata.html">NASA MODIS Earthdata</a></li>
<li class="toctree-l1"><a class="reference internal" href="022_NASA_MODIS_Earthdata.html#exercises">Exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="022_NASA_MODIS_Earthdata.html#summary">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="022_Pandas_and_plotting.html"><code class="docutils literal notranslate"><span class="pre">pandas</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="024_GoogleEarthEngine.html">201 Google Earth Engine</a></li>
<li class="toctree-l1"><a class="reference internal" href="020_NASA_MODIS_Earthdata_answers.html">NASA MODIS Earthdata : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="020_Python_files_answers.html">020 Files and other Resources : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="021_Read_files_answers.html">021 Read Files : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="022_NASA_MODIS_Earthdata_answers.html">NASA MODIS Earthdata : Answers to exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="031_Numpy_matplotlib.html">Manipulating data: <code class="docutils literal notranslate"><span class="pre">numpy</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="040_GDAL.html">3 Geospatial processing with <code class="docutils literal notranslate"><span class="pre">gdal</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="041_MODIS_download.html">3.2 Accessing MODIS Data products</a></li>
<li class="toctree-l1"><a class="reference internal" href="042_GDAL_masking.html">3.3 GDAL, and OGR masking</a></li>
<li class="toctree-l1"><a class="reference internal" href="043_GDAL_stacking_and_interpolating.html">3.4 Stacking and interpolating data</a></li>
<li class="toctree-l1"><a class="reference internal" href="044_GDAL_Reconciling_projections.html">3.6 Reconciling projections</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Table of Contents</a></li>
<li class="toctree-l1"><a class="reference internal" href="#fitting-to-the-mauna-loa-co-2-record">Fitting to the Mauna Loa $CO_2$ record</a></li>
<li class="toctree-l1"><a class="reference internal" href="051_Modelling_and_optimisation.html">5 Modelling and optimisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="DEV_Local_Install.html">003 Full native installation  of software and notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="DEV_scripts.html">Scripts</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="044_GDAL_Reconciling_projections.html" title="previous chapter">3.6 Reconciling projections</a></li>
      <li>Next: <a href="051_Modelling_and_optimisation.html" title="next chapter">5 Modelling and optimisation</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, P. Lewis and J. Gomez-Dans.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/050_Linear_models.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>