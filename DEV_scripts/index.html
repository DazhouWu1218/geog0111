


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../images/ucl.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.12">
    
    
      
        <title>Scripts - GEOG0111</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4dd2dd8d.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#scripts" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="GEOG0111" class="md-header-nav__button md-logo" aria-label="GEOG0111">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            GEOG0111
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Scripts
            
          </span>
        </div>
      
    </div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="GEOG0111" class="md-nav__button md-logo" aria-label="GEOG0111">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    GEOG0111
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Course Basics
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Course Basics" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon"></span>
        Course Basics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../001_Notebook_use/" title="Notebook Use" class="md-nav__link">
      Notebook Use
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../002_Unix/" title="Unix" class="md-nav__link">
      Unix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../003_Help/" title="Help" class="md-nav__link">
      Help
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../004_Accounts/" title="Accounts" class="md-nav__link">
      Accounts
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1-5" type="checkbox" id="nav-1-5">
    
    <label class="md-nav__link" for="nav-1-5">
      Answers
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Answers" data-md-level="2">
      <label class="md-nav__title" for="nav-1-5">
        <span class="md-nav__icon md-icon"></span>
        Answers
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../001_Notebook_use_answers/" title="Notebook Use" class="md-nav__link">
      Notebook Use
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../002_Unix_answers/" title="Unix" class="md-nav__link">
      Unix
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../003_Help_answers/" title="Help" class="md-nav__link">
      Help
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    Docker
  </a>
  
    <nav class="md-nav" aria-label="Docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#clean-up-docker-files" class="md-nav__link">
    Clean up docker files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-docker" class="md-nav__link">
    Build docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-docker" class="md-nav__link">
    Run docker
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scripts_1" class="md-nav__link">
    Scripts
  </a>
  
    <nav class="md-nav" aria-label="Scripts">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#binsetupsh" class="md-nav__link">
    bin/setup.sh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binpostbuild" class="md-nav__link">
    bin/postBuild
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binlink-setsh" class="md-nav__link">
    bin/link-set.sh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binnotebook-runsh" class="md-nav__link">
    bin/notebook-run.sh
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#binnotebook-mkdocssh" class="md-nav__link">
    bin/notebook-mkdocs.sh
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="scripts">Scripts</h1>
<p>This note describes utility scripts in <a href="bin"><code>bin</code></a> and <a href="geog0111"><code>geog0111</code></a>.</p>
<h2 id="docker">Docker</h2>
<p>The Docker file is in <a href="copy/Dockerfile"><code>Docker/Dockerfile</code></a>. This is a minimal setup for running notebooks for this course, being based on <a href="https://hub.docker.com/r/jgomezdans/uclgeog"><code>jgomezdans/uclgeog</code></a> which is derived from <a href="https://github.com/jgomezdans/geog_docker"><code>geog_docker</code></a>. </p>
<p>This docker is stored on dockerhub as <a href="https://hub.docker.com/r/ucleo/geog0111"><code>ucleo/geog0111</code></a> and derived from this repo <a href="https://github.com/UCL-EO/geog0111"><code>UCL-EO/geog0111</code></a>.</p>
<p>It is automatically run from <a href="https://travis-ci.com/github/UCL-EO/geog0111">travis</a> on a new load, so you shouldn't need to generate the docker manually.</p>
<p>The docker cleans out the environment for <code>uclgeog</code>, as we want opne called <code>geog0111</code>, clones <a href="https://github.com/UCL-EO/geog0111">this repository</a> and runs <a href="../bin/setup.sh"><code>bin/setup.sh</code></a> to install the <code>geog0111</code> environment. It activates the environment and runs <a href="bin/postBuild"><code>bin/postBuild</code></a>. </p>
<h3 id="clean-up-docker-files">Clean up docker files</h3>
<p>The script <a href="bin/docker-killall"><code>bin/docker-killall</code></a> cleans up any cached dockers, kills running dockers, and cleans it all out. Use this only to make a clean slate for your docker in the repoi.
Otherwise, use more subtle <code>docker</code> commands. It is intended onbly for developers, but is run as user.</p>
<h3 id="build-docker">Build docker</h3>
<p>The script <a href="bin/docker-build"><code>bin/docker-build</code></a> will build and upload the docker. This is again intended just for developers, and requires a login to dockerhub.</p>
<h3 id="run-docker">Run docker</h3>
<p>The script <a href="bin/docker-run"><code>bin/docker-run</code></a> can be used to run the docker and launch a notebook. It will attempt to map the <code>work</code> directory to the current directory or <code>${HOME}/OneDrive*</code>. It will try to re-use an existing docker image.</p>
<p>Normal use then would be something like:</p>
<p>cd /Users/plewis/work
   ~/geog0111/bin/docker-run</p>
<p>The first time you use this, it will show something like:</p>
<pre><code>--&gt; running bin/docker-run from /Users/plewis/work
--&gt; mount /Users/plewis/work
--&gt; bin/docker-run: no existing docker image found
--&gt; bin/docker-run: running docker with /Users/plewis/work as /home/jovyan/notebooks/work
</code></pre>
<p>So anything we save into <code>/home/jovyan/notebooks/work</code> in the notebook will go into <code>/Users/plewis/work</code>.</p>
<p>The notebook will start with a message such as:</p>
<pre><code>Serving notebooks from local directory: /home/jovyan/geog0111/notebooks
1 active kernel
The Jupyter Notebook is running at:
http://8fbac34af2bc:8888/?token=42897db02a8f1168ae2d7fb37aa2acdfcba51d47560a96dc
 or http://127.0.0.1:8888/?token=42897db02a8f1168ae2d7fb37aa2acdfcba51d47560a96dc
</code></pre>
<p>and you can access the notebooks from this address in a browser.</p>
<p>To end the session, type <code>^C</code> (<code>CONTROL + c</code>) in the teminal you ran the command from.</p>
<p>If you now type:</p>
<pre><code>docker ps -l
</code></pre>
<p>You should see an existing image e.g.:</p>
<pre><code>docker ps -l 
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                     PORTS               NAMES
8fbac34af2bc        ucleo/geog0111      "tini -g -- start-no…"   28 minutes ago      Exited (0) 2 minutes ago                       jolly_maxwell
</code></pre>
<p>If  you really want to delete that (start again with yoiur notebooks), you can with:</p>
<pre><code>docker container rm jolly_maxwell
</code></pre>
<p>but it should normally be fine to re-use.</p>
<p>The next time you run thiis command, it should recognise an existing docker image and respind with something like:</p>
<pre><code>--&gt; running bin/docker-run from /Users/plewis/work
--&gt; mount /Users/plewis/work
--&gt; bin/docker-run: using docker image jolly_maxwell
</code></pre>
<h2 id="scripts_1">Scripts</h2>
<h3 id="binsetupsh"><code>bin/setup.sh</code></h3>
<p><a href="../bin/setup.sh"><code>bin/setup.sh</code></a> is the core setup script. It is run for example from <a href="copy/Dockerfile"><code>Docker/Dockerfile</code></a>
but may also be run on the repository. It should usually be run by the user and should work from any operating system.</p>
<pre><code>setup.sh [-r | --remove] [-f|--force] | [-n|--no_force]
</code></pre>
<p>The main purpose of the script is to run the <code>conda</code> setup to make the conda environment <code>geog0111</code> from <a href="../copy/environment.yml">Docker/environment.yml</a>.
It will detect if windows is being used (so run <code>conda.bat</code>) and test to see if the environment <code>geog0111</code> already exists. If it does, it can be removed (<code>--remove</code>) or a foce install done (<code>--force</code>). Otherwise, it will try to update the environment from <a href="../copy/environment.yml">Docker/environment.yml</a>.</p>
<p>It generates a file <a href="copy/dockenvrc"><code>~/.dockenvrc</code></a> to be run on shell startup to activate the environment.</p>
<p>After running this script, you should manually activate the environment:</p>
<pre><code>conda activcate geog0111
</code></pre>
<h3 id="binpostbuild"><code>bin/postBuild</code></h3>
<p><a href="bin/postBuild"><code>bin/postBuild</code></a> is run after <a href="../bin/setup.sh"><code>bin/setup.sh</code></a> and does jobs such as setting up the jupyter notebook extensions, installing the <code>geog0111</code> package locally (using <a href="../copy/setup.py"><code>setup.py</code></a>) and ensuring shell initialisation is properly done for subsequent sessions. It should be run the the user, and woul;d normally be run after any new run of <a href="../bin/setup.sh"><code>bin/setup.sh</code></a>.</p>
<h3 id="binlink-setsh"><code>bin/link-set.sh</code></h3>
<p><a href="../bin/link-set.sh"><code>bin/link-set.sh</code></a> is the directory linking script. 
It should usually be run by the user.</p>
<p>Users may work in any of several directories, so we need to put in symbolic links
from common directories (<code>data</code> <code>$repo</code> <code>images</code>) in each of these to ensure
correct operation. This script does that: It goes into each of <code>notebooks</code> 
<code>notebooks/work</code> <code>docs</code> <code>notebooks_lab</code> <code>notebooks_lab/work</code> <code>docs/work</code> and puts a 
symbolic link to <code>data</code> <code>$repo</code> <code>images</code> in <code>..</code>. Since relative paths are used,
this is portable.</p>
<p>In addition, it puts a link in from <code>~/$repo</code> to <code>$repo</code> for convenience (unless this 
already exists). It also puts a link in from <code>$UCLDATA</code> to <code>data/ucl</code> (default <code>${HOME}/geog0111/work</code>)
so that a system-wide data directory can be put in, and referred to asd <code>data/ucl</code> from
scripts.</p>
<p>This is called <a href="../bin/setup.sh"><code>bin/setup.sh</code></a>, but may be run independently to fix any broken links.</p>
<h3 id="binnotebook-runsh"><code>bin/notebook-run.sh</code></h3>
<p>This script runs all notebooks in <a href="notebooks"><code>notebooks</code></a> using <code>jupyter nbconvert</code>. The files are saved as <code>*.nbconvert.md</code>. The running is tolerant to errors. If the file is no different to the original, the original is kept. Otherwise the user is prompted to see if you want to replace the original notebook with the one that has been executed. You are provided with information on file sizes, which should help with this decision: you might not want to save a notebook that is (much) smaller than the original. Backups are stored in <code>backup.$$</code> which you need to manually clear.</p>
<p>You might run this as a pre-cursor to <a href="../bin/notebook-mkdocs.sh"><code>bin/notebook-mkdocs.sh</code></a>.</p>
<h3 id="binnotebook-mkdocssh"><code>bin/notebook-mkdocs.sh</code></h3>
<p>This script <a href="../bin/notebook-mkdocs.sh"><code>bin/notebook-mkdocs.sh</code></a> filters notebooks in <a href="notebooks"><code>notebooks</code></a> into <a href="notebooks_lab"><code>notebooks_lab</code></a> using <a href="../geog0111/edit_notebook.py"><code>geog0111/edit_notebook.py</code></a>. This filters out noteboom extensions and other features, and makes the notebooks suitable for running in <a href="https://jupyterlab.readthedocs.io/en/stable/">JupyterLab</a>, rather than just <code>jupyter noteboook</code>. It strips out exercises defiuned in <code>exercise2</code> cells, into new notebooks with the pattern <code>_answers.md</code>.</p>
<p>The script takes the <a href="notebooks_lab"><code>notebooks_lab</code></a> notebooks, and converts to markdown in <a href="docs"><code>docs</code></a> and prepares the environment for the document generator <code>mkdocs</code> using <a href="../geog0111/mkdocs_prep.py"><code>geog0111/mkdocs_prep.py</code></a>. 
It runs <code>mkdocs build</code> locally. The documents can be viewed with:</p>
<pre><code>mkdocs serve
</code></pre>
<p>and/or uploaded to the document server (by the developer) using:</p>
<pre><code>mkdocs gh-deploy --force
</code></pre>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.3636a4ec.min.js"></script>
      <script src="../assets/javascripts/bundle.e9fe3281.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>